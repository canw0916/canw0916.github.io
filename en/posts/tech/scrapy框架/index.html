<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Scrapyæ¡†æ¶ | Felix's Blog</title><meta name=keywords content><meta name=description content="ç®€ä»‹
ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ
æ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚
Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚"><meta name=author content="
ä½œè€…:Felix"><link rel=canonical href=https://canw0916.github.io/en/posts/tech/scrapy%E6%A1%86%E6%9E%B6/><link crossorigin=anonymous href=/assets/css/stylesheet.67971badef1fb278a7dbb01fdd6e1add4dae2ea34bb3a44665b66327fad3f0ab.css integrity="sha256-Z5cbre8fsnin27Af3W4a3U2uLqNLs6RGZbZjJ/rT8Ks=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://canw0916.github.io/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://canw0916.github.io/img/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://canw0916.github.io/img/favicon-32x32.png><link rel=apple-touch-icon href=https://canw0916.github.io/img/apple-touch-icon.png><link rel=mask-icon href=https://canw0916.github.io/img/android-chrome-512x512.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://canw0916.github.io/en/posts/tech/scrapy%E6%A1%86%E6%9E%B6/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-7ENSZ7BS0C"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7ENSZ7BS0C")}</script><meta property="og:title" content="Scrapyæ¡†æ¶"><meta property="og:description" content="ç®€ä»‹
ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ
æ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚
Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://canw0916.github.io/en/posts/tech/scrapy%E6%A1%86%E6%9E%B6/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-10T15:08:28+08:00"><meta property="article:modified_time" content="2023-02-10T15:08:28+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Scrapyæ¡†æ¶"><meta name=twitter:description content="ç®€ä»‹
ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ
æ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚
Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://canw0916.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"ğŸš€ æŠ€æœ¯","item":"https://canw0916.github.io/en/posts/tech/"},{"@type":"ListItem","position":3,"name":"Scrapyæ¡†æ¶","item":"https://canw0916.github.io/en/posts/tech/scrapy%E6%A1%86%E6%9E%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Scrapyæ¡†æ¶","name":"Scrapyæ¡†æ¶","description":"ç®€ä»‹ ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ\næ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚\nScrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚\n","keywords":[],"articleBody":"ç®€ä»‹ ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ\næ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚\nScrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚\nåˆæœŸå¦‚ä½•å­¦ä¹ æ¡†æ¶ï¼Ÿ\nåªéœ€è¦å­¦ä¹ æ¡†æ¶é›†æˆå¥½çš„å„ç§åŠŸèƒ½çš„ç”¨æ³•å³å¯ï¼å‰æœŸåˆ‡å‹¿é’»ç ”æ¡†æ¶çš„æºç ï¼\nå®‰è£… Linux/macç³»ç»Ÿï¼š pip install scrapyï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰ Windowsç³»ç»Ÿï¼š a. pip install wheelï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰ b. ä¸‹è½½twistedæ–‡ä»¶ï¼Œä¸‹è½½ç½‘å€å¦‚ä¸‹ï¼š http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted c. ç»ˆç«¯è¿›å…¥ä¸‹è½½ç›®å½•ï¼Œæ‰§è¡Œ pip install Twistedâ€‘17.1.0â€‘cp35â€‘cp35mâ€‘win_amd64.whl æ³¨æ„ï¼šå¦‚æœè¯¥æ­¥éª¤å®‰è£…å‡ºé”™ï¼Œåˆ™æ¢ä¸€ä¸ªç‰ˆæœ¬çš„whlæ–‡ä»¶å³å¯ d. pip install pywin32ï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰ e. pip install scrapyï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰ å¦‚æœå®‰è£…å¥½åï¼Œåœ¨ç»ˆç«¯ä¸­å½•å…¥scrapyæŒ‡ä»¤æŒ‰ä¸‹å›è½¦ï¼Œå¦‚æœæ²¡æœ‰æç¤ºæ‰¾ä¸åˆ°è¯¥æŒ‡ä»¤ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ åŸºæœ¬ä½¿ç”¨ åˆ›å»ºé¡¹ç›®\nscrapy startproject é¡¹ç›®åç§°\né¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š\nfirstBlood # é¡¹ç›®æ‰€åœ¨æ–‡ä»¶å¤¹, å»ºè®®ç”¨pycharmæ‰“å¼€è¯¥æ–‡ä»¶å¤¹ â”œâ”€â”€ firstBlood # é¡¹ç›®è·Ÿç›®å½• â”‚Â â”œâ”€â”€ __init__.py â”‚Â â”œâ”€â”€ items.py # å°è£…æ•°æ®çš„æ ¼å¼ â”‚Â â”œâ”€â”€ middlewares.py # æ‰€æœ‰ä¸­é—´ä»¶ â”‚Â â”œâ”€â”€ pipelines.py\t# æ‰€æœ‰çš„ç®¡é“ â”‚Â â”œâ”€â”€ settings.py\t# çˆ¬è™«é…ç½®ä¿¡æ¯ â”‚Â â””â”€â”€ spiders\t# çˆ¬è™«æ–‡ä»¶å¤¹, ç¨åé‡Œé¢ä¼šå†™å…¥çˆ¬è™«ä»£ç  â”‚Â â””â”€â”€ __init__.py â””â”€â”€ scrapy.cfg\t# scrapyé¡¹ç›®é…ç½®ä¿¡æ¯,ä¸è¦åˆ å®ƒ,åˆ«åŠ¨å®ƒ,å–„å¾…å®ƒ. åˆ›å»ºçˆ¬è™«çˆ¬è™«æ–‡ä»¶ï¼š\ncd project_nameï¼ˆè¿›å…¥é¡¹ç›®ç›®å½•ï¼‰ scrapy genspider çˆ¬è™«æ–‡ä»¶çš„åç§°ï¼ˆè‡ªå®šä¹‰ä¸€ä¸ªåå­—å³å¯ï¼‰ èµ·å§‹url ï¼ˆä¾‹å¦‚ï¼šscrapy genspider first www.xxx.comï¼‰ åˆ›å»ºæˆåŠŸåï¼Œä¼šåœ¨çˆ¬è™«æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªpyçš„çˆ¬è™«æ–‡ä»¶ ç¼–å†™çˆ¬è™«æ–‡ä»¶\nç†è§£çˆ¬è™«æ–‡ä»¶çš„ä¸åŒç»„æˆéƒ¨åˆ†\nimport scrapy class FirstSpider(scrapy.Spider): #çˆ¬è™«åç§°ï¼šçˆ¬è™«æ–‡ä»¶å”¯ä¸€æ ‡è¯†ï¼šå¯ä»¥ä½¿ç”¨è¯¥å˜é‡çš„å€¼æ¥å®šä½åˆ°å”¯ä¸€çš„ä¸€ä¸ªçˆ¬è™«æ–‡ä»¶ name = 'first' #æ— éœ€æ”¹åŠ¨ #å…è®¸çš„åŸŸåï¼šscrapyåªå¯ä»¥å‘èµ·ç™¾åº¦åŸŸåä¸‹çš„ç½‘ç»œè¯·æ±‚ # allowed_domains = ['www.baidu.com'] #èµ·å§‹çš„urlåˆ—è¡¨ï¼šåˆ—è¡¨ä¸­å­˜æ”¾çš„urlå¯ä»¥è¢«scrapyå‘èµ·getè¯·æ±‚ start_urls = ['https://www.baidu.com/','https://www.sogou.com'] #ä¸“é—¨ç”¨ä½œäºæ•°æ®è§£æ #å‚æ•°responseï¼šå°±æ˜¯è¯·æ±‚ä¹‹åå¯¹åº”çš„å“åº”å¯¹è±¡ #parseçš„è°ƒç”¨æ¬¡æ•°ï¼Œå–å†³äºstart_urlsåˆ—è¡¨å…ƒç´ çš„ä¸ªæ•° def parse(self, response): print('å“åº”å¯¹è±¡ä¸ºï¼š',response) é…ç½®æ–‡ä»¶ä¿®æ”¹:settings.py\nä¸éµä»robotsåè®®ï¼šROBOTSTXT_OBEY = False æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç±»å‹ï¼šLOG_LEVEL = â€˜ERRORâ€™ æŒ‡å®šUAï¼šUSER_AGENT = â€˜Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36â€™ è¿è¡Œé¡¹ç›®\nscrapy crawl çˆ¬è™«åç§° ï¼šè¯¥ç§æ‰§è¡Œå½¢å¼ä¼šæ˜¾ç¤ºæ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼ˆæ¨èï¼‰ scrapy crawl çˆ¬è™«åç§° --nologï¼šè¯¥ç§æ‰§è¡Œå½¢å¼ä¸ä¼šæ˜¾ç¤ºæ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰ æ•°æ®è§£æ æ³¨æ„ï¼Œå¦‚æœç»ˆç«¯è¿˜åœ¨ç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™éœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œcd ../è¿”å›åˆ°ä¸Šçº§ç›®å½•ï¼Œåœ¨å»æ–°å»ºå¦ä¸€ä¸ªé¡¹ç›®ã€‚\næ–°å»ºæ•°æ®è§£æé¡¹ç›®ï¼š\nåˆ›å»ºå·¥ç¨‹ï¼šscrapy startproject é¡¹ç›®åç§° cd é¡¹ç›®åç§° åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼šscrapy genspider çˆ¬è™«æ–‡ä»¶å www.xxx.com é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼šsettings.py\nä¸éµä»robotsåè®®ï¼šROBOTSTXT_OBEY = False æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç±»å‹ï¼šLOG_LEVEL = â€˜ERRORâ€™ æŒ‡å®šUAï¼šUSER_AGENT = â€˜Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36â€™ ç¼–å†™çˆ¬è™«æ–‡ä»¶ï¼šspiders/duanzi.py\nimport scrapy class DuanziSpider(scrapy.Spider): name = 'duanzi' # allowed_domains = ['www.xxx.com'] #å¯¹é¦–é¡µè¿›è¡Œç½‘ç»œè¯·æ±‚ #scrapyä¼šå¯¹åˆ—è¡¨ä¸­çš„urlå‘èµ·getè¯·æ±‚ start_urls = ['https://ishuo.cn/duanzi'] def parse(self, response): #å¦‚ä½•è·å–å“åº”æ•°æ® #è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ li_list = response.xpath('//*[@id=\"list\"]/ul/li') for li in li_list: # content = li.xpath('./div[1]/text()')[0] # title = li.xpath('./div[2]/a/text()')[0] # # # print(title)#selectorçš„å¯¹è±¡ï¼Œä¸”æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²å†…å®¹å­˜åœ¨äºè¯¥å¯¹è±¡çš„dataå‚æ•°é‡Œ #è§£ææ–¹æ¡ˆ1ï¼š # title = li.xpath('./div[2]/a/text()')[0] # content = li.xpath('./div[1]/text()')[0] # #extract()å¯ä»¥å°†selectorå¯¹è±¡ä¸­dataå‚æ•°çš„å€¼å–å‡º # print(title.extract()) # print(content.extract()) #è§£ææ–¹æ¡ˆ2ï¼š #titleå’Œcontentä¸ºåˆ—è¡¨ï¼Œåˆ—è¡¨åªè¦ä¸€ä¸ªåˆ—è¡¨å…ƒç´  title = li.xpath('./div[2]/a/text()') content = li.xpath('./div[1]/text()') #extract_first()å¯ä»¥å°†åˆ—è¡¨ä¸­ç¬¬0ä¸ªåˆ—è¡¨å…ƒç´ è¡¨ç¤ºçš„selectorå¯¹è±¡ä¸­dataçš„å‚æ•°å€¼å–å‡º print(title.extract_first()) print(content.extract_first()) æŒä¹…åŒ–å­˜å‚¨ ä¸¤ç§æ–¹æ¡ˆï¼š\nåŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨ åŸºäºç®¡é“çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆæ¨èï¼‰ åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨ åªå¯ä»¥å°†parseæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°æŒ‡å®šåç¼€çš„æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚\nç¼–ç æµç¨‹ï¼š\nåœ¨çˆ¬è™«æ–‡ä»¶ä¸­ï¼Œå°†çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨å°è£…åˆ°parseæ–¹æ³•çš„è¿”å›å€¼ä¸­\nimport scrapy class DemoSpider(scrapy.Spider): name = 'demo' # allowed_domains = ['www.xxx.com'] start_urls = ['https://ishuo.cn/duanzi'] def parse(self, response): # å¦‚ä½•è·å–å“åº”æ•°æ® # è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ li_list = response.xpath('//*[@id=\"list\"]/ul/li') all_data = []#çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­ for li in li_list: title = li.xpath('./div[2]/a/text()').extract_first() content = li.xpath('./div[1]/text()').extract_first() #å°†æ®µå­æ ‡é¢˜å’Œå†…å®¹å°è£…æˆparseæ–¹æ³•çš„è¿”å› dic = { 'title':title, 'content':content } all_data.append(dic) return all_data å°†parseæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°æŒ‡å®šåç¼€çš„æ–‡æœ¬æ–‡ä»¶ä¸­:\nscrapy crawl çˆ¬è™«æ–‡ä»¶åç§° -o duanzi.csv æ€»ç»“ï¼š\nä¼˜ç‚¹ï¼šç®€å•ï¼Œä¾¿æ· ç¼ºç‚¹ï¼šå±€é™æ€§å¼º åªå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°æ–‡æœ¬æ–‡ä»¶æ— æ³•å†™å…¥æ•°æ®åº“ å­˜å‚¨æ•°æ®æ–‡ä»¶åç¼€æ˜¯æŒ‡å®šå¥½çš„ï¼Œé€šå¸¸ä½¿ç”¨.csv éœ€è¦å°†å­˜å‚¨çš„æ•°æ®å°è£…åˆ°parseæ–¹æ³•çš„è¿”å›å€¼ä¸­ åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨ ä¼˜ç‚¹ï¼šæå¤§ç¨‹åº¦çš„æå‡æ•°æ®å­˜å‚¨çš„æ•ˆç‡\nç¼ºç‚¹ï¼šç¼–ç æµç¨‹è¾ƒå¤š\nç¼–ç æµç¨‹ 1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œæ•°æ®è§£æ\ndef parse(self, response): # å¦‚ä½•è·å–å“åº”æ•°æ® # è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ li_list = response.xpath('//*[@id=\"list\"]/ul/li') all_data = [] # çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­ for li in li_list: title = li.xpath('./div[2]/a/text()').extract_first() content = li.xpath('./div[1]/text()').extract_first() 2.å°†è§£æåˆ°çš„æ•°æ®å°è£…åˆ°Itemç±»å‹çš„å¯¹è±¡ä¸­\n2.1 åœ¨items.pyæ–‡ä»¶ä¸­å®šä¹‰ç›¸å…³çš„å­—æ®µ\nclass SavedataproItem(scrapy.Item): # define the fields for your item here like: # name = scrapy.Field() #çˆ¬å–çš„å­—æ®µæœ‰å“ªäº›ï¼Œè¿™é‡Œå°±éœ€è¦å®šä¹‰å“ªäº›å˜é‡å­˜å‚¨çˆ¬å–åˆ°çš„å­—æ®µ title = scrapy.Field() content = scrapy.Field() 2.2 åœ¨çˆ¬è™«æ–‡ä»¶ä¸­å¼•å…¥Itemç±»ï¼Œå®ä¾‹åŒ–itemå¯¹è±¡ï¼Œå°†è§£æåˆ°çš„æ•°æ®å­˜å‚¨åˆ°itemå¯¹è±¡ä¸­\ndef parse(self, response): from items import SavedataproItem #å¯¼å…¥itemç±» # å¦‚ä½•è·å–å“åº”æ•°æ® # è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ li_list = response.xpath('//*[@id=\"list\"]/ul/li') all_data = [] # çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­ for li in li_list: title = li.xpath('./div[2]/a/text()').extract_first() content = li.xpath('./div[1]/text()').extract_first() #å®ä¾‹åŒ–ä¸€ä¸ªitemç±»å‹çš„å¯¹è±¡ item = SavedataproItem() #é€šè¿‡ä¸­æ‹¬å·çš„æ–¹å¼è®¿é—®itemå¯¹è±¡ä¸­çš„ä¸¤ä¸ªæˆå‘˜ï¼Œä¸”å°†è§£æåˆ°çš„ä¸¤ä¸ªå­—æ®µèµ‹å€¼ç»™itemå¯¹è±¡çš„ä¸¤ä¸ªæˆå‘˜å³å¯ item['title'] = title item['content'] = content 3.å°†itemå¯¹è±¡æäº¤ç»™ç®¡é“\n#å°†å­˜å‚¨å¥½æ•°æ®çš„itemå¯¹è±¡æäº¤ç»™ç®¡é“ yield item 4.åœ¨ç®¡é“ä¸­æ¥æ”¶itemç±»å‹å¯¹è±¡(pipelines.pyå°±æ˜¯ç®¡é“æ–‡ä»¶)\nç®¡é“åªå¯ä»¥æ¥æ”¶itemç±»å‹çš„å¯¹è±¡ï¼Œä¸å¯ä»¥æ¥æ”¶å…¶ä»–ç±»å‹å¯¹è±¡\nclass SavedataproPipeline: #process_itemç”¨æ¥æ¥æ”¶çˆ¬è™«æ–‡ä»¶ä¼ é€’è¿‡æ¥çš„itemå¯¹è±¡ #itemå‚æ•°ï¼Œå°±æ˜¯ç®¡é“æ¥æ”¶åˆ°çš„itemç±»å‹å¯¹è±¡ def process_item(self, item, spider): print(item) return item 5.åœ¨ç®¡é“ä¸­å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œä»»æ„å½¢å¼çš„æŒä¹…åŒ–å­˜å‚¨æ“ä½œ\nå¯ä»¥å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥å­˜å‚¨åˆ°æ•°æ®åº“ä¸­\n# Define your item pipelines here # # Don't forget to add your pipeline to the ITEM_PIPELINES setting # See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html # useful for handling different item types with a single interface from itemadapter import ItemAdapter class SavedataproPipeline: #é‡å†™çˆ¶ç±»çš„æ–¹æ³• fp = None def open_spider(self,spider): print('æˆ‘æ˜¯open_spideræ–¹æ³•ï¼Œæˆ‘åœ¨é¡¹ç›®å¼€å§‹è¿è¡Œç¯èŠ‚ï¼Œåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼') self.fp = open('duanzi.txt','w',encoding='utf-8') #process_itemç”¨æ¥æ¥æ”¶çˆ¬è™«æ–‡ä»¶ä¼ é€’è¿‡æ¥çš„itemå¯¹è±¡ #itemå‚æ•°ï¼Œå°±æ˜¯ç®¡é“æ¥æ”¶åˆ°çš„itemç±»å‹å¯¹è±¡ #process_itemæ–¹æ³•è°ƒç”¨çš„æ¬¡æ•°å–å†³äºçˆ¬è™«æ–‡ä»¶ç»™å…¶æäº¤itemçš„æ¬¡æ•° def process_item(self, item, spider): #itemç±»å‹çš„å¯¹è±¡å…¶å®å°±æ˜¯ä¸€ä¸ªå­—å…¸ # print(item) #å°†itemå­—å…¸ä¸­çš„æ ‡é¢˜å’Œå†…å®¹è·å– title = item['title'] content = item['content'] self.fp.write(title+':'+content+'\\n') print(title,':çˆ¬å–ä¿å­˜æˆåŠŸï¼') return item def close_spider(self,spider): print('åœ¨çˆ¬è™«ç»“æŸçš„æ—¶å€™ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼') self.fp.close() 6.åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç®¡é“æœºåˆ¶\næ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡é“æœºåˆ¶æ˜¯æ²¡æœ‰è¢«å¼€å¯çš„ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨å¼€å¯ åœ¨setting.pyä¸­æŠŠITEM_PIPELINESè§£é™¤æ³¨é‡Šå°±è¡¨ç¤ºå¼€å¯äº†ç®¡é“æœºåˆ¶ ç®¡é“æ·±å…¥æ“ä½œ å¦‚ä½•å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“\næ³¨æ„ï¼šä¸€ä¸ªç®¡é“ç±»è´Ÿè´£å°†æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªå…·ä½“çš„è½½ä½“ä¸­ã€‚å¦‚æœæƒ³è¦å°†çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªä¸åŒçš„è½½ä½“/æ•°æ®åº“ä¸­ï¼Œåˆ™éœ€è¦å®šä¹‰å¤šä¸ªç®¡é“ç±»ã€‚ æ€è€ƒï¼š\nåœ¨æœ‰å¤šä¸ªç®¡é“ç±»çš„å‰æä¸‹ï¼Œçˆ¬è™«æ–‡ä»¶æäº¤çš„itemä¼šåŒæ—¶ç»™æ²¡ä¸€ä¸ªç®¡é“ç±»è¿˜æ˜¯å•ç‹¬çš„ç®¡é“ç±»ï¼Ÿ çˆ¬è™«æ–‡ä»¶åªä¼šå°†itemæäº¤ç»™ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸€ä¸ªç®¡é“ç±»ã€‚ä¼˜å…ˆçº§æœ€é«˜çš„ç®¡é“ç±»çš„process_itemä¸­éœ€è¦å†™return itemæ“ä½œï¼Œè¯¥æ“ä½œå°±æ˜¯è¡¨ç¤ºå°†itemå¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±»ï¼Œä¸‹ä¸€ä¸ªç®¡é“ç±»è·å–äº†itemå¯¹è±¡ï¼Œæ‰å¯ä»¥å°†æ•°æ®å­˜å‚¨æˆåŠŸï¼ ç®¡é“ç±»ï¼š\n# Define your item pipelines here # # Don't forget to add your pipeline to the ITEM_PIPELINES setting # See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html # useful for handling different item types with a single interface from itemadapter import ItemAdapter import pymysql import redis import pymongo #è´Ÿè´£å°†æ•°æ®å­˜å‚¨åˆ°mysqlä¸­ class MysqlPipeline: conn = None #mysqlçš„é“¾æ¥å¯¹è±¡ cursor = None def open_spider(self,spider): self.conn = pymysql.Connect( host = '127.0.0.1', port = 3306, user = 'root', password = 'boboadmin', db = 'spider3qi', charset = 'utf8' ) self.cursor = self.conn.cursor() #çˆ¬è™«æ–‡ä»¶æ¯å‘ç®¡é“æäº¤ä¸€ä¸ªitemï¼Œåˆ™process_itemæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ def process_item(self, item, spider): title = item['title'] sql = 'insert into xiaoshuo (title) values (\"%s\")'%title self.cursor.execute(sql) self.conn.commit() print('æˆåŠŸå†™å…¥ä¸€æ¡æ•°æ®ï¼') return item def close_spider(self,spider): self.cursor.close() self.conn.close() #å°†æ•°æ®æŒä¹…åŒ–å­˜å‚¨åˆ°redisä¸­ class RedisPipeLine: conn = None def open_spider(self,spider): #åœ¨é“¾æ¥å‰åŠ¡å¿…æ‰‹åŠ¨å¯åŠ¨redisçš„æœåŠ¡ self.conn = redis.Redis( host='127.0.0.1', port=6379 ) def process_item(self,item,spider): #æ³¨æ„ï¼šå¦‚æœæƒ³è¦å°†ä¸€ä¸ªpythonå­—å…¸ç›´æ¥å†™å…¥åˆ°redisä¸­ï¼Œåˆ™redisæ¨¡å—çš„ç‰ˆæœ¬åŠ¡å¿…æ˜¯2.10.6 #å¦‚æœredisæ¨¡å—çš„ç‰ˆæœ¬ä¸æ˜¯2.10.6åˆ™é‡æ–°å®‰è£…ï¼špip install redis==2.10.6 self.conn.lpush('xiaoshuo',item) print('æ•°æ®å­˜å‚¨redisæˆåŠŸï¼') return item class MongoPipeline: conn = None #é“¾æ¥å¯¹è±¡ db_sanqi = None #æ•°æ®ä»“åº“ def open_spider(self,spider): self.conn = pymongo.MongoClient( host='127.0.0.1', port=27017 ) self.db_sanqi = self.conn['sanqi'] def process_item(self,item,spider): self.db_sanqi['xiaoshuo'].insert_one({'title':item['title']}) print('æ’å…¥æˆåŠŸï¼') return item é…ç½®æ–‡ä»¶ï¼š\nITEM_PIPELINES = { #æ•°å­—è¡¨ç¤ºç®¡é“ç±»è¢«æ‰§è¡Œçš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ 'xiaoshuoPro.pipelines.MysqlPipeline': 300, 'xiaoshuoPro.pipelines.RedisPipeLine': 301, 'xiaoshuoPro.pipelines.MongoPipeline': 302, } scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ® ä½¿ç”¨ä¸€ä¸ªä¸“æœ‰çš„ç®¡é“ç±»ImagesPipeline\nå…·ä½“çš„ç¼–ç æµç¨‹ï¼š\n1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œå›¾ç‰‡/è§†é¢‘çš„é“¾æ¥æå–\n2.å°†æå–åˆ°çš„é“¾æ¥å°è£…åˆ°itemså¯¹è±¡ä¸­ï¼Œæäº¤ç»™ç®¡é“\n3.åœ¨ç®¡é“æ–‡ä»¶ä¸­è‡ªå®šä¹‰ä¸€ä¸ªçˆ¶ç±»ä¸ºImagesPipelineçš„ç®¡é“ç±»ï¼Œä¸”é‡å†™ä¸‰ä¸ªæ–¹æ³•å³å¯ï¼š\ndef get_media_requests(self, item, info):æ¥æ”¶çˆ¬è™«æ–‡ä»¶æäº¤è¿‡æ¥çš„itemå¯¹è±¡ï¼Œç„¶åå¯¹å›¾ç‰‡åœ°å€å‘èµ·ç½‘è·¯è¯·æ±‚ï¼Œè¿”å›å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ® def file_path(self, request, response=None, info=None, *, item=None)ï¼šæŒ‡å®šä¿å­˜å›¾ç‰‡çš„åç§° def item_completed(self, results, item, info)ï¼šè¿”å›itemå¯¹è±¡ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±» 4.åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŒ‡å®šçš„ç®¡é“ï¼Œä¸”é€šè¿‡IMAGES_STORE = â€˜girlsLibâ€™æ“ä½œæŒ‡å®šå›¾ç‰‡å­˜å‚¨çš„æ–‡ä»¶å¤¹ã€‚\n# Define your item pipelines here # # Don't forget to add your pipeline to the ITEM_PIPELINES setting # See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html # useful for handling different item types with a single interface import scrapy from itemadapter import ItemAdapter from scrapy.pipelines.images import ImagesPipeline #è‡ªå®šä¹‰çš„ç®¡é“ç±»ä¸€å®šè¦ç»§æ‰¿ä¸ImagesPipeline class mediaPileline(ImagesPipeline): #é‡å†™ä¸‰ä¸ªçˆ¶ç±»çš„æ–¹æ³•æ¥å®Œæˆå›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®çš„è¯·æ±‚å’ŒæŒä¹…åŒ–å­˜å‚¨ #å¯ä»¥æ ¹æ®å›¾ç‰‡åœ°å€ï¼Œå¯¹å…¶è¿›è¡Œè¯·æ±‚ï¼Œè·å–å›¾ç‰‡æ•°æ® #å‚æ•°itemï¼šå°±æ˜¯æ¥æ”¶åˆ°çš„itemå¯¹è±¡ def get_media_requests(self, item, info): img_src = item['src'] yield scrapy.Request(img_src) #æŒ‡å®šå›¾ç‰‡çš„åç§°ï¼ˆåªéœ€è¦è¿”å›å›¾ç‰‡å­˜å‚¨çš„åç§°å³å¯ï¼‰ def file_path(self, request, response=None, info=None, *, item=None): imgName = request.url.split('/')[-1] print(imgName,'ä¸‹è½½ä¿å­˜æˆåŠŸï¼') return imgName #å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªç®¡é“ç±»ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¸å†™ def item_completed(self, results, item, info): return item #å¯ä»¥å°†å½“å‰çš„ç®¡é“ç±»æ¥æ”¶åˆ°itemå¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±»2. scrapyæ·±åº¦çˆ¬å– å¦‚ä½•çˆ¬å–å¤šé¡µçš„æ•°æ®ï¼ˆå…¨ç«™æ•°æ®çˆ¬å–ï¼‰\næ‰‹åŠ¨è¯·æ±‚å‘é€ï¼š\n#callbackç”¨æ¥æŒ‡å®šè§£ææ–¹æ³• yield scrapy.Request(url=new_url,callback=self.parse) å¦‚ä½•çˆ¬å–æ·±åº¦å­˜å‚¨çš„æ•°æ®\nä»€ä¹ˆæ˜¯æ·±åº¦ï¼Œè¯´ç™½äº†å°±æ˜¯çˆ¬å–çš„æ•°æ®æ²¡æœ‰å­˜åœ¨äºåŒä¸€å¼ é¡µé¢ä¸­ã€‚\nå¿…é¡»ä½¿ç”¨è¯·æ±‚ä¼ å‚çš„æœºåˆ¶æ‰å¯ä»¥å®Œæ•´çš„å®ç°ã€‚\nè¯·æ±‚ä¼ å‚ï¼š\nyield scrapy.Request(meta={},url=detail_url,callback=self.parse_detail) å¯ä»¥å°†metaå­—å…¸ä¼ é€’ç»™callbackè¿™ä¸ªå›è°ƒå‡½æ•° import scrapy from ..items import DeepproItem class DeepSpider(scrapy.Spider): name = 'deep' # allowed_domains = ['www.xxx.com'] start_urls = ['https://wz.sun0769.com/political/index/politicsNewest'] #è§£æé¦–é¡µæ•°æ® def parse(self, response): li_list = response.xpath('/html/body/div[2]/div[3]/ul[2]/li') for li in li_list: title = li.xpath('./span[3]/a/text()').extract_first() detail_url = 'https://wz.sun0769.com'+li.xpath('./span[3]/a/@href').extract_first() # print(title) item = DeepproItem() item['title'] = title #å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚ #å‚æ•°metaå¯ä»¥å°†è‡ªèº«è¿™ä¸ªå­—å…¸ä¼ é€’ç»™callbackæŒ‡å®šçš„å›è°ƒå‡½æ•° yield scrapy.Request(meta={'item':item},url=detail_url,callback=self.parse_detail) #è§£æè¯¦æƒ…é¡µæ•°æ® def parse_detail(self,response): meta = response.meta #æ¥æ”¶è¯·æ±‚ä¼ å‚è¿‡æ¥çš„metaå­—å…¸ item = meta['item'] content = response.xpath('/html/body/div[3]/div[2]/div[2]/div[2]//text()').extract() content = ''.join(content) # print(content) item['content'] = content yield item ImagePipeLinesçš„è¯·æ±‚ä¼ å‚ ç¯å¢ƒå®‰è£…ï¼špip install Pillow\nUSER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36' éœ€æ±‚ï¼šå°†å›¾ç‰‡çš„åç§°å’Œè¯¦æƒ…é¡µä¸­å›¾ç‰‡çš„æ•°æ®è¿›è¡Œçˆ¬å–ï¼ŒæŒä¹…åŒ–å­˜å‚¨ã€‚\nåˆ†æï¼š\næ·±åº¦çˆ¬å–ï¼šè¯·æ±‚ä¼ å‚ å¤šé¡µçš„æ•°æ®çˆ¬å–ï¼šæ‰‹åŠ¨è¯·æ±‚çš„å‘é€ çˆ¬è™«æ–‡ä»¶ï¼š\nimport scrapy from ..items import DeepimgproItem class ImgSpider(scrapy.Spider): name = 'img' # allowed_domains = ['www.xxx.com'] start_urls = ['https://pic.netbian.com/4kmeinv/'] #é€šç”¨çš„urlæ¨¡æ¿ url_model = 'https://pic.netbian.com/4kmeinv/index_%d.html' page_num = 2 def parse(self, response): #è§£æå‡ºäº†å›¾ç‰‡çš„åç§°å’Œè¯¦æƒ…é¡µçš„url li_list = response.xpath('//*[@id=\"main\"]/div[3]/ul/li') for li in li_list: title = li.xpath('./a/b/text()').extract_first() + '.jpg' detail_url = 'https://pic.netbian.com'+li.xpath('./a/@href').extract_first() item = DeepimgproItem() item['title'] = title #éœ€è¦å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚ï¼Œåœ¨è¯¦æƒ…é¡µä¸­è·å–å›¾ç‰‡çš„ä¸‹è½½é“¾æ¥ yield scrapy.Request(url=detail_url,callback=self.detail_parse,meta={'item':item}) if self.page_num \u003c= 2: new_url = format(self.url_model%self.page_num) self.page_num += 1 yield scrapy.Request(url=new_url,callback=self.parse) #è§£æè¯¦æƒ…é¡µçš„æ•°æ® def detail_parse(self,response): meta = response.meta item = meta['item'] img_src = 'https://pic.netbian.com'+response.xpath('//*[@id=\"img\"]/img/@src').extract_first() item['img_src'] = img_src yield item ç®¡é“ï¼š\n# Define your item pipelines here # # Don't forget to add your pipeline to the ITEM_PIPELINES setting # See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html # useful for handling different item types with a single interface import scrapy from itemadapter import ItemAdapter from scrapy.pipelines.images import ImagesPipeline class DeepimgproPipeline(ImagesPipeline): # def process_item(self, item, spider): # return item def get_media_requests(self, item, info): img_src = item['img_src'] #è¯·æ±‚ä¼ å‚ï¼Œå°†itemä¸­çš„å›¾ç‰‡åç§°ä¼ é€’ç»™file_pathæ–¹æ³• #metaä¼šå°†è‡ªèº«ä¼ é€’ç»™file_path print(item['title'],'ä¿å­˜ä¸‹è½½æˆåŠŸï¼') yield scrapy.Request(url=img_src,meta={'title':item['title']}) def file_path(self, request, response=None, info=None, *, item=None): #è¿”å›å›¾ç‰‡çš„åç§° #æ¥æ”¶è¯·æ±‚ä¼ å‚è¿‡æ¥çš„æ•°æ® title = request.meta['title'] return title def item_completed(self, results, item, info): return item å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡ å¢åŠ å¹¶å‘ï¼š é»˜è®¤scrapyå¼€å¯çš„å¹¶å‘çº¿ç¨‹ä¸º32ä¸ªï¼Œå¯ä»¥é€‚å½“è¿›è¡Œå¢åŠ ã€‚åœ¨settingsé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹CONCURRENT_REQUESTS = 100å€¼ä¸º100,å¹¶å‘è®¾ç½®æˆäº†ä¸º100ã€‚ é™ä½æ—¥å¿—çº§åˆ«ï¼š åœ¨è¿è¡Œscrapyæ—¶ï¼Œä¼šæœ‰å¤§é‡æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºï¼Œä¸ºäº†å‡å°‘CPUçš„ä½¿ç”¨ç‡ã€‚å¯ä»¥è®¾ç½®logè¾“å‡ºä¿¡æ¯ä¸ºWORNINGæˆ–è€…ERRORå³å¯ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šLOG_LEVEL = â€˜ERRORâ€™ ç¦æ­¢cookieï¼š å¦‚æœä¸æ˜¯çœŸçš„éœ€è¦cookieï¼Œåˆ™åœ¨scrapyçˆ¬å–æ•°æ®æ—¶å¯ä»¥ç¦æ­¢cookieä»è€Œå‡å°‘CPUçš„ä½¿ç”¨ç‡ï¼Œæå‡çˆ¬å–æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šCOOKIES_ENABLED = False ç¦æ­¢é‡è¯•ï¼š å¯¹å¤±è´¥çš„HTTPè¿›è¡Œé‡æ–°è¯·æ±‚ï¼ˆé‡è¯•ï¼‰ä¼šå‡æ…¢çˆ¬å–é€Ÿåº¦ï¼Œå› æ­¤å¯ä»¥ç¦æ­¢é‡è¯•ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šRETRY_ENABLED = False å‡å°‘ä¸‹è½½è¶…æ—¶ï¼š å¦‚æœå¯¹ä¸€ä¸ªéå¸¸æ…¢çš„é“¾æ¥è¿›è¡Œçˆ¬å–ï¼Œå‡å°‘ä¸‹è½½è¶…æ—¶å¯ä»¥èƒ½è®©å¡ä½çš„é“¾æ¥å¿«é€Ÿè¢«æ”¾å¼ƒï¼Œä»è€Œæå‡æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™ï¼šDOWNLOAD_TIMEOUT = 10 è¶…æ—¶æ—¶é—´ä¸º10s postè¯·æ±‚å‘é€ é—®é¢˜ï¼šåœ¨ä¹‹å‰ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»æ¥æ²¡æœ‰æ‰‹åŠ¨çš„å¯¹start_urlsåˆ—è¡¨ä¸­å­˜å‚¨çš„èµ·å§‹urlè¿›è¡Œè¿‡è¯·æ±‚çš„å‘é€ï¼Œä½†æ˜¯èµ·å§‹urlçš„ç¡®æ˜¯è¿›è¡Œäº†è¯·æ±‚çš„å‘é€ï¼Œé‚£è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ\nè§£ç­”ï¼šå…¶å®æ˜¯å› ä¸ºçˆ¬è™«æ–‡ä»¶ä¸­çš„çˆ¬è™«ç±»ç»§æ‰¿åˆ°äº†Spiderçˆ¶ç±»ä¸­çš„start_requestsï¼ˆselfï¼‰è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±å¯ä»¥å¯¹start_urlsåˆ—è¡¨ä¸­çš„urlå‘èµ·è¯·æ±‚ï¼š\ndef start_requests(self): for u in self.start_urls: yield scrapy.Request(url=u,callback=self.parse) ã€æ³¨æ„ã€‘è¯¥æ–¹æ³•é»˜è®¤çš„å®ç°ï¼Œæ˜¯å¯¹èµ·å§‹çš„urlå‘èµ·getè¯·æ±‚ï¼Œå¦‚æœæƒ³å‘èµ·postè¯·æ±‚ï¼Œåˆ™éœ€è¦å­ç±»é‡å†™è¯¥æ–¹æ³•ã€‚\nyield scrapy.Request():å‘èµ·getè¯·æ±‚ yield scrapy.FormRequest():å‘èµ·postè¯·æ±‚ import scrapy class FanyiSpider(scrapy.Spider): name = 'fanyi' # allowed_domains = ['www.xxx.com'] start_urls = ['https://fanyi.baidu.com/sug'] #çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯ç”¨æ¥ç»™èµ·å§‹çš„urlåˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªurlå‘è¯·æ±‚ def start_requests(self): data = { 'kw':'dog' } for url in self.start_urls: #formdataæ˜¯ç”¨æ¥æŒ‡å®šè¯·æ±‚å‚æ•° yield scrapy.FormRequest(url=url,callback=self.parse,formdata=data) def parse(self, response): result = response.json() print(result) scrapyçš„æ ¸å¿ƒç»„ä»¶ ä»ä¸­å¯ä»¥å¤§è‡´äº†è§£scrapyæ¡†æ¶çš„ä¸€ä¸ªè¿è¡Œæœºåˆ¶ - å¼•æ“(Scrapy) ç”¨æ¥å¤„ç†æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æµå¤„ç†, è§¦å‘äº‹åŠ¡(æ¡†æ¶æ ¸å¿ƒ) - è°ƒåº¦å™¨(Scheduler) ç”¨æ¥æ¥å—å¼•æ“å‘è¿‡æ¥çš„è¯·æ±‚, å‹å…¥é˜Ÿåˆ—ä¸­, å¹¶åœ¨å¼•æ“å†æ¬¡è¯·æ±‚çš„æ—¶å€™è¿”å›. å¯ä»¥æƒ³åƒæˆä¸€ä¸ªURLï¼ˆæŠ“å–ç½‘é¡µçš„ç½‘å€æˆ–è€…è¯´æ˜¯é“¾æ¥ï¼‰çš„ä¼˜å…ˆé˜Ÿåˆ—, ç”±å®ƒæ¥å†³å®šä¸‹ä¸€ä¸ªè¦æŠ“å–çš„ç½‘å€æ˜¯ä»€ä¹ˆ, åŒæ—¶å»é™¤é‡å¤çš„ç½‘å€ - ä¸‹è½½å™¨(Downloader) ç”¨äºä¸‹è½½ç½‘é¡µå†…å®¹, å¹¶å°†ç½‘é¡µå†…å®¹è¿”å›ç»™èœ˜è››(Scrapyä¸‹è½½å™¨æ˜¯å»ºç«‹åœ¨twistedè¿™ä¸ªé«˜æ•ˆçš„å¼‚æ­¥æ¨¡å‹ä¸Šçš„) - çˆ¬è™«(Spiders) çˆ¬è™«æ˜¯ä¸»è¦å¹²æ´»çš„, ç”¨äºä»ç‰¹å®šçš„ç½‘é¡µä¸­æå–è‡ªå·±éœ€è¦çš„ä¿¡æ¯, å³æ‰€è°“çš„å®ä½“(Item)ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥ä»ä¸­æå–å‡ºé“¾æ¥,è®©Scrapyç»§ç»­æŠ“å–ä¸‹ä¸€ä¸ªé¡µé¢ - é¡¹ç›®ç®¡é“(Pipeline) è´Ÿè´£å¤„ç†çˆ¬è™«ä»ç½‘é¡µä¸­æŠ½å–çš„å®ä½“ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æŒä¹…åŒ–å®ä½“ã€éªŒè¯å®ä½“çš„æœ‰æ•ˆæ€§ã€æ¸…é™¤ä¸éœ€è¦çš„ä¿¡æ¯ã€‚å½“é¡µé¢è¢«çˆ¬è™«è§£æåï¼Œå°†è¢«å‘é€åˆ°é¡¹ç›®ç®¡é“ï¼Œå¹¶ç»è¿‡å‡ ä¸ªç‰¹å®šçš„æ¬¡åºå¤„ç†æ•°æ®ã€‚ ä¸­é—´ä»¶ scrapyçš„ä¸­é—´ä»¶æœ‰ä¸¤ä¸ªï¼š\nçˆ¬è™«ä¸­é—´ä»¶ ä¸‹è½½ä¸­é—´ä»¶ ä¸­é—´ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ è§‚æµ‹ä¸­é—´ä»¶åœ¨äº”å¤§æ ¸å¿ƒç»„ä»¶çš„ä»€ä¹ˆä½ç½®ï¼Œæ ¹æ®ä½ç½®äº†è§£ä¸­é—´ä»¶çš„ä½œç”¨ ä¸‹è½½ä¸­é—´ä»¶ä½äºå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´ å¼•æ“ä¼šç»™ä¸‹è½½å™¨ä¼ é€’è¯·æ±‚å¯¹è±¡ï¼Œä¸‹è½½å™¨ä¼šç»™å¼•æ“è¿”å›å“åº”å¯¹è±¡ã€‚ ä½œç”¨ï¼šå¯ä»¥æ‹¦æˆªåˆ°scrapyæ¡†æ¶ä¸­æ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”ã€‚ æ‹¦æˆªè¯·æ±‚å¹²ä»€ä¹ˆï¼Ÿ ä¿®æ”¹è¯·æ±‚çš„ipï¼Œä¿®æ”¹è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œè®¾ç½®è¯·æ±‚çš„cookie æ‹¦æˆªå“åº”å¹²ä»€ä¹ˆï¼Ÿ å¯ä»¥ä¿®æ”¹å“åº”æ•°æ® ä¸­é—´ä»¶é‡è¦æ–¹æ³•ï¼š\n# Define here the models for your spider middleware # # See documentation in: # https://docs.scrapy.org/en/latest/topics/spider-middleware.html from scrapy import signals # useful for handling different item types with a single interface from itemadapter import is_item, ItemAdapter class MiddleproDownloaderMiddleware: #ç±»æ–¹æ³•ï¼šä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªä¸‹è½½å™¨å¯¹è±¡ï¼ˆå¿½ç•¥ï¼‰ @classmethod def from_crawler(cls, crawler): # This method is used by Scrapy to create your spiders. s = cls() crawler.signals.connect(s.spider_opened, signal=signals.spider_opened) return s #æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡ #å‚æ•°ï¼šrequestå°±æ˜¯æ‹¦æˆªåˆ°çš„è¯·æ±‚å¯¹è±¡ï¼Œspiderçˆ¬è™«æ–‡ä»¶ä¸­çˆ¬è™«ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ #spiderå‚æ•°çš„ä½œç”¨å¯ä»¥å®ç°çˆ¬è™«ç±»å’Œä¸­é—´ç±»çš„æ•°æ®äº¤äº’ def process_request(self, request, spider): return None #æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„å“åº”å¯¹è±¡ #å‚æ•°ï¼šresponseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡ï¼Œrequestå°±æ˜¯è¢«æ‹¦æˆªåˆ°å“åº”å¯¹è±¡å¯¹åº”çš„å”¯ä¸€çš„ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ def process_response(self, request, response, spider): return response #æ‹¦æˆªå’Œå¤„ç†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡ #å‚æ•°ï¼šreqeustå°±æ˜¯æ‹¦æˆªåˆ°çš„å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡ def process_exception(self, request, exception, spider): pass #æ§åˆ¶æ—¥å¿—æ•°æ®çš„ï¼ˆå¿½ç•¥ï¼‰ def spider_opened(self, spider): spider.logger.info('Spider opened: %s' % spider.name) å¼€å‘ä»£ç†ä¸­é—´ä»¶ request.meta[â€˜proxyâ€™] = proxy\n# Define here the models for your spider middleware # # See documentation in: # https://docs.scrapy.org/en/latest/topics/spider-middleware.html from scrapy import signals # useful for handling different item types with a single interface from itemadapter import is_item, ItemAdapter from scrapy import Request class MiddleproDownloaderMiddleware: #ç±»æ–¹æ³•ï¼šä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªä¸‹è½½å™¨å¯¹è±¡ï¼ˆå¿½ç•¥ï¼‰ @classmethod def from_crawler(cls, crawler): # This method is used by Scrapy to create your spiders. s = cls() crawler.signals.connect(s.spider_opened, signal=signals.spider_opened) return s #æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡ #å‚æ•°ï¼šrequestå°±æ˜¯æ‹¦æˆªåˆ°çš„è¯·æ±‚å¯¹è±¡ï¼Œspiderçˆ¬è™«æ–‡ä»¶ä¸­çˆ¬è™«ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ #spiderå‚æ•°çš„ä½œç”¨å¯ä»¥å®ç°çˆ¬è™«ç±»å’Œä¸­é—´ç±»çš„æ•°æ®äº¤äº’ def process_request(self, request, spider): #æ˜¯çš„æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç”¨ä»£ç†ï¼Œåˆ™ä»£ç†æ“ä½œå¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­ request.meta['proxy'] = 'http://ip:port' #å¼Šç«¯ï¼šä¼šä½¿å¾—æ•´ä½“çš„è¯·æ±‚æ•ˆç‡å˜ä½ print(request.url+':è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼') return None #æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„å“åº”å¯¹è±¡ #å‚æ•°ï¼šresponseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡ï¼Œrequestå°±æ˜¯è¢«æ‹¦æˆªåˆ°å“åº”å¯¹è±¡å¯¹åº”çš„å”¯ä¸€çš„ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ def process_response(self, request, response, spider): print(request.url+':å“åº”å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼') return response #æ‹¦æˆªå’Œå¤„ç†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡ #å‚æ•°ï¼šreqeustå°±æ˜¯æ‹¦æˆªåˆ°çš„å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡ #æ–¹æ³•å­˜åœ¨çš„æ„ä¹‰ï¼šå°†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚æ‹¦æˆªåˆ°ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¿®æ­£ def process_exception(self, request, exception, spider): print(request.url+':å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡è¢«æ‹¦æˆªåˆ°ï¼') #ä¿®æ­£æ“ä½œ #åªæœ‰å‘ç”Ÿäº†å¼‚å¸¸çš„è¯·æ±‚æ‰ä½¿ç”¨ä»£ç†æœºåˆ¶ï¼Œåˆ™å¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­ request.meta['proxy'] = 'https://ip:port' return request #å¯¹è¯·æ±‚å¯¹è±¡è¿›è¡Œé‡æ–°å‘é€ #æ§åˆ¶æ—¥å¿—æ•°æ®çš„ï¼ˆå¿½ç•¥ï¼‰ def spider_opened(self, spider): spider.logger.info('Spider opened: %s' % spider.name) å¼€å‘UAä¸­é—´ä»¶ request.headers[â€˜User-Agentâ€™] = ua\ndef process_request(self, request, spider): request.headers['User-Agent'] = 'ä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªUAå€¼' print(request.url+':è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼') return None å¼€å‘Cookieä¸­é—´ä»¶ request.cookies = cookies\ndef process_request(self, request, spider): request.headers['cookie'] = 'xxx' #request.cookies = 'xxx' print(request.url+':è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼') return None selenium+scrapy éœ€æ±‚ï¼šå°†ç½‘æ˜“æ–°é—»ä¸­çš„å›½å†…ï¼Œå›½é™…ï¼Œå†›äº‹ï¼Œèˆªç©ºå››ä¸ªæ¿å—ä¸‹çš„æ–°é—»æ ‡é¢˜å’Œå†…å®¹è¿›è¡Œæ•°æ®çˆ¬å–\næ³¨æ„ï¼šå“ªäº›æ•°æ®æ˜¯åŠ¨æ€åŠ è½½çš„ï¼ æŠ€æœ¯ï¼šseleniumï¼Œscrapyï¼Œä¸­é—´ä»¶ åˆ†æï¼š\næŠ“å–é¦–é¡µä¸­å››ä¸ªæ¿å—ä¸‹æ‰€æœ‰çš„æ–°é—»æ ‡é¢˜å’Œæ–°é—»å†…å®¹ è·å–é¦–é¡µä¸­å››ä¸ªæ¿å—å¯¹åº”çš„è¯¦æƒ…é¡µé“¾æ¥ é¦–é¡µæ˜¯æ²¡æœ‰åŠ¨æ€åŠ è½½æ•°æ®ï¼Œå¯ä»¥ç›´æ¥çˆ¬å–+è§£æ å¯¹æ¯ä¸€ä¸ªæ¿å—çš„urlå‘èµ·è¯·æ±‚ï¼Œè·å–è¯¦æƒ…é¡µä¸­çš„æ–°é—»æ ‡é¢˜ç­‰å†…å®¹ é€šè¿‡åˆ†æå‘ç°æ¯ä¸€ä¸ªæ¿å—ä¸­çš„æ–°é—»æ•°æ®å…¨éƒ¨æ˜¯åŠ¨æ€åŠ è½½çš„æ•°æ®ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ é€šè¿‡seleniumè§£å†³ scrapy+seleniumçš„ç¼–ç æµç¨‹\n1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­å®šä¹‰æµè§ˆå™¨å¯¹è±¡ï¼Œå°†æµè§ˆå™¨å¯¹è±¡ä½œä¸ºçˆ¬è™«ç±»çš„ä¸€ä¸ªæˆå‘˜å˜é‡ 2.åœ¨ä¸­é—´ä»¶ä¸­é€šè¿‡spiderè·å–çˆ¬è™«æ–‡ä»¶ä¸­å®šä¹‰çš„æµè§ˆå™¨å¯¹è±¡ï¼Œè¿›è¡Œè¯·æ±‚å‘é€å’Œè·å–å“åº”æ•°æ® 3.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­é‡å†™ä¸€ä¸ªclosedæ–¹æ³•ï¼Œæ¥å…³é—­æµè§ˆå™¨å¯¹è±¡ çˆ¬è™«æ–‡ä»¶\nimport scrapy from ..items import WangyiproItem from selenium import webdriver class WangyiSpider(scrapy.Spider): name = 'wangyi' # allowed_domains = ['www.xxx.com'] start_urls = ['https://news.163.com/'] #åˆ›å»ºæµè§ˆå™¨å¯¹è±¡ï¼ŒæŠŠæµè§ˆå™¨å¯¹è±¡ä½œä¸ºçˆ¬è™«ç±»çš„ä¸€ä¸ªæˆå‘˜ bro = webdriver.Chrome(executable_path='/Users/zhangxiaobo/Desktop/ä¸‰æœŸ/chromedriver1') model_urls = [] #å­˜å‚¨4ä¸ªæ¿å—å¯¹åº”çš„url def parse(self, response): #ä»é¦–é¡µè§£ææ¯ä¸€ä¸ªæ¿å—å¯¹åº”è¯¦æƒ…é¡µçš„urlï¼Œå°†å…¶å­˜å‚¨åˆ°model_urlsåˆ—è¡¨ä¸­ model_index = [2,3,5,6] li_list = response.xpath('//*[@id=\"index2016_wrap\"]/div[3]/div[2]/div[2]/div[2]/div/ul/li') for index in model_index: model_url = li_list[index].xpath('./a/@href').extract_first() self.model_urls.append(model_url) #åº”è¯¥å¯¹æ¯ä¸€ä¸ªæ¿å—çš„è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ for model_url in self.model_urls: yield scrapy.Request(url=model_url,callback=self.parse_detail) #ç›®çš„æ˜¯ä¸ºäº†è§£æå‡ºæ¯ä¸€ä¸ªæ¿å—ä¸­çš„æ–°é—»æ ‡é¢˜å’Œæ–°é—»è¯¦æƒ…é¡µçš„url def parse_detail(self,response): #responseå°±æ˜¯ä¸€ä¸ªä¸ç¬¦åˆéœ€æ±‚è¦æ±‚çš„å“åº”å¯¹è±¡ #è¯¥responseä¸­æ²¡æœ‰å­˜å‚¨åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®ï¼Œå› æ­¤è¯¥å“åº”å¯¹è±¡è¢«è§†ä¸ºä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡ #éœ€è¦å°†ä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡å˜ä¸ºç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡å³å¯ï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ #æ–¹æ³•ï¼šç¯¡æ”¹ä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡çš„å“åº”æ•°æ®ï¼Œå°†è¯¥å“åº”å¯¹è±¡çš„å“åº”æ•°æ®ä¿®æ”¹ä¸ºåŒ…å«äº†åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®å³å¯ã€‚ div_list = response.xpath('/html/body/div/div[3]/div[4]/div[1]/div[1]/div/ul/li/div/div') for div in div_list: try: #è§£ææ–°é—»æ ‡é¢˜+æ–°é—»è¯¦æƒ…é¡µçš„url title = div.xpath('./div/div[1]/h3/a/text()').extract_first() new_detail_url = div.xpath('./div/div[1]/h3/a/@href').extract_first() item = WangyiproItem() item['title'] = title except Exception as e: print('é‡åˆ°äº†å¹¿å‘Šï¼Œå¿½ç•¥æ­¤æ¬¡è¡Œä¸ºå³å¯ï¼') #å¯¹æ–°é—»çš„è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚ if new_detail_url != None: yield scrapy.Request(url=new_detail_url,callback=self.new_content_parse,meta={'item':item}) def new_content_parse(self,response): item = response.meta['item'] #è§£ææ–°é—»çš„è¯¦æƒ…å†…å®¹ content = response.xpath('//*[@id=\"content\"]/div[2]//text()').extract() content = ''.join(content).strip() item['content'] = content yield item #é‡å†™ä¸€ä¸ªçˆ¶ç±»æ–¹æ³•ï¼Œclose_spiderï¼Œè¯¥æ–¹æ³•åªä¼šåœ¨çˆ¬è™«æœ€åæ‰§è¡Œä¸€æ¬¡ def closed(self,spider): #å…³é—­æµè§ˆå™¨ print('å…³é—­æµè§ˆå™¨æˆåŠŸï¼') self.bro.quit() ä¸­é—´ä»¶æ–‡ä»¶ï¼š\n# Define here the models for your spider middleware # # See documentation in: # https://docs.scrapy.org/en/latest/topics/spider-middleware.html import requests from scrapy import signals # useful for handling different item types with a single interface from itemadapter import is_item, ItemAdapter from time import sleep from scrapy.http import HtmlResponse#scrapyå°è£…çš„å“åº”å¯¹è±¡å¯¹åº”çš„ç±» class WangyiproDownloaderMiddleware: def process_request(self, request, spider): return None def process_response(self, request, response, spider): #å¯ä»¥æ‹¦æˆªåˆ°æ‰€æœ‰çš„å“åº”å¯¹è±¡ #å½“å‰é¡¹ç›®ä¸€å…±ä¼šäº§ç”Ÿå¤šå°‘ä¸ªå“åº”å¯¹è±¡å‘¢ï¼Ÿ #1 + 4 + nä¸ªå“åº”å¯¹è±¡ï¼Œåœ¨è¿™äº›å“åº”å¯¹è±¡ä¸­åªæœ‰4è¿™4ä¸ªå“åº”å¯¹è±¡éœ€è¦è¢«ä¿®æ”¹ #å¦‚ä½•ç­›é€‰å‡ºæŒ‡å®šçš„4ä¸ªæ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡å‘¢ï¼Ÿ #1.å¯ä»¥å…ˆæ‰¾å‡ºæŒ‡å®š4ä¸ªæ¿å—çš„è¯·æ±‚å¯¹è±¡ï¼Œç„¶åæ ¹æ®è¯·æ±‚å¯¹è±¡å®šä½æŒ‡å®š4ä¸ªå“åº”å¯¹è±¡ #2.å¯ä»¥æ ¹æ®4ä¸ªæ¿å—çš„urlå®šä½åˆ°å››ä¸ªæ¿å—çš„è¯·æ±‚å¯¹è±¡ model_urls = spider.model_urls if request.url in model_urls: bro = spider.bro #ä»çˆ¬è™«ç±»ä¸­è·å–åˆ›å»ºå¥½çš„æµè§ˆå™¨å¯¹è±¡ bro.get(request.url) sleep(1) # bro.execute_script('document.documentElement.scrollTo(0,9000)') # sleep(1) #è·å–åŠ¨æ€åŠ è½½çš„æ•°æ® page_text = bro.page_source #è¯´æ˜è¯¥requestå°±æ˜¯æŒ‡å®šå“åº”å¯¹è±¡çš„è¯·æ±‚å¯¹è±¡ #æ­¤å¤„çš„responseå°±æ˜¯æŒ‡å®šæ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡ response = HtmlResponse(url=request.url, request=request, encoding='utf-8', body=page_text) #bodyå°±æ˜¯å“åº”å¯¹è±¡çš„å“åº”æ•°æ® return response else: return response def process_exception(self, request, exception, spider): pass é…ç½®æ–‡ä»¶ï¼š\nDOWNLOADER_MIDDLEWARES = { 'wangyiPro.middlewares.WangyiproDownloaderMiddleware': 543, } æ‹“å±•åŠŸèƒ½ï¼šå°†äººå·¥æ™ºèƒ½+æ•°æ®çˆ¬å–ä¸­\nå®ç°å°†çˆ¬å–åˆ°çš„æ–°é—»è¿›è¡Œåˆ†ç±»å’Œå…³é”®å­—æå–\nç™¾åº¦AIçš„ä½¿ç”¨ï¼šhttps://ai.baidu.com/\nä½¿ç”¨æµç¨‹ï¼š\nç‚¹å‡»é¦–é¡µå³ä¸Šè§’çš„æ§åˆ¶å°ï¼Œè¿›è¡Œç™»å½•ã€‚\nç™»å½•åè¿›å…¥åˆ°äº†æ™ºèƒ½äº‘çš„é¦–é¡µ\nç‚¹å‡»é¡µé¢å·¦ä¸Šè§’çš„ä¸‰æ¡æ ï¼Œé€‰æ‹©ä½ æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œç‚¹å‡»ï¼Œè¿›å…¥åˆ°æŒ‡å®šåŠŸèƒ½é¡µé¢\nåœ¨åŠŸèƒ½é¡µé¢ï¼Œé¦–å…ˆç‚¹å‡»ã€åˆ›å»ºåº”ç”¨ã€‘ï¼Œè¿›è¡Œåº”ç”¨çš„åˆ›å»º åˆ›å»ºå¥½ä¹‹åï¼Œç‚¹å‡»ç®¡ç†åº”ç”¨å°±å¯ä»¥çœ‹åˆ°ï¼š AppIDï¼ŒapiKeyï¼Œsecret keyè¿™ä¸‰ä¸ªå€¼ï¼Œä¼šåœ¨ç¨‹åºä¸­ç”¨åˆ° åœ¨åŠŸèƒ½é¡µé¢ç‚¹å‡»å·¦ä¾§çš„ã€æŠ€æœ¯æ–‡æ¡£ã€‘ï¼Œé€‰æ‹©SDKè¯´æ˜ï¼Œé€‰æ‹©å¯¹åº”çš„Pythonè¯­è¨€å³å¯ï¼Œå…ˆçœ‹å¿«é€Ÿå¼€å§‹å†…å®¹ï¼Œåœ¨é€‰æ‹©ä½ æƒ³è¦å®ç°çš„å…·ä½“åŠŸèƒ½çš„æ–‡æ¡£ç•Œé¢å³å¯ã€‚\nç¯å¢ƒå®‰è£…ï¼špip install baidu-aip æå–æ–‡ç« å…³é”®å­—ï¼š\nfrom aip import AipNlp \"\"\" ä½ çš„ APPID AK SK \"\"\" APP_ID = 'xxx' API_KEY = 'xxx' SECRET_KEY = 'xxx' client = AipNlp(APP_ID, API_KEY, SECRET_KEY) title = \"iphoneæ‰‹æœºå‡ºç°â€œç™½è‹¹æœâ€åŸå› åŠè§£å†³åŠæ³•ï¼Œç”¨è‹¹æœæ‰‹æœºçš„å¯ä»¥çœ‹ä¸‹\" content = \"å¦‚æœä¸‹é¢çš„æ–¹æ³•è¿˜æ˜¯æ²¡æœ‰è§£å†³ä½ çš„é—®é¢˜å»ºè®®æ¥æˆ‘ä»¬é—¨åº—çœ‹ä¸‹æˆéƒ½å¸‚é”¦æ±ŸåŒºçº¢æ˜Ÿè·¯ä¸‰æ®µ99å·é“¶çŸ³å¹¿åœº24å±‚01å®¤ã€‚\" \"\"\" è°ƒç”¨æ–‡ç« æ ‡ç­¾ \"\"\" result = client.keyword(title, content) for dic in result['items']: if dic['score'] \u003e= 0.8: key = dic['tag'] print(key) æ–‡ç« åˆ†ç±»ï¼š\nfrom aip import AipNlp \"\"\" ä½ çš„ APPID AK SK \"\"\" APP_ID = 'xxx' API_KEY = 'x' SECRET_KEY = 'xx' client = AipNlp(APP_ID, API_KEY, SECRET_KEY) title = \"ç§¦åˆšè®¿é—®ç‰¹æ–¯æ‹‰ç¾å›½å·¥å‚é©¬æ–¯å…‹é™ªåŒ ä¼ é€’ä»€ä¹ˆä¿¡å·ï¼Ÿ\" content = \"ä»Šå¤©ï¼ˆ4æ—¥ï¼‰ï¼Œé©»ç¾å¤§ä½¿ç§¦åˆšè®¿é—®äº†ç‰¹æ–¯æ‹‰ç¡…è°·å·¥å‚ï¼ŒåŒç‰¹æ–¯æ‹‰CEOé©¬æ–¯å…‹é’ˆå¯¹å„é¡¹å°–ç«¯ç§‘æŠ€ã€äººç±»æœªæ¥ç­‰ä¸»é¢˜å±•å¼€æ¢è®¨ï¼Œå¹¶ä½“éªŒäº†ç‰¹æ–¯æ‹‰çš„æ–°æ¬¾Model SåŠæœ€æ–°è‡ªåŠ¨è¾…åŠ©é©¾é©¶ç³»ç»Ÿã€‚ä»–åœ¨æµ·å¤–ç¤¾äº¤å¹³å°ä¸Šè¡¨ç¤ºï¼šâ€œæ€§èƒ½å¼ºåŠ²ï¼Œä½†ä¹˜åå¹³é¡ºèˆ’é€‚â€ã€‚\" \"\"\" è°ƒç”¨æ–‡ç« åˆ†ç±» \"\"\" result = client.topic(title, content) class_new = result['item']['lv1_tag_list'][0]['tag'] print(class_new) CrawlSpider å®ç°ç½‘ç«™çš„å…¨ç«™æ•°æ®çˆ¬å–\nå°±æ˜¯å°†ç½‘ç«™ä¸­æ‰€æœ‰é¡µç å¯¹åº”çš„é¡µé¢æ•°æ®è¿›è¡Œçˆ¬å–ã€‚ crawlspiderå…¶å®å°±æ˜¯scrapyå°è£…å¥½çš„ä¸€ä¸ªçˆ¬è™«ç±»ï¼Œé€šè¿‡è¯¥ç±»æä¾›çš„ç›¸å…³çš„æ–¹æ³•å’Œå±æ€§å°±å¯ä»¥å®ç°å…¨æ–°é«˜æ•ˆå½¢å¼çš„å…¨ç«™æ•°æ®çˆ¬å–ã€‚\nä½¿ç”¨æµç¨‹ï¼š\næ–°å»ºä¸€ä¸ªscrapyé¡¹ç›®\ncd é¡¹ç›®\nåˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼ˆ*ï¼‰ï¼š\nscrapy genspider-t crawl spiderName www.xxx.com\nçˆ¬è™«æ–‡ä»¶ä¸­å‘ç”Ÿçš„å˜åŒ–æœ‰å“ªäº›ï¼Ÿ\nå½“å‰çˆ¬è™«ç±»çš„çˆ¶ç±»ä¸ºCrawlSpider çˆ¬è™«ç±»ä¸­å¤šäº†ä¸€ä¸ªç±»å˜é‡å«åšrules LinkExtractorï¼šé“¾æ¥æå–å™¨ å¯ä»¥æ ¹æ®allowå‚æ•°è¡¨ç¤ºçš„æ­£åˆ™åœ¨å½“å‰é¡µé¢ä¸­æå–ç¬¦åˆæ­£åˆ™è¦æ±‚çš„é“¾æ¥ Ruleï¼šè§„åˆ™è§£æå™¨ å¯ä»¥æ¥æ”¶é“¾æ¥æå–å™¨æå–åˆ°çš„é“¾æ¥ï¼Œå¹¶ä¸”å¯¹æ¯ä¸€ä¸ªé“¾æ¥è¿›è¡Œè¯·æ±‚å‘é€ å¯ä»¥æ ¹æ®callbackæŒ‡å®šçš„å›è°ƒå‡½æ•°å¯¹æ¯ä¸€æ¬¡è¯·æ±‚åˆ°çš„æ•°æ®è¿›è¡Œæ•°æ®è§£æ æ€è€ƒ:å¦‚ä½•å°†ä¸€ä¸ªç½‘ç«™ä¸­æ‰€æœ‰çš„é“¾æ¥éƒ½æå–åˆ°å‘¢ï¼Ÿ åªéœ€è¦åœ¨é“¾æ¥æå–å™¨çš„allowåé¢èµ‹å€¼ä¸€ä¸ªç©ºæ­£åˆ™è¡¨è¾¾å¼å³å¯ ç›®å‰åœ¨scrapyä¸­æœ‰å‡ ç§å‘é€è¯·æ±‚çš„æ–¹å¼ï¼Ÿ start_urlsåˆ—è¡¨å¯ä»¥å‘é€è¯·æ±‚ scrapy.Request() scrapy.FormRequest() Ruleè§„åˆ™è§£æå™¨ æ³¨æ„ï¼š\né“¾æ¥æå–å™¨å’Œè§„åˆ™è§£æå™¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ˆä¸€å¯¹ä¸€çš„å…³ç³»ï¼‰ å»ºè®®åœ¨ä½¿ç”¨crawlSpiderå®ç°æ·±åº¦çˆ¬å–çš„æ—¶å€™ï¼Œéœ€è¦é…åˆæ‰‹åŠ¨è¯·æ±‚å‘é€çš„æ–¹å¼è¿›è¡Œæ­é…ï¼ USER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36' åˆ†å¸ƒå¼ åˆ†å¸ƒå¼åœ¨æ—¥å¸¸å¼€å‘ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œåªæ˜¯ä¸€ä¸ªå™±å¤´ï¼\næ¦‚å¿µï¼š\nå¯ä»¥ä½¿ç”¨å¤šå°ç”µè„‘æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼æœºç¾¤ï¼Œä½¿å¾—å¤šå°å¯¹ç”µè„‘å¯ä»¥å¯¹åŒä¸€ä¸ªç½‘ç«™çš„æ•°æ®è¿›è¡Œè”åˆä¸”åˆ†å¸ƒçš„æ•°æ®çˆ¬å–ã€‚ å£°æ˜ï¼š\nåŸç”Ÿçš„scrapyæ¡†æ¶å¹¶æ— æ³•å®ç°åˆ†å¸ƒå¼æ“ä½œï¼whyï¼Ÿ å¤šå°ç”µè„‘ä¹‹é—´æ— æ³•å…±äº«åŒä¸€ä¸ªè°ƒåº¦å™¨ å¤šå°ç”µè„‘ä¹‹é—´æ— æ³•å…±äº«åŒä¸€ä¸ªç®¡é“ å¦‚ä½•æ˜¯çš„scrapyå¯ä»¥å®ç°åˆ†å¸ƒå¼å‘¢ï¼Ÿ\nå€ŸåŠ©äºä¸€ä¸ªç»„ä»¶ï¼šscrapy-redis scrapy-redisçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¯ä»¥ç»™åŸç”Ÿçš„scrapyæ¡†æ¶æä¾›å¯è¢«å…±äº«çš„è°ƒåº¦å™¨å’Œç®¡é“ï¼ ç¯å¢ƒå®‰è£…ï¼špip install scrapy-redis æ³¨æ„ï¼šscrapy-redisè¯¥ç»„ä»¶åªå¯ä»¥å°†çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°redisæ•°æ®åº“ ç¼–ç æµç¨‹ï¼ˆé‡ç‚¹ï¼‰ï¼š\n1.åˆ›å»ºé¡¹ç›®\n2.cd é¡¹ç›®\n3.åˆ›å»ºåŸºäºcrawlSpiderçš„çˆ¬è™«æ–‡ä»¶\n3.1 ä¿®æ”¹çˆ¬è™«æ–‡ä»¶ å¯¼åŒ…ï¼šfrom scrapy_redis.spiders import RedisCrawlSpider ä¿®æ”¹å½“å‰çˆ¬è™«ç±»çš„çˆ¶ç±»ä¸º RedisCrawlSpider å°†start_urlsæ›¿æ¢æˆredis_keyçš„æ“ä½œ redis_keyå˜é‡çš„èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²è¡¨ç¤ºè°ƒåº¦å™¨é˜Ÿåˆ—çš„åç§° è¿›è¡Œå¸¸è§„çš„è¯·æ±‚æ“ä½œå’Œæ•°æ®è§£æ 4.settingsé…ç½®æ–‡ä»¶çš„ä¿®æ”¹\nå¸¸è§„å†…å®¹ä¿®æ”¹ï¼ˆrobotså’Œuaç­‰ï¼‰ï¼Œå…ˆä¸æŒ‡å®šæ—¥å¿—ç­‰çº§\næŒ‡å®šå¯ä»¥è¢«å…±äº«çš„ç®¡é“ç±»\nITEM_PIPELINES = { 'scrapy_redis.pipelines.RedisPipeline': 400 } æŒ‡å®šå¯ä»¥è¢«å…±äº«çš„è°ƒåº¦å™¨\n# ä½¿ç”¨scrapy-redisç»„ä»¶çš„å»é‡é˜Ÿåˆ— DUPEFILTER_CLASS = \"scrapy_redis.dupefilter.RFPDupeFilter\" # ä½¿ç”¨scrapy-redisç»„ä»¶è‡ªå·±çš„è°ƒåº¦å™¨ SCHEDULER = \"scrapy_redis.scheduler.Scheduler\" # æ˜¯å¦å…è®¸æš‚åœ SCHEDULER_PERSIST = True æŒ‡å®šæ•°æ®åº“\nREDIS_HOST = '127.0.0.1' REDIS_PORT = 6379 5.ä¿®æ”¹redisæ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼ˆredis.windows.confï¼‰\nåœ¨é…ç½®æ–‡ä»¶ä¸­æ”¹è¡Œä»£ç æ˜¯æ²¡æœ‰æ²¡æ³¨é‡Šçš„ï¼š\nbind 127.0.0.1 #å°†ä¸Šè¿°ä»£ç æ³¨é‡Šå³å¯ï¼ˆè§£é™¤æœ¬æœºç»‘å®šï¼Œå®ç°å¤–éƒ¨è®¾å¤‡è®¿é—®æœ¬æœºæ•°æ®åº“ å¦‚æœé…ç½®æ–‡ä»¶ä¸­è¿˜å­˜åœ¨ï¼šprotected-mode = trueï¼Œå°†trueä¿®æ”¹ä¸ºfalseï¼Œ ä¿®æ”¹ä¸ºfalseåè¡¨ç¤ºredisæ•°æ®åº“å…³é—­äº†ä¿æŠ¤æ¨¡å¼ï¼Œè¡¨ç¤ºå…¶ä»–è®¾å¤‡å¯ä»¥è¿œç¨‹è®¿é—®ä¸”ä¿®æ”¹ä½ æ•°æ®åº“ä¸­çš„æ•°æ® 6.å¯åŠ¨redisæ•°æ®åº“çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯\n7.è¿è¡Œé¡¹ç›®,å‘ç°ç¨‹åºæš‚å®šä¸€ç›´åœ¨ç­‰å¾…ï¼Œç­‰å¾…çˆ¬å–ä»»åŠ¡\n8.éœ€è¦å‘å¯ä»¥è¢«å…±äº«çš„è°ƒåº¦å™¨çš„é˜Ÿåˆ—ï¼ˆredis_keyçš„å€¼ï¼‰ä¸­æ”¾å…¥ä¸€ä¸ªèµ·å§‹çš„url\nåœ¨redisæ•°æ®åº“çš„å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\nlpush é˜Ÿåˆ—åç§° èµ·å§‹çš„url èµ·å§‹urlï¼šhttps://wz.sun0769.com/political/index/politicsNewest?id=1\u0026page=1 å¢é‡å¼ çˆ¬è™«åº”ç”¨åœºæ™¯åˆ†ç±»\né€šç”¨çˆ¬è™« èšç„¦çˆ¬è™« åŠŸèƒ½çˆ¬è™« åˆ†å¸ƒå¼çˆ¬è™« å¢é‡å¼ï¼š ç”¨æ¥ç›‘æµ‹ç½‘ç«™æ•°æ®æ›´æ–°çš„æƒ…å†µï¼ˆçˆ¬å–ç½‘ç«™æœ€æ–°æ›´æ–°å‡ºæ¥çš„æ•°æ®ï¼‰ã€‚ åªæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡çš„æ€è·¯ï¼Œä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚ æ ¸å¿ƒï¼š å»é‡ã€‚ ä½¿ç”¨ä¸€ä¸ªè®°å½•è¡¨æ¥å®ç°æ•°æ®çš„å»é‡ï¼š è®°å½•è¡¨ï¼šå­˜å‚¨çˆ¬å–è¿‡çš„æ•°æ®çš„è®°å½• å¦‚ä½•æ„å»ºå’Œè®¾è®¡ä¸€ä¸ªè®°å½•è¡¨ï¼š è®°å½•è¡¨éœ€è¦å…·å¤‡çš„ç‰¹æ€§ï¼š å»é‡ éœ€è¦æŒä¹…ä¿å­˜çš„ æ–¹æ¡ˆ1ï¼šä½¿ç”¨Pythonçš„seté›†åˆå……å½“è®°å½•è¡¨ï¼Ÿ ä¸å¯ä»¥çš„ï¼å› ä¸ºseté›†åˆæ— æ³•å®ç°æŒä¹…åŒ–å­˜å‚¨ æ–¹æ¡ˆ2ï¼šä½¿ç”¨redisçš„seté›†åˆå……å½“è®°å½•è¡¨ï¼Ÿ å¯ä»¥çš„ï¼Œå› ä¸ºredisçš„setæ—¢å¯ä»¥å®ç°å»é‡åˆå¯ä»¥è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚ åŸºäºä¸¤ä¸ªåœºæ™¯å®ç°å¢é‡å¼çˆ¬è™«ï¼š\nåœºæ™¯1ï¼šå¦‚æœçˆ¬å–çš„æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å½“å‰ç½‘é¡µä¸­ï¼Œæ²¡æœ‰æ·±åº¦çš„æ•°æ®çˆ¬å–çš„å¿…è¦ã€‚ åœºæ™¯2ï¼šçˆ¬å–çš„æ•°æ®å­˜åœ¨äºå½“å‰é¡µå’Œè¯¦æƒ…é¡µä¸­ï¼Œå…·å¤‡æ·±åº¦çˆ¬å–çš„å¿…è¦ã€‚ åœºæ™¯1çš„å®ç°ï¼š\næ•°æ®æŒ‡çº¹ï¼š\næ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚è®°å½•è¡¨ä¸­å¯ä»¥ä¸ç›´æ¥å­˜å‚¨æ•°æ®æœ¬èº«ï¼Œç›´æ¥å­˜å‚¨æ•°æ®æŒ‡çº¹æ›´å¥½ä¸€äº›ã€‚\n#çˆ¬è™«æ–‡ä»¶ import scrapy import redis from ..items import Zlsdemo1ProItem class DuanziSpider(scrapy.Spider): name = 'duanzi' # allowed_domains = ['www.xxxx.com'] start_urls = ['https://ishuo.cn/'] #Redisçš„é“¾æ¥å¯¹è±¡ conn = redis.Redis(host='127.0.0.1',port=6379) def parse(self, response): li_list = response.xpath('//*[@id=\"list\"]/ul/li') for li in li_list: content = li.xpath('./div[1]/text()').extract_first() title = li.xpath('./div[2]/a/text()').extract_first() all_data = title+content #ç”Ÿæˆè¯¥æ•°æ®çš„æ•°æ®æŒ‡çº¹ import hashlib # å¯¼å…¥ä¸€ä¸ªç”Ÿæˆæ•°æ®æŒ‡çº¹çš„æ¨¡å— m = hashlib.md5() m.update(all_data.encode('utf-8')) data_id = m.hexdigest() ex = self.conn.sadd('data_id',data_id) if ex == 1:#saddæ‰§è¡ŒæˆåŠŸï¼ˆæ•°æ®æŒ‡çº¹åœ¨seté›†åˆä¸­ä¸å­˜åœ¨ï¼‰ print('æœ‰æœ€æ–°æ•°æ®çš„æ›´æ–°ï¼Œæ­£åœ¨çˆ¬å–ä¸­......') item = Zlsdemo1ProItem() item['title'] = title item['content'] = content yield item else:#saddæ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼ˆæ•°æ®æŒ‡çº¹åœ¨seté›†åˆä¸­å­˜å‚¨ï¼‰ print('æš‚æ— æœ€æ–°æ•°æ®æ›´æ–°ï¼Œè¯·ç­‰å¾…......') åœºæ™¯2çš„å®ç°ï¼š\nä½¿ç”¨è¯¦æƒ…é¡µçš„urlå……å½“æ•°æ®æŒ‡çº¹å³å¯ã€‚\nimport scrapy import redis from ..items import Zlsdemo2ProItem class JianliSpider(scrapy.Spider): name = 'jianli' # allowed_domains = ['www.xxx.com'] start_urls = ['https://sc.chinaz.com/jianli/free.html'] conn = redis.Redis(host='127.0.0.1',port=6379) def parse(self, response): div_list = response.xpath('//*[@id=\"container\"]/div') for div in div_list: title = div.xpath('./p/a/text()').extract_first() #å……å½“æ•°æ®æŒ‡çº¹ detail_url = 'https:'+div.xpath('./p/a/@href').extract_first() ex = self.conn.sadd('data_id',detail_url) item = Zlsdemo2ProItem() item['title'] = title if ex == 1: print('æœ‰æœ€æ–°æ•°æ®çš„æ›´æ–°ï¼Œæ­£åœ¨é‡‡é›†......') yield scrapy.Request(url=detail_url,callback=self.parse_detail,meta={'item':item}) else: print('æš‚æ— æ•°æ®æ›´æ–°ï¼') def parse_detail(self,response): item = response.meta['item'] download_url = response.xpath('//*[@id=\"down\"]/div[2]/ul/li[1]/a/@href').extract_first() item['download_url'] = download_url yield item scrapyé¡¹ç›®éƒ¨ç½² scrapydéƒ¨ç½²å·¥å…·ä»‹ç» scrapydæ˜¯ä¸€ä¸ªç”¨äºéƒ¨ç½²å’Œè¿è¡Œscrapyçˆ¬è™«çš„ç¨‹åºï¼Œå®ƒç”± scrapy å®˜æ–¹æä¾›çš„ã€‚å®ƒå…è®¸ä½ é€šè¿‡JSON APIæ¥éƒ¨ç½²çˆ¬è™«é¡¹ç›®å’Œæ§åˆ¶çˆ¬è™«è¿è¡Œã€‚ æ‰€è°“json apiæœ¬è´¨å°±æ˜¯postè¯·æ±‚çš„webapi\né€‰æ‹©ä¸€å°ä¸»æœºå½“åšæœåŠ¡å™¨ï¼Œå®‰è£…å¹¶å¯åŠ¨ scrapyd æœåŠ¡ã€‚å†è¿™ä¹‹åï¼Œscrapyd ä¼šä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œç›‘å¬çˆ¬è™«åœ°è¿è¡Œä¸è¯·æ±‚ï¼Œç„¶åå¯åŠ¨è¿›ç¨‹æ¥æ‰§è¡Œçˆ¬è™«ç¨‹åºã€‚ ç¯å¢ƒå®‰è£… scrapydæœåŠ¡: â€‹\tpip install scrapyd\nscrapydå®¢æˆ·ç«¯: â€‹\tpip install scrapyd-client\nâ€‹\tä¸€å®šè¦å®‰è£…è¾ƒæ–°çš„ç‰ˆæœ¬10ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ç°åœ¨å®‰è£…çš„ä¸€èˆ¬éƒ½æ˜¯æ–°ç‰ˆæœ¬\nå¯åŠ¨scrapydæœåŠ¡ æ‰“å¼€ç»ˆç«¯åœ¨scrapyé¡¹ç›®è·¯å¾„ä¸‹ å¯åŠ¨scrapydçš„å‘½ä»¤ï¼š scrapyd scrapyd ä¹Ÿæä¾›äº† web çš„æ¥å£ã€‚æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹å’Œç®¡ç†çˆ¬è™«ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ scrapyd ç›‘å¬ 6800 ç«¯å£ï¼Œè¿è¡Œ scrapyd åã€‚åœ¨æœ¬æœºä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—® http://localhost:6800/åœ°å€å³å¯æŸ¥çœ‹åˆ°å½“å‰å¯ä»¥è¿è¡Œçš„é¡¹ç›®ã€‚ ç‚¹å‡»jobå¯ä»¥æŸ¥çœ‹ä»»åŠ¡ç›‘æ§ç•Œé¢ scrapyé¡¹ç›®éƒ¨ç½² é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›® ç¼–è¾‘éœ€è¦éƒ¨ç½²çš„é¡¹ç›®çš„scrapy.cfgæ–‡ä»¶(éœ€è¦å°†å“ªä¸€ä¸ªçˆ¬è™«éƒ¨ç½²åˆ°scrapydä¸­ï¼Œå°±é…ç½®è¯¥é¡¹ç›®çš„è¯¥æ–‡ä»¶) [deploy:éƒ¨ç½²å(éƒ¨ç½²åå¯ä»¥è‡ªè¡Œå®šä¹‰)] url = http://localhost:6800/ project = é¡¹ç›®å(åˆ›å»ºçˆ¬è™«é¡¹ç›®æ—¶ä½¿ç”¨çš„åç§°) username = bobo # å¦‚æœä¸éœ€è¦ç”¨æˆ·åå¯ä»¥ä¸å†™ password = 123456 # å¦‚æœä¸éœ€è¦å¯†ç å¯ä»¥ä¸å†™ éƒ¨ç½²é¡¹ç›®åˆ°scrapyd åŒæ ·åœ¨scrapyé¡¹ç›®è·¯å¾„ä¸‹æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š\nscrapyd-deploy éƒ¨ç½²å(é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„åç§°) -p é¡¹ç›®åç§° éƒ¨ç½²æˆåŠŸä¹‹åå°±å¯ä»¥çœ‹åˆ°éƒ¨ç½²çš„é¡¹ç›®\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥éƒ¨ç½²çˆ¬è™«ç»“æœï¼š\nscrapyd-deploy -L éƒ¨ç½²å ç®¡ç†scrapyé¡¹ç›® æŒ‡ä»¤ç®¡ç† å®‰è£…curlå‘½ä»¤è¡Œå·¥å…·\nwindowéœ€è¦å®‰è£… linuxå’Œmacæ— éœ€å•ç‹¬å®‰è£… windowå®‰è£…æ­¥éª¤ï¼š\nä¸‹è½½curlæ–‡ä»¶ï¼šhttps://curl.se/download.htmlï¼Œæ‰“å¼€ç½‘é¡µåå‘ä¸‹æ‹–åŠ¨ï¼Œæ‰¾åˆ°windowç³»ç»Ÿå¯¹åº”ç‰ˆæœ¬ä¸‹è½½ ä¸‹è½½åï¼Œæ”¾ç½®åˆ°ä¸€ä¸ªæ— ä¸­æ–‡çš„æ–‡ä»¶å¤¹ä¸‹ç›´æ¥è§£å‹ç¼©ï¼Œè§£å‹åå°†binæ–‡ä»¶å¤¹é…ç½®ç¯å¢ƒå˜é‡ï¼ å‚è€ƒç½‘é¡µï¼šhttps://www.cnblogs.com/lisa2016/p/12193494.html å¯åŠ¨é¡¹ç›®ï¼š\ncurl http://localhost:6800/schedule.json -d project=é¡¹ç›®å -d spider=çˆ¬è™«å è¿”å›ç»“æœï¼šæ³¨æ„æœŸä¸­çš„jobidï¼Œåœ¨å…³é—­é¡¹ç›®æ—¶å€™ä¼šç”¨åˆ°\n{\"status\": \"ok\", \"jobid\": \"94bd8ce041fd11e6af1a000c2969bafd\", \"node_name\": \"james-virtual-machine\"} å…³é—­é¡¹ç›®ï¼š\ncurl http://localhost:6800/cancel.json -d project=é¡¹ç›®å -d job=é¡¹ç›®çš„jobid åˆ é™¤çˆ¬è™«é¡¹ç›®ï¼š\ncurl http://localhost:6800/delproject.json -d project=çˆ¬è™«é¡¹ç›®åç§° requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›® import requests # å¯åŠ¨çˆ¬è™« url = 'http://localhost:6800/schedule.json' data = { 'project': é¡¹ç›®å, 'spider': çˆ¬è™«å, } resp = requests.post(url, data=data) # åœæ­¢çˆ¬è™« url = 'http://localhost:6800/cancel.json' data = { 'project': é¡¹ç›®å, 'job': å¯åŠ¨çˆ¬è™«æ—¶è¿”å›çš„jobid, } resp = requests.post(url, data=data) ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯å¼‚æ­¥çˆ¬è™«ä¸­å¾ˆå¸¸è§çš„ä¸€ä¸ªé—®é¢˜ã€‚äº§ç”Ÿæ•°æ®çš„æ¨¡å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç”Ÿäº§è€…ï¼Œè€Œå¤„ç†æ•°æ®çš„æ¨¡å—ï¼Œå°±ç§°ä¸ºæ¶ˆè´¹è€…ã€‚\nä¾‹å¦‚ï¼š\nâ€‹\tå›¾ç‰‡æ•°æ®çˆ¬å–ä¸­ï¼Œè§£æå‡ºå›¾ç‰‡é“¾æ¥çš„æ“ä½œå°±æ˜¯åœ¨ç”Ÿäº§æ•°æ®\nâ€‹\tå¯¹å›¾ç‰‡é“¾æ¥å‘èµ·è¯·æ±‚ä¸‹è½½å›¾ç‰‡çš„æ“ä½œå°±æ˜¯åœ¨æ¶ˆè´¹æ•°æ®\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ â€‹ åœ¨å¼‚æ­¥ä¸–ç•Œé‡Œï¼Œç”Ÿäº§è€…å°±æ˜¯ç”Ÿäº§æ•°æ®çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…å°±æ˜¯æ¶ˆè´¹æ•°æ®çš„çº¿ç¨‹ã€‚åœ¨å¤šçº¿ç¨‹å¼€å‘å½“ä¸­ï¼Œå¦‚æœç”Ÿäº§è€…å¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦å¾ˆæ…¢ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å°±å¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å®Œï¼Œæ‰èƒ½ç»§ç»­ç”Ÿäº§æ•°æ®ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›å¤§äºç”Ÿäº§è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å°±å¿…é¡»ç­‰å¾…ç”Ÿäº§è€…ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜äºæ˜¯å¼•å…¥äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ã€‚\nimport requests import threading from lxml import etree from queue import Queue from urllib.request import urlretrieve from time import sleep headers = { \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36\", } #ç”Ÿäº§æ•°æ®ï¼šè§£ææå–å›¾ç‰‡åœ°å€ class Producer(threading.Thread):#ç”Ÿäº§è€…çº¿ç¨‹ def __init__(self,page_queue,img_queue): super().__init__() self.page_queue = page_queue self.img_queue = img_queue def run(self): while True: if self.page_queue.empty(): print('Producerä»»åŠ¡ç»“æŸ') break #ä»page_queueä¸­å–å‡ºä¸€ä¸ªé¡µç é“¾æ¥ url = self.page_queue.get() #ä»å½“å‰çš„é¡µç å¯¹åº”çš„é¡µé¢ä¸­è§£æå‡ºæ›´å¤šçš„å›¾ç‰‡åœ°å€ self.parse_detail(url) def parse_detail(self,url): response = requests.get(url,headers=headers) response.encoding = 'gbk' page_text = response.text tree = etree.HTML(page_text) li_list = tree.xpath('//*[@id=\"main\"]/div[3]/ul/li') for li in li_list: img_src = 'https://pic.netbian.com'+li.xpath('./a/img/@src')[0] img_title = li.xpath('./a/b/text()')[0]+'.jpg' dic = { 'title':img_title, 'src':img_src } self.img_queue.put(dic) #æ¶ˆè´¹æ•°æ®ï¼šå¯¹å›¾ç‰‡åœ°å€è¿›è¡Œæ•°æ®è¯·æ±‚ class Consumer(threading.Thread):#æ¶ˆè´¹è€…çº¿ç¨‹ def __init__(self,page_queue,img_queue): super().__init__() self.page_queue = page_queue self.img_queue = img_queue def run(self): while True: if self.img_queue.empty() and self.page_queue.empty(): print('Consumerä»»åŠ¡ç»“æŸ') break dic = self.img_queue.get() title = dic['title'] src = dic['src'] print(src) urlretrieve(src,'imgs/'+title) print(title,'ä¸‹è½½å®Œæ¯•ï¼') def main(): #è¯¥é˜Ÿåˆ—ä¸­å­˜å‚¨å³å°†è¦è¦å»çš„é¡µé¢é¡µç é“¾æ¥ page_queue = Queue(20) #è¯¥é˜Ÿåˆ—å­˜å‚¨ç”Ÿäº§è€…ç”Ÿäº§å‡ºæ¥çš„å›¾ç‰‡åœ°å€ img_queue = Queue(60) #è¯¥å¾ªç¯å¯ä»¥å°†2ï¼Œ3ï¼Œ4è¿™ä¸‰ä¸ªé¡µç é“¾æ¥æ”¾å…¥page_queueä¸­ for x in range(2,10): url = 'https://pic.netbian.com/4kmeinv/index_%d.html'%x page_queue.put(url) #ç”Ÿäº§è€… for x in range(3): t = Producer(page_queue,img_queue) t.start() #æ¶ˆè´¹è€… for x in range(3): t = Consumer(page_queue,img_queue) t.start() main() ","wordCount":"13618","inLanguage":"en","datePublished":"2023-02-10T15:08:28+08:00","dateModified":"2023-02-10T15:08:28+08:00","author":[{"@type":"Person","name":"Felix"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://canw0916.github.io/en/posts/tech/scrapy%E6%A1%86%E6%9E%B6/"},"publisher":{"@type":"Organization","name":"Felix's Blog","logo":{"@type":"ImageObject","url":"https://canw0916.github.io/img/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://canw0916.github.io/en/ accesskey=h title="Felix's Blog (Alt + H)"><img src=https://canw0916.github.io/img/android-chrome-512x512.png alt=logo aria-label=logo height=35>Felix's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://canw0916.github.io/en/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://canw0916.github.io/en/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://canw0916.github.io/en/posts title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://canw0916.github.io/en/tags title="ğŸ’¡ æ ‡ç­¾"><span>ğŸ’¡ æ ‡ç­¾</span></a></li><li><a href=https://canw0916.github.io/en/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://canw0916.github.io/en/about title="ğŸ‘¦ å…³äº"><span>ğŸ‘¦ å…³äº</span></a></li><li><a href=https://canw0916.github.io/en/links title="ğŸ˜º å‹é“¾"><span>ğŸ˜º å‹é“¾</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://canw0916.github.io/en/>ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://canw0916.github.io/en/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://canw0916.github.io/en/posts/tech/>ğŸš€ æŠ€æœ¯</a></div><h1 class=post-title>Scrapyæ¡†æ¶</h1><div class=post-meta>åˆ›å»º:2023-02-10|å­—æ•°:13618å­—|æ—¶é•¿: 28åˆ†é’Ÿ|
ä½œè€…:Felix
&nbsp;&nbsp;æ ‡ç­¾: &nbsp;
<span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>æ–‡ç« ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=ç®€ä»‹>ç®€ä»‹</a></li><li><a href=#%e5%ae%89%e8%a3%85 aria-label=å®‰è£…>å®‰è£…</a></li><li><a href=#%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8 aria-label=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e8%a7%a3%e6%9e%90 aria-label=æ•°æ®è§£æ>æ•°æ®è§£æ</a></li><li><a href=#%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8 aria-label=æŒä¹…åŒ–å­˜å‚¨>æŒä¹…åŒ–å­˜å‚¨</a><ul><li><a href=#%e5%9f%ba%e4%ba%8e%e7%bb%88%e7%ab%af%e6%8c%87%e4%bb%a4%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8 aria-label=åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨>åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨</a></li><li><a href=#%e5%9f%ba%e4%ba%8e%e7%ae%a1%e9%81%93%e5%ae%9e%e7%8e%b0%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8 aria-label=åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨>åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨</a><ul><li><a href=#%e7%bc%96%e7%a0%81%e6%b5%81%e7%a8%8b aria-label=ç¼–ç æµç¨‹>ç¼–ç æµç¨‹</a></li></ul></li></ul></li><li><a href=#%e7%ae%a1%e9%81%93%e6%b7%b1%e5%85%a5%e6%93%8d%e4%bd%9c aria-label=ç®¡é“æ·±å…¥æ“ä½œ>ç®¡é“æ·±å…¥æ“ä½œ</a></li><li><a href=#scrapy%e7%88%ac%e5%8f%96%e5%a4%9a%e5%aa%92%e4%bd%93%e8%b5%84%e6%ba%90%e6%95%b0%e6%8d%ae aria-label=scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ®>scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ®</a></li><li><a href=#scrapy%e6%b7%b1%e5%ba%a6%e7%88%ac%e5%8f%96 aria-label=scrapyæ·±åº¦çˆ¬å–>scrapyæ·±åº¦çˆ¬å–</a></li><li><a href=#imagepipelines%e7%9a%84%e8%af%b7%e6%b1%82%e4%bc%a0%e5%8f%82 aria-label=ImagePipeLinesçš„è¯·æ±‚ä¼ å‚>ImagePipeLinesçš„è¯·æ±‚ä¼ å‚</a></li><li><a href=#%e5%a6%82%e4%bd%95%e6%8f%90%e9%ab%98scrapy%e7%9a%84%e7%88%ac%e5%8f%96%e6%95%88%e7%8e%87 aria-label=å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡>å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡</a></li><li><a href=#post%e8%af%b7%e6%b1%82%e5%8f%91%e9%80%81 aria-label=postè¯·æ±‚å‘é€>postè¯·æ±‚å‘é€</a></li><li><a href=#scrapy%e7%9a%84%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6 aria-label=scrapyçš„æ ¸å¿ƒç»„ä»¶>scrapyçš„æ ¸å¿ƒç»„ä»¶</a></li><li><a href=#%e4%b8%ad%e9%97%b4%e4%bb%b6 aria-label=ä¸­é—´ä»¶>ä¸­é—´ä»¶</a><ul><li><a href=#%e5%bc%80%e5%8f%91%e4%bb%a3%e7%90%86%e4%b8%ad%e9%97%b4%e4%bb%b6 aria-label=å¼€å‘ä»£ç†ä¸­é—´ä»¶>å¼€å‘ä»£ç†ä¸­é—´ä»¶</a></li><li><a href=#%e5%bc%80%e5%8f%91ua%e4%b8%ad%e9%97%b4%e4%bb%b6 aria-label=å¼€å‘UAä¸­é—´ä»¶>å¼€å‘UAä¸­é—´ä»¶</a></li><li><a href=#%e5%bc%80%e5%8f%91cookie%e4%b8%ad%e9%97%b4%e4%bb%b6 aria-label=å¼€å‘Cookieä¸­é—´ä»¶>å¼€å‘Cookieä¸­é—´ä»¶</a></li><li><a href=#seleniumscrapy aria-label=selenium+scrapy>selenium+scrapy</a></li></ul></li><li><a href=#crawlspider aria-label=CrawlSpider>CrawlSpider</a></li><li><a href=#%e5%88%86%e5%b8%83%e5%bc%8f aria-label=åˆ†å¸ƒå¼>åˆ†å¸ƒå¼</a></li><li><a href=#%e5%a2%9e%e9%87%8f%e5%bc%8f aria-label=å¢é‡å¼>å¢é‡å¼</a></li><li><a href=#scrapy%e9%a1%b9%e7%9b%ae%e9%83%a8%e7%bd%b2 aria-label=scrapyé¡¹ç›®éƒ¨ç½²>scrapyé¡¹ç›®éƒ¨ç½²</a><ul><li><a href=#scrapyd%e9%83%a8%e7%bd%b2%e5%b7%a5%e5%85%b7%e4%bb%8b%e7%bb%8d aria-label=scrapydéƒ¨ç½²å·¥å…·ä»‹ç»>scrapydéƒ¨ç½²å·¥å…·ä»‹ç»</a></li><li><a href=#%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85 aria-label=ç¯å¢ƒå®‰è£…>ç¯å¢ƒå®‰è£…</a></li><li><a href=#%e5%90%af%e5%8a%a8scrapyd%e6%9c%8d%e5%8a%a1 aria-label=å¯åŠ¨scrapydæœåŠ¡>å¯åŠ¨scrapydæœåŠ¡</a></li><li><a href=#scrapy%e9%a1%b9%e7%9b%ae%e9%83%a8%e7%bd%b2-1 aria-label=scrapyé¡¹ç›®éƒ¨ç½²>scrapyé¡¹ç›®éƒ¨ç½²</a><ul><li><a href=#%e9%85%8d%e7%bd%ae%e9%9c%80%e8%a6%81%e9%83%a8%e7%bd%b2%e7%9a%84%e9%a1%b9%e7%9b%ae aria-label=é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›®>é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›®</a></li><li><a href=#%e9%83%a8%e7%bd%b2%e9%a1%b9%e7%9b%ae%e5%88%b0scrapyd aria-label=éƒ¨ç½²é¡¹ç›®åˆ°scrapyd>éƒ¨ç½²é¡¹ç›®åˆ°scrapyd</a></li></ul></li><li><a href=#%e7%ae%a1%e7%90%86scrapy%e9%a1%b9%e7%9b%ae aria-label=ç®¡ç†scrapyé¡¹ç›®>ç®¡ç†scrapyé¡¹ç›®</a><ul><li><a href=#%e6%8c%87%e4%bb%a4%e7%ae%a1%e7%90%86 aria-label=æŒ‡ä»¤ç®¡ç†>æŒ‡ä»¤ç®¡ç†</a></li><li><a href=#requests%e6%a8%a1%e5%9d%97%e6%8e%a7%e5%88%b6scrapy%e9%a1%b9%e7%9b%ae aria-label=requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›®>requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›®</a></li></ul></li></ul></li><li><a href=#%e7%94%9f%e4%ba%a7%e8%80%85%e6%b6%88%e8%b4%b9%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</a><ul><li><a href=#%e8%ae%a4%e8%af%86%e7%94%9f%e4%ba%a7%e8%80%85%e5%92%8c%e6%b6%88%e8%b4%b9%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e4%bd%bf%e7%94%a8%e7%94%9f%e4%ba%a7%e8%80%85%e5%92%8c%e6%b6%88%e8%b4%b9%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement||=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e}),elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h3 id=ç®€ä»‹>ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#ç®€ä»‹>#</a></h3><p>ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ</p><p>æ‰€è°“çš„æ¡†ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªã€é¡¹ç›®çš„åŠæˆå“ã€‘ï¼Œè¯¥é¡¹ç›®çš„åŠæˆå“éœ€è¦è¢«é›†æˆäº†å„ç§åŠŸèƒ½ä¸”å…·æœ‰è¾ƒå¼ºçš„é€šç”¨æ€§ã€‚</p><p>Scrapyæ˜¯ä¸€ä¸ªä¸ºäº†çˆ¬å–ç½‘ç«™æ•°æ®ï¼Œæå–ç»“æ„æ€§æ•°æ®è€Œç¼–å†™çš„åº”ç”¨æ¡†æ¶ï¼Œéå¸¸å‡ºåï¼Œéå¸¸å¼ºæ‚ã€‚æ‰€è°“çš„æ¡†æ¶å°±æ˜¯ä¸€ä¸ªå·²ç»è¢«é›†æˆäº†å„ç§åŠŸèƒ½ï¼ˆé«˜æ€§èƒ½å¼‚æ­¥ä¸‹è½½ï¼Œé˜Ÿåˆ—ï¼Œåˆ†å¸ƒå¼ï¼Œè§£æï¼ŒæŒä¹…åŒ–ç­‰ï¼‰çš„å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„é¡¹ç›®æ¨¡æ¿ã€‚å¯¹äºæ¡†æ¶çš„å­¦ä¹ ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¹ å…¶æ¡†æ¶çš„ç‰¹æ€§ã€å„ä¸ªåŠŸèƒ½çš„ç”¨æ³•å³å¯ã€‚</p><p>åˆæœŸå¦‚ä½•å­¦ä¹ æ¡†æ¶ï¼Ÿ</p><p>åªéœ€è¦å­¦ä¹ æ¡†æ¶é›†æˆå¥½çš„å„ç§åŠŸèƒ½çš„ç”¨æ³•å³å¯ï¼å‰æœŸåˆ‡å‹¿é’»ç ”æ¡†æ¶çš„æºç ï¼</p><h3 id=å®‰è£…>å®‰è£…<a hidden class=anchor aria-hidden=true href=#å®‰è£…>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Linux/macç³»ç»Ÿï¼š
</span></span><span class=line><span class=cl>      pip install scrapyï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Windowsç³»ç»Ÿï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      a. pip install wheelï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      b. ä¸‹è½½twistedæ–‡ä»¶ï¼Œä¸‹è½½ç½‘å€å¦‚ä¸‹ï¼š http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      c. ç»ˆç«¯è¿›å…¥ä¸‹è½½ç›®å½•ï¼Œæ‰§è¡Œ pip install Twistedâ€‘17.1.0â€‘cp35â€‘cp35mâ€‘win_amd64.whl
</span></span><span class=line><span class=cl>      æ³¨æ„ï¼šå¦‚æœè¯¥æ­¥éª¤å®‰è£…å‡ºé”™ï¼Œåˆ™æ¢ä¸€ä¸ªç‰ˆæœ¬çš„whlæ–‡ä»¶å³å¯
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      d. pip install pywin32ï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      e. pip install scrapyï¼ˆä»»æ„ç›®å½•ä¸‹ï¼‰
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>å¦‚æœå®‰è£…å¥½åï¼Œåœ¨ç»ˆç«¯ä¸­å½•å…¥scrapyæŒ‡ä»¤æŒ‰ä¸‹å›è½¦ï¼Œå¦‚æœæ²¡æœ‰æç¤ºæ‰¾ä¸åˆ°è¯¥æŒ‡ä»¤ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ
</span></span></code></pre></div><h3 id=åŸºæœ¬ä½¿ç”¨>åŸºæœ¬ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#åŸºæœ¬ä½¿ç”¨>#</a></h3><ul><li><p>åˆ›å»ºé¡¹ç›®</p><ul><li><p>scrapy startproject é¡¹ç›®åç§°</p></li><li><p>é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  firstBlood   # é¡¹ç›®æ‰€åœ¨æ–‡ä»¶å¤¹, å»ºè®®ç”¨pycharmæ‰“å¼€è¯¥æ–‡ä»¶å¤¹
</span></span><span class=line><span class=cl>      â”œâ”€â”€ firstBlood  		# é¡¹ç›®è·Ÿç›®å½•
</span></span><span class=line><span class=cl>      â”‚Â Â  â”œâ”€â”€ __init__.py
</span></span><span class=line><span class=cl>      â”‚Â Â  â”œâ”€â”€ items.py  		# å°è£…æ•°æ®çš„æ ¼å¼
</span></span><span class=line><span class=cl>      â”‚Â Â  â”œâ”€â”€ middlewares.py  # æ‰€æœ‰ä¸­é—´ä»¶
</span></span><span class=line><span class=cl>      â”‚Â Â  â”œâ”€â”€ pipelines.py	# æ‰€æœ‰çš„ç®¡é“
</span></span><span class=line><span class=cl>      â”‚Â Â  â”œâ”€â”€ settings.py		# çˆ¬è™«é…ç½®ä¿¡æ¯
</span></span><span class=line><span class=cl>      â”‚Â Â  â””â”€â”€ spiders			# çˆ¬è™«æ–‡ä»¶å¤¹, ç¨åé‡Œé¢ä¼šå†™å…¥çˆ¬è™«ä»£ç 
</span></span><span class=line><span class=cl>      â”‚Â Â      â””â”€â”€ __init__.py
</span></span><span class=line><span class=cl>      â””â”€â”€ scrapy.cfg			# scrapyé¡¹ç›®é…ç½®ä¿¡æ¯,ä¸è¦åˆ å®ƒ,åˆ«åŠ¨å®ƒ,å–„å¾…å®ƒ. 
</span></span></code></pre></div></li></ul></li></ul></li><li><p>åˆ›å»ºçˆ¬è™«çˆ¬è™«æ–‡ä»¶ï¼š</p><ul><li>cd project_nameï¼ˆè¿›å…¥é¡¹ç›®ç›®å½•ï¼‰</li><li>scrapy genspider çˆ¬è™«æ–‡ä»¶çš„åç§°ï¼ˆè‡ªå®šä¹‰ä¸€ä¸ªåå­—å³å¯ï¼‰ èµ·å§‹url<ul><li>ï¼ˆä¾‹å¦‚ï¼šscrapy genspider first <a href=https://www.xxx.com>www.xxx.com</a>ï¼‰</li></ul></li><li>åˆ›å»ºæˆåŠŸåï¼Œä¼šåœ¨çˆ¬è™«æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªpyçš„çˆ¬è™«æ–‡ä»¶</li></ul></li><li><p>ç¼–å†™çˆ¬è™«æ–‡ä»¶</p><ul><li><p>ç†è§£çˆ¬è™«æ–‡ä»¶çš„ä¸åŒç»„æˆéƒ¨åˆ†</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>FirstSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=c1>#çˆ¬è™«åç§°ï¼šçˆ¬è™«æ–‡ä»¶å”¯ä¸€æ ‡è¯†ï¼šå¯ä»¥ä½¿ç”¨è¯¥å˜é‡çš„å€¼æ¥å®šä½åˆ°å”¯ä¸€çš„ä¸€ä¸ªçˆ¬è™«æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;first&#39;</span> <span class=c1>#æ— éœ€æ”¹åŠ¨</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å…è®¸çš„åŸŸåï¼šscrapyåªå¯ä»¥å‘èµ·ç™¾åº¦åŸŸåä¸‹çš„ç½‘ç»œè¯·æ±‚</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.baidu.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#èµ·å§‹çš„urlåˆ—è¡¨ï¼šåˆ—è¡¨ä¸­å­˜æ”¾çš„urlå¯ä»¥è¢«scrapyå‘èµ·getè¯·æ±‚</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://www.baidu.com/&#39;</span><span class=p>,</span><span class=s1>&#39;https://www.sogou.com&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>#ä¸“é—¨ç”¨ä½œäºæ•°æ®è§£æ</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°responseï¼šå°±æ˜¯è¯·æ±‚ä¹‹åå¯¹åº”çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#parseçš„è°ƒç”¨æ¬¡æ•°ï¼Œå–å†³äºstart_urlsåˆ—è¡¨å…ƒç´ çš„ä¸ªæ•°</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;å“åº”å¯¹è±¡ä¸ºï¼š&#39;</span><span class=p>,</span><span class=n>response</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li><li><p>é…ç½®æ–‡ä»¶ä¿®æ”¹:settings.py</p><ul><li>ä¸éµä»robotsåè®®ï¼šROBOTSTXT_OBEY = False</li><li>æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç±»å‹ï¼šLOG_LEVEL = &lsquo;ERROR&rsquo;</li><li>æŒ‡å®šUAï¼šUSER_AGENT = &lsquo;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36&rsquo;</li></ul></li><li><p>è¿è¡Œé¡¹ç›®</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  scrapy crawl çˆ¬è™«åç§° ï¼šè¯¥ç§æ‰§è¡Œå½¢å¼ä¼šæ˜¾ç¤ºæ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼ˆæ¨èï¼‰
</span></span><span class=line><span class=cl>  scrapy crawl çˆ¬è™«åç§° --nologï¼šè¯¥ç§æ‰§è¡Œå½¢å¼ä¸ä¼šæ˜¾ç¤ºæ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰
</span></span></code></pre></div></li></ul></li></ul><h3 id=æ•°æ®è§£æ>æ•°æ®è§£æ<a hidden class=anchor aria-hidden=true href=#æ•°æ®è§£æ>#</a></h3><ul><li><p>æ³¨æ„ï¼Œå¦‚æœç»ˆç«¯è¿˜åœ¨ç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™éœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œcd ../è¿”å›åˆ°ä¸Šçº§ç›®å½•ï¼Œåœ¨å»æ–°å»ºå¦ä¸€ä¸ªé¡¹ç›®ã€‚</p></li><li><p>æ–°å»ºæ•°æ®è§£æé¡¹ç›®ï¼š</p><ul><li>åˆ›å»ºå·¥ç¨‹ï¼šscrapy startproject é¡¹ç›®åç§°</li><li>cd é¡¹ç›®åç§°</li><li>åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼šscrapy genspider çˆ¬è™«æ–‡ä»¶å <a href=https://www.xxx.com>www.xxx.com</a></li></ul></li><li><p>é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼šsettings.py</p><ul><li>ä¸éµä»robotsåè®®ï¼šROBOTSTXT_OBEY = False</li><li>æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„ç±»å‹ï¼šLOG_LEVEL = &lsquo;ERROR&rsquo;</li><li>æŒ‡å®šUAï¼šUSER_AGENT = &lsquo;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36&rsquo;</li></ul></li><li><p>ç¼–å†™çˆ¬è™«æ–‡ä»¶ï¼šspiders/duanzi.py</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>DuanziSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;duanzi&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å¯¹é¦–é¡µè¿›è¡Œç½‘ç»œè¯·æ±‚</span>
</span></span><span class=line><span class=cl>      <span class=c1>#scrapyä¼šå¯¹åˆ—è¡¨ä¸­çš„urlå‘èµ·getè¯·æ±‚</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://ishuo.cn/duanzi&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å¦‚ä½•è·å–å“åº”æ•°æ®</span>
</span></span><span class=line><span class=cl>          <span class=c1>#è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;list&#34;]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=c1># content = li.xpath(&#39;./div[1]/text()&#39;)[0]</span>
</span></span><span class=line><span class=cl>              <span class=c1># title = li.xpath(&#39;./div[2]/a/text()&#39;)[0]</span>
</span></span><span class=line><span class=cl>              <span class=c1># #&lt;Selector xpath=&#39;./div[2]/a/text()&#39; data=&#39;ä¸€å¹´å¥”æ³¢ï¼Œå°˜ç¼˜é‡äº†è°&#39;&gt;</span>
</span></span><span class=line><span class=cl>              <span class=c1># print(title)#selectorçš„å¯¹è±¡ï¼Œä¸”æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²å†…å®¹å­˜åœ¨äºè¯¥å¯¹è±¡çš„dataå‚æ•°é‡Œ</span>
</span></span><span class=line><span class=cl>              <span class=c1>#è§£ææ–¹æ¡ˆ1ï¼š</span>
</span></span><span class=line><span class=cl>              <span class=c1># title = li.xpath(&#39;./div[2]/a/text()&#39;)[0]</span>
</span></span><span class=line><span class=cl>              <span class=c1># content = li.xpath(&#39;./div[1]/text()&#39;)[0]</span>
</span></span><span class=line><span class=cl>              <span class=c1># #extract()å¯ä»¥å°†selectorå¯¹è±¡ä¸­dataå‚æ•°çš„å€¼å–å‡º</span>
</span></span><span class=line><span class=cl>              <span class=c1># print(title.extract())</span>
</span></span><span class=line><span class=cl>              <span class=c1># print(content.extract())</span>
</span></span><span class=line><span class=cl>              <span class=c1>#è§£ææ–¹æ¡ˆ2ï¼š</span>
</span></span><span class=line><span class=cl>              <span class=c1>#titleå’Œcontentä¸ºåˆ—è¡¨ï¼Œåˆ—è¡¨åªè¦ä¸€ä¸ªåˆ—è¡¨å…ƒç´ </span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[2]/a/text()&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=n>content</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[1]/text()&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=c1>#extract_first()å¯ä»¥å°†åˆ—è¡¨ä¸­ç¬¬0ä¸ªåˆ—è¡¨å…ƒç´ è¡¨ç¤ºçš„selectorå¯¹è±¡ä¸­dataçš„å‚æ•°å€¼å–å‡º</span>
</span></span><span class=line><span class=cl>              <span class=nb>print</span><span class=p>(</span><span class=n>title</span><span class=o>.</span><span class=n>extract_first</span><span class=p>())</span>
</span></span><span class=line><span class=cl>              <span class=nb>print</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>extract_first</span><span class=p>())</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=æŒä¹…åŒ–å­˜å‚¨>æŒä¹…åŒ–å­˜å‚¨<a hidden class=anchor aria-hidden=true href=#æŒä¹…åŒ–å­˜å‚¨>#</a></h3><p>ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li>åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨</li><li>åŸºäºç®¡é“çš„æŒä¹…åŒ–å­˜å‚¨ï¼ˆæ¨èï¼‰</li></ul><h4 id=åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨>åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨<a hidden class=anchor aria-hidden=true href=#åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨>#</a></h4><ul><li><p>åªå¯ä»¥å°†parseæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°æŒ‡å®šåç¼€çš„æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚</p></li><li><p>ç¼–ç æµç¨‹ï¼š</p><ul><li><p>åœ¨çˆ¬è™«æ–‡ä»¶ä¸­ï¼Œå°†çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨å°è£…åˆ°parseæ–¹æ³•çš„è¿”å›å€¼ä¸­</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>DemoSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;demo&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://ishuo.cn/duanzi&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1># å¦‚ä½•è·å–å“åº”æ•°æ®</span>
</span></span><span class=line><span class=cl>          <span class=c1># è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;list&#34;]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=n>all_data</span> <span class=o>=</span> <span class=p>[]</span><span class=c1>#çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[2]/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>content</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[1]/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=c1>#å°†æ®µå­æ ‡é¢˜å’Œå†…å®¹å°è£…æˆparseæ–¹æ³•çš„è¿”å›</span>
</span></span><span class=line><span class=cl>              <span class=n>dic</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=s1>&#39;title&#39;</span><span class=p>:</span><span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=s1>&#39;content&#39;</span><span class=p>:</span><span class=n>content</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=n>all_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>dic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>all_data</span>
</span></span></code></pre></div></li></ul></li><li><p>å°†parseæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°æŒ‡å®šåç¼€çš„æ–‡æœ¬æ–‡ä»¶ä¸­:</p><ul><li>scrapy crawl çˆ¬è™«æ–‡ä»¶åç§° -o duanzi.csv</li></ul></li></ul></li><li><p>æ€»ç»“ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šç®€å•ï¼Œä¾¿æ·</li><li>ç¼ºç‚¹ï¼šå±€é™æ€§å¼º<ul><li>åªå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°æ–‡æœ¬æ–‡ä»¶æ— æ³•å†™å…¥æ•°æ®åº“</li><li>å­˜å‚¨æ•°æ®æ–‡ä»¶åç¼€æ˜¯æŒ‡å®šå¥½çš„ï¼Œé€šå¸¸ä½¿ç”¨.csv</li><li>éœ€è¦å°†å­˜å‚¨çš„æ•°æ®å°è£…åˆ°parseæ–¹æ³•çš„è¿”å›å€¼ä¸­</li></ul></li></ul></li></ul><h4 id=åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨>åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨<a hidden class=anchor aria-hidden=true href=#åŸºäºç®¡é“å®ç°æŒä¹…åŒ–å­˜å‚¨>#</a></h4><p>ä¼˜ç‚¹ï¼šæå¤§ç¨‹åº¦çš„æå‡æ•°æ®å­˜å‚¨çš„æ•ˆç‡</p><p>ç¼ºç‚¹ï¼šç¼–ç æµç¨‹è¾ƒå¤š</p><h5 id=ç¼–ç æµç¨‹>ç¼–ç æµç¨‹<a hidden class=anchor aria-hidden=true href=#ç¼–ç æµç¨‹>#</a></h5><p>1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œæ•°æ®è§£æ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>  <span class=c1># å¦‚ä½•è·å–å“åº”æ•°æ®</span>
</span></span><span class=line><span class=cl>  <span class=c1># è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ</span>
</span></span><span class=line><span class=cl>  <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;list&#34;]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>all_data</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[2]/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[1]/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span></code></pre></div><p>2.å°†è§£æåˆ°çš„æ•°æ®å°è£…åˆ°Itemç±»å‹çš„å¯¹è±¡ä¸­</p><ul><li><p>2.1 åœ¨items.pyæ–‡ä»¶ä¸­å®šä¹‰ç›¸å…³çš„å­—æ®µ</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>SavedataproItem</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=c1># define the fields for your item here like:</span>
</span></span><span class=line><span class=cl>      <span class=c1># name = scrapy.Field()</span>
</span></span><span class=line><span class=cl>      <span class=c1>#çˆ¬å–çš„å­—æ®µæœ‰å“ªäº›ï¼Œè¿™é‡Œå°±éœ€è¦å®šä¹‰å“ªäº›å˜é‡å­˜å‚¨çˆ¬å–åˆ°çš„å­—æ®µ</span>
</span></span><span class=line><span class=cl>      <span class=n>title</span> <span class=o>=</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Field</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=n>content</span> <span class=o>=</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Field</span><span class=p>()</span>
</span></span></code></pre></div></li></ul></li><li><p>2.2 åœ¨çˆ¬è™«æ–‡ä»¶ä¸­å¼•å…¥Itemç±»ï¼Œå®ä¾‹åŒ–itemå¯¹è±¡ï¼Œå°†è§£æåˆ°çš„æ•°æ®å­˜å‚¨åˆ°itemå¯¹è±¡ä¸­</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      		<span class=kn>from</span> <span class=nn>items</span> <span class=kn>import</span> <span class=n>SavedataproItem</span> <span class=c1>#å¯¼å…¥itemç±»</span>
</span></span><span class=line><span class=cl>          <span class=c1># å¦‚ä½•è·å–å“åº”æ•°æ®</span>
</span></span><span class=line><span class=cl>          <span class=c1># è°ƒç”¨xpathæ–¹æ³•å¯¹å“åº”æ•°æ®è¿›è¡Œxpathå½¢å¼çš„æ•°æ®è§£æ</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;list&#34;]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=n>all_data</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># çˆ¬å–åˆ°çš„æ•°æ®å…¨éƒ¨éƒ½å­˜å‚¨åˆ°äº†è¯¥åˆ—è¡¨ä¸­</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[2]/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>content</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[1]/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=c1>#å®ä¾‹åŒ–ä¸€ä¸ªitemç±»å‹çš„å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span> <span class=o>=</span> <span class=n>SavedataproItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=c1>#é€šè¿‡ä¸­æ‹¬å·çš„æ–¹å¼è®¿é—®itemå¯¹è±¡ä¸­çš„ä¸¤ä¸ªæˆå‘˜ï¼Œä¸”å°†è§£æåˆ°çš„ä¸¤ä¸ªå­—æ®µèµ‹å€¼ç»™itemå¯¹è±¡çš„ä¸¤ä¸ªæˆå‘˜å³å¯</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span></span></code></pre></div></li></ul></li></ul><p>3.å°†itemå¯¹è±¡æäº¤ç»™ç®¡é“</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1>#å°†å­˜å‚¨å¥½æ•°æ®çš„itemå¯¹è±¡æäº¤ç»™ç®¡é“</span>
</span></span><span class=line><span class=cl>  <span class=k>yield</span> <span class=n>item</span>
</span></span></code></pre></div></li></ul><p>4.åœ¨ç®¡é“ä¸­æ¥æ”¶itemç±»å‹å¯¹è±¡(pipelines.pyå°±æ˜¯ç®¡é“æ–‡ä»¶)</p><ul><li><p>ç®¡é“åªå¯ä»¥æ¥æ”¶itemç±»å‹çš„å¯¹è±¡ï¼Œä¸å¯ä»¥æ¥æ”¶å…¶ä»–ç±»å‹å¯¹è±¡</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>SavedataproPipeline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=c1>#process_itemç”¨æ¥æ¥æ”¶çˆ¬è™«æ–‡ä»¶ä¼ é€’è¿‡æ¥çš„itemå¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#itemå‚æ•°ï¼Œå°±æ˜¯ç®¡é“æ¥æ”¶åˆ°çš„itemç±»å‹å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></div></li></ul><p>5.åœ¨ç®¡é“ä¸­å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œä»»æ„å½¢å¼çš„æŒä¹…åŒ–å­˜å‚¨æ“ä½œ</p><ul><li><p>å¯ä»¥å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define your item pipelines here</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
</span></span><span class=line><span class=cl>  <span class=c1># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>SavedataproPipeline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=c1>#é‡å†™çˆ¶ç±»çš„æ–¹æ³•</span>
</span></span><span class=line><span class=cl>      <span class=n>fp</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>open_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æˆ‘æ˜¯open_spideræ–¹æ³•ï¼Œæˆ‘åœ¨é¡¹ç›®å¼€å§‹è¿è¡Œç¯èŠ‚ï¼Œåªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>fp</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;duanzi.txt&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>,</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=c1>#process_itemç”¨æ¥æ¥æ”¶çˆ¬è™«æ–‡ä»¶ä¼ é€’è¿‡æ¥çš„itemå¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#itemå‚æ•°ï¼Œå°±æ˜¯ç®¡é“æ¥æ”¶åˆ°çš„itemç±»å‹å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#process_itemæ–¹æ³•è°ƒç”¨çš„æ¬¡æ•°å–å†³äºçˆ¬è™«æ–‡ä»¶ç»™å…¶æäº¤itemçš„æ¬¡æ•°</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#itemç±»å‹çš„å¯¹è±¡å…¶å®å°±æ˜¯ä¸€ä¸ªå­—å…¸</span>
</span></span><span class=line><span class=cl>          <span class=c1># print(item)</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å°†itemå­—å…¸ä¸­çš„æ ‡é¢˜å’Œå†…å®¹è·å–</span>
</span></span><span class=line><span class=cl>          <span class=n>title</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=n>content</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>fp</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>title</span><span class=o>+</span><span class=s1>&#39;:&#39;</span><span class=o>+</span><span class=n>content</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=s1>&#39;:çˆ¬å–ä¿å­˜æˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>close_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;åœ¨çˆ¬è™«ç»“æŸçš„æ—¶å€™ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>fp</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></div></li></ul><p>6.åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç®¡é“æœºåˆ¶</p><ul><li>æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç®¡é“æœºåˆ¶æ˜¯æ²¡æœ‰è¢«å¼€å¯çš„ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨å¼€å¯</li><li>åœ¨setting.pyä¸­æŠŠITEM_PIPELINESè§£é™¤æ³¨é‡Šå°±è¡¨ç¤ºå¼€å¯äº†ç®¡é“æœºåˆ¶</li></ul><h3 id=ç®¡é“æ·±å…¥æ“ä½œ>ç®¡é“æ·±å…¥æ“ä½œ<a hidden class=anchor aria-hidden=true href=#ç®¡é“æ·±å…¥æ“ä½œ>#</a></h3><ul><li><p>å¦‚ä½•å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“</p><ul><li>æ³¨æ„ï¼šä¸€ä¸ªç®¡é“ç±»è´Ÿè´£å°†æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªå…·ä½“çš„è½½ä½“ä¸­ã€‚å¦‚æœæƒ³è¦å°†çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°å¤šä¸ªä¸åŒçš„è½½ä½“/æ•°æ®åº“ä¸­ï¼Œåˆ™éœ€è¦å®šä¹‰å¤šä¸ªç®¡é“ç±»ã€‚</li></ul></li><li><p>æ€è€ƒï¼š</p><ul><li>åœ¨æœ‰å¤šä¸ªç®¡é“ç±»çš„å‰æä¸‹ï¼Œçˆ¬è™«æ–‡ä»¶æäº¤çš„itemä¼šåŒæ—¶ç»™æ²¡ä¸€ä¸ªç®¡é“ç±»è¿˜æ˜¯å•ç‹¬çš„ç®¡é“ç±»ï¼Ÿ<ul><li>çˆ¬è™«æ–‡ä»¶åªä¼šå°†itemæäº¤ç»™ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸€ä¸ªç®¡é“ç±»ã€‚ä¼˜å…ˆçº§æœ€é«˜çš„ç®¡é“ç±»çš„process_itemä¸­éœ€è¦å†™return itemæ“ä½œï¼Œè¯¥æ“ä½œå°±æ˜¯è¡¨ç¤ºå°†itemå¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±»ï¼Œä¸‹ä¸€ä¸ªç®¡é“ç±»è·å–äº†itemå¯¹è±¡ï¼Œæ‰å¯ä»¥å°†æ•°æ®å­˜å‚¨æˆåŠŸï¼</li></ul></li></ul></li><li><p>ç®¡é“ç±»ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define your item pipelines here</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
</span></span><span class=line><span class=cl>  <span class=c1># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>pymysql</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>pymongo</span>
</span></span><span class=line><span class=cl>  <span class=c1>#è´Ÿè´£å°†æ•°æ®å­˜å‚¨åˆ°mysqlä¸­</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>MysqlPipeline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>conn</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1>#mysqlçš„é“¾æ¥å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=n>cursor</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>open_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span> <span class=o>=</span> <span class=n>pymysql</span><span class=o>.</span><span class=n>Connect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=n>host</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>port</span> <span class=o>=</span> <span class=mi>3306</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>user</span> <span class=o>=</span> <span class=s1>&#39;root&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>password</span> <span class=o>=</span> <span class=s1>&#39;boboadmin&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>db</span> <span class=o>=</span> <span class=s1>&#39;spider3qi&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>charset</span> <span class=o>=</span> <span class=s1>&#39;utf8&#39;</span>
</span></span><span class=line><span class=cl>          <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=c1>#çˆ¬è™«æ–‡ä»¶æ¯å‘ç®¡é“æäº¤ä¸€ä¸ªitemï¼Œåˆ™process_itemæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>title</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=n>sql</span> <span class=o>=</span> <span class=s1>&#39;insert into xiaoshuo (title) values (&#34;</span><span class=si>%s</span><span class=s1>&#34;)&#39;</span><span class=o>%</span><span class=n>title</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æˆåŠŸå†™å…¥ä¸€æ¡æ•°æ®ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>close_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>#å°†æ•°æ®æŒä¹…åŒ–å­˜å‚¨åˆ°redisä¸­</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>RedisPipeLine</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>conn</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>open_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#åœ¨é“¾æ¥å‰åŠ¡å¿…æ‰‹åŠ¨å¯åŠ¨redisçš„æœåŠ¡</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=n>host</span><span class=o>=</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>port</span><span class=o>=</span><span class=mi>6379</span>
</span></span><span class=line><span class=cl>          <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>item</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#æ³¨æ„ï¼šå¦‚æœæƒ³è¦å°†ä¸€ä¸ªpythonå­—å…¸ç›´æ¥å†™å…¥åˆ°redisä¸­ï¼Œåˆ™redisæ¨¡å—çš„ç‰ˆæœ¬åŠ¡å¿…æ˜¯2.10.6</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å¦‚æœredisæ¨¡å—çš„ç‰ˆæœ¬ä¸æ˜¯2.10.6åˆ™é‡æ–°å®‰è£…ï¼špip install redis==2.10.6</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>lpush</span><span class=p>(</span><span class=s1>&#39;xiaoshuo&#39;</span><span class=p>,</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æ•°æ®å­˜å‚¨redisæˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>MongoPipeline</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>conn</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1>#é“¾æ¥å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=n>db_sanqi</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1>#æ•°æ®ä»“åº“</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>open_spider</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>conn</span> <span class=o>=</span> <span class=n>pymongo</span><span class=o>.</span><span class=n>MongoClient</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=n>host</span><span class=o>=</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>port</span><span class=o>=</span><span class=mi>27017</span>
</span></span><span class=line><span class=cl>          <span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>db_sanqi</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=p>[</span><span class=s1>&#39;sanqi&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_item</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>item</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>db_sanqi</span><span class=p>[</span><span class=s1>&#39;xiaoshuo&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>insert_one</span><span class=p>({</span><span class=s1>&#39;title&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æ’å…¥æˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></div></li><li><p>é…ç½®æ–‡ä»¶ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  ITEM_PIPELINES = {
</span></span><span class=line><span class=cl>     #æ•°å­—è¡¨ç¤ºç®¡é“ç±»è¢«æ‰§è¡Œçš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜
</span></span><span class=line><span class=cl>     &#39;xiaoshuoPro.pipelines.MysqlPipeline&#39;: 300,
</span></span><span class=line><span class=cl>     &#39;xiaoshuoPro.pipelines.RedisPipeLine&#39;: 301,
</span></span><span class=line><span class=cl>     &#39;xiaoshuoPro.pipelines.MongoPipeline&#39;: 302,
</span></span><span class=line><span class=cl>  }
</span></span></code></pre></div></li></ul><h3 id=scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ®>scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ®<a hidden class=anchor aria-hidden=true href=#scrapyçˆ¬å–å¤šåª’ä½“èµ„æºæ•°æ®>#</a></h3><ul><li><p>ä½¿ç”¨ä¸€ä¸ªä¸“æœ‰çš„ç®¡é“ç±»ImagesPipeline</p></li><li><p>å…·ä½“çš„ç¼–ç æµç¨‹ï¼š</p><ul><li><p>1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œå›¾ç‰‡/è§†é¢‘çš„é“¾æ¥æå–</p></li><li><p>2.å°†æå–åˆ°çš„é“¾æ¥å°è£…åˆ°itemså¯¹è±¡ä¸­ï¼Œæäº¤ç»™ç®¡é“</p></li><li><p>3.åœ¨ç®¡é“æ–‡ä»¶ä¸­è‡ªå®šä¹‰ä¸€ä¸ªçˆ¶ç±»ä¸ºImagesPipelineçš„ç®¡é“ç±»ï¼Œä¸”é‡å†™ä¸‰ä¸ªæ–¹æ³•å³å¯ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>get_media_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>):</span><span class=n>æ¥æ”¶çˆ¬è™«æ–‡ä»¶æäº¤è¿‡æ¥çš„itemå¯¹è±¡</span><span class=err>ï¼Œ</span><span class=n>ç„¶åå¯¹å›¾ç‰‡åœ°å€å‘èµ·ç½‘è·¯è¯·æ±‚</span><span class=err>ï¼Œ</span><span class=n>è¿”å›å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>file_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>item</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span><span class=err>ï¼š</span><span class=n>æŒ‡å®šä¿å­˜å›¾ç‰‡çš„åç§°</span>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>item_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>results</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>)</span><span class=err>ï¼š</span><span class=n>è¿”å›itemå¯¹è±¡ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±»</span>
</span></span></code></pre></div></li></ul></li><li><p>4.åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯æŒ‡å®šçš„ç®¡é“ï¼Œä¸”é€šè¿‡IMAGES_STORE = &lsquo;girlsLib&rsquo;æ“ä½œæŒ‡å®šå›¾ç‰‡å­˜å‚¨çš„æ–‡ä»¶å¤¹ã€‚</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Define your item pipelines here</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
</span></span><span class=line><span class=cl><span class=c1># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scrapy.pipelines.images</span> <span class=kn>import</span> <span class=n>ImagesPipeline</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#è‡ªå®šä¹‰çš„ç®¡é“ç±»ä¸€å®šè¦ç»§æ‰¿ä¸ImagesPipeline</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>mediaPileline</span><span class=p>(</span><span class=n>ImagesPipeline</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1>#é‡å†™ä¸‰ä¸ªçˆ¶ç±»çš„æ–¹æ³•æ¥å®Œæˆå›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®çš„è¯·æ±‚å’ŒæŒä¹…åŒ–å­˜å‚¨</span>
</span></span><span class=line><span class=cl>    <span class=c1>#å¯ä»¥æ ¹æ®å›¾ç‰‡åœ°å€ï¼Œå¯¹å…¶è¿›è¡Œè¯·æ±‚ï¼Œè·å–å›¾ç‰‡æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=c1>#å‚æ•°itemï¼šå°±æ˜¯æ¥æ”¶åˆ°çš„itemå¯¹è±¡</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_media_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>img_src</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;src&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>img_src</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#æŒ‡å®šå›¾ç‰‡çš„åç§°ï¼ˆåªéœ€è¦è¿”å›å›¾ç‰‡å­˜å‚¨çš„åç§°å³å¯ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>file_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>item</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>imgName</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>imgName</span><span class=p>,</span><span class=s1>&#39;ä¸‹è½½ä¿å­˜æˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>imgName</span>
</span></span><span class=line><span class=cl>    <span class=c1>#å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªç®¡é“ç±»ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¸å†™</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>item_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>results</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>item</span> <span class=c1>#å¯ä»¥å°†å½“å‰çš„ç®¡é“ç±»æ¥æ”¶åˆ°itemå¯¹è±¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªç®¡é“ç±»2.</span>
</span></span></code></pre></div></li></ul><h3 id=scrapyæ·±åº¦çˆ¬å–>scrapyæ·±åº¦çˆ¬å–<a hidden class=anchor aria-hidden=true href=#scrapyæ·±åº¦çˆ¬å–>#</a></h3><ul><li><p>å¦‚ä½•çˆ¬å–å¤šé¡µçš„æ•°æ®ï¼ˆå…¨ç«™æ•°æ®çˆ¬å–ï¼‰</p><ul><li><p>æ‰‹åŠ¨è¯·æ±‚å‘é€ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1>#callbackç”¨æ¥æŒ‡å®šè§£ææ–¹æ³•</span>
</span></span><span class=line><span class=cl>  <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>new_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li></ul></li><li><p>å¦‚ä½•çˆ¬å–æ·±åº¦å­˜å‚¨çš„æ•°æ®</p><ul><li><p>ä»€ä¹ˆæ˜¯æ·±åº¦ï¼Œè¯´ç™½äº†å°±æ˜¯çˆ¬å–çš„æ•°æ®æ²¡æœ‰å­˜åœ¨äºåŒä¸€å¼ é¡µé¢ä¸­ã€‚</p></li><li><p>å¿…é¡»ä½¿ç”¨è¯·æ±‚ä¼ å‚çš„æœºåˆ¶æ‰å¯ä»¥å®Œæ•´çš„å®ç°ã€‚</p><ul><li><p>è¯·æ±‚ä¼ å‚ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>meta</span><span class=o>=</span><span class=p>{},</span><span class=n>url</span><span class=o>=</span><span class=n>detail_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_detail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>å¯ä»¥å°†metaå­—å…¸ä¼ é€’ç»™callbackè¿™ä¸ªå›è°ƒå‡½æ•°</span>
</span></span></code></pre></div></li></ul></li></ul></li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>..items</span> <span class=kn>import</span> <span class=n>DeepproItem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeepSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;deep&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>    <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://wz.sun0769.com/political/index/politicsNewest&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=c1>#è§£æé¦–é¡µæ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;/html/body/div[2]/div[3]/ul[2]/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./span[3]/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>detail_url</span> <span class=o>=</span> <span class=s1>&#39;https://wz.sun0769.com&#39;</span><span class=o>+</span><span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./span[3]/a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1># print(title)</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>DeepproItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>            <span class=c1>#å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚</span>
</span></span><span class=line><span class=cl>            <span class=c1>#å‚æ•°metaå¯ä»¥å°†è‡ªèº«è¿™ä¸ªå­—å…¸ä¼ é€’ç»™callbackæŒ‡å®šçš„å›è°ƒå‡½æ•°</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>},</span><span class=n>url</span><span class=o>=</span><span class=n>detail_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_detail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#è§£æè¯¦æƒ…é¡µæ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse_detail</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>meta</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span> <span class=c1>#æ¥æ”¶è¯·æ±‚ä¼ å‚è¿‡æ¥çš„metaå­—å…¸</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;/html/body/div[3]/div[2]/div[2]/div[2]//text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(content)</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>item</span>
</span></span></code></pre></div><h3 id=imagepipelinesçš„è¯·æ±‚ä¼ å‚>ImagePipeLinesçš„è¯·æ±‚ä¼ å‚<a hidden class=anchor aria-hidden=true href=#imagepipelinesçš„è¯·æ±‚ä¼ å‚>#</a></h3><ul><li><p>ç¯å¢ƒå®‰è£…ï¼špip install Pillow</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  USER_AGENT = &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.109 Safari/537.36&#39;
</span></span></code></pre></div></li><li><p>éœ€æ±‚ï¼šå°†å›¾ç‰‡çš„åç§°å’Œè¯¦æƒ…é¡µä¸­å›¾ç‰‡çš„æ•°æ®è¿›è¡Œçˆ¬å–ï¼ŒæŒä¹…åŒ–å­˜å‚¨ã€‚</p><ul><li><p>åˆ†æï¼š</p><ul><li>æ·±åº¦çˆ¬å–ï¼šè¯·æ±‚ä¼ å‚</li><li>å¤šé¡µçš„æ•°æ®çˆ¬å–ï¼šæ‰‹åŠ¨è¯·æ±‚çš„å‘é€</li></ul></li><li><p>çˆ¬è™«æ–‡ä»¶ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>..items</span> <span class=kn>import</span> <span class=n>DeepimgproItem</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>ImgSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;img&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://pic.netbian.com/4kmeinv/&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#é€šç”¨çš„urlæ¨¡æ¿</span>
</span></span><span class=line><span class=cl>      <span class=n>url_model</span> <span class=o>=</span> <span class=s1>&#39;https://pic.netbian.com/4kmeinv/index_</span><span class=si>%d</span><span class=s1>.html&#39;</span>
</span></span><span class=line><span class=cl>      <span class=n>page_num</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#è§£æå‡ºäº†å›¾ç‰‡çš„åç§°å’Œè¯¦æƒ…é¡µçš„url</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;main&#34;]/div[3]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./a/b/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span> <span class=o>+</span> <span class=s1>&#39;.jpg&#39;</span>
</span></span><span class=line><span class=cl>              <span class=n>detail_url</span> <span class=o>=</span> <span class=s1>&#39;https://pic.netbian.com&#39;</span><span class=o>+</span><span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span> <span class=o>=</span> <span class=n>DeepimgproItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>              <span class=c1>#éœ€è¦å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚ï¼Œåœ¨è¯¦æƒ…é¡µä¸­è·å–å›¾ç‰‡çš„ä¸‹è½½é“¾æ¥</span>
</span></span><span class=line><span class=cl>              <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>detail_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>detail_parse</span><span class=p>,</span><span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>})</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>page_num</span> <span class=o>&lt;=</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>new_url</span> <span class=o>=</span> <span class=nb>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>url_model</span><span class=o>%</span><span class=bp>self</span><span class=o>.</span><span class=n>page_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=bp>self</span><span class=o>.</span><span class=n>page_num</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>              <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>new_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=c1>#è§£æè¯¦æƒ…é¡µçš„æ•°æ®</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>detail_parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>meta</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span> <span class=o>=</span> <span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=n>img_src</span> <span class=o>=</span> <span class=s1>&#39;https://pic.netbian.com&#39;</span><span class=o>+</span><span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;img&#34;]/img/@src&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span><span class=p>[</span><span class=s1>&#39;img_src&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>img_src</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>yield</span> <span class=n>item</span>
</span></span></code></pre></div></li><li><p>ç®¡é“ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define your item pipelines here</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># Don&#39;t forget to add your pipeline to the ITEM_PIPELINES setting</span>
</span></span><span class=line><span class=cl>  <span class=c1># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy.pipelines.images</span> <span class=kn>import</span> <span class=n>ImagesPipeline</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>DeepimgproPipeline</span><span class=p>(</span><span class=n>ImagesPipeline</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=c1># def process_item(self, item, spider):</span>
</span></span><span class=line><span class=cl>      <span class=c1>#     return item</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>get_media_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>img_src</span> <span class=o>=</span> <span class=n>item</span><span class=p>[</span><span class=s1>&#39;img_src&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=c1>#è¯·æ±‚ä¼ å‚ï¼Œå°†itemä¸­çš„å›¾ç‰‡åç§°ä¼ é€’ç»™file_pathæ–¹æ³•</span>
</span></span><span class=line><span class=cl>          <span class=c1>#metaä¼šå°†è‡ªèº«ä¼ é€’ç»™file_path</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>],</span><span class=s1>&#39;ä¿å­˜ä¸‹è½½æˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>img_src</span><span class=p>,</span><span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;title&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>file_path</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>info</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>item</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#è¿”å›å›¾ç‰‡çš„åç§°</span>
</span></span><span class=line><span class=cl>          <span class=c1>#æ¥æ”¶è¯·æ±‚ä¼ å‚è¿‡æ¥çš„æ•°æ®</span>
</span></span><span class=line><span class=cl>          <span class=n>title</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>item_completed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>results</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=n>info</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>item</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡>å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡<a hidden class=anchor aria-hidden=true href=#å¦‚ä½•æé«˜scrapyçš„çˆ¬å–æ•ˆç‡>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>å¢åŠ å¹¶å‘ï¼š
</span></span><span class=line><span class=cl>    é»˜è®¤scrapyå¼€å¯çš„å¹¶å‘çº¿ç¨‹ä¸º32ä¸ªï¼Œå¯ä»¥é€‚å½“è¿›è¡Œå¢åŠ ã€‚åœ¨settingsé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹CONCURRENT_REQUESTS = 100å€¼ä¸º100,å¹¶å‘è®¾ç½®æˆäº†ä¸º100ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>é™ä½æ—¥å¿—çº§åˆ«ï¼š
</span></span><span class=line><span class=cl>    åœ¨è¿è¡Œscrapyæ—¶ï¼Œä¼šæœ‰å¤§é‡æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºï¼Œä¸ºäº†å‡å°‘CPUçš„ä½¿ç”¨ç‡ã€‚å¯ä»¥è®¾ç½®logè¾“å‡ºä¿¡æ¯ä¸ºWORNINGæˆ–è€…ERRORå³å¯ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šLOG_LEVEL = â€˜ERRORâ€™
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç¦æ­¢cookieï¼š
</span></span><span class=line><span class=cl>    å¦‚æœä¸æ˜¯çœŸçš„éœ€è¦cookieï¼Œåˆ™åœ¨scrapyçˆ¬å–æ•°æ®æ—¶å¯ä»¥ç¦æ­¢cookieä»è€Œå‡å°‘CPUçš„ä½¿ç”¨ç‡ï¼Œæå‡çˆ¬å–æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šCOOKIES_ENABLED = False
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç¦æ­¢é‡è¯•ï¼š
</span></span><span class=line><span class=cl>    å¯¹å¤±è´¥çš„HTTPè¿›è¡Œé‡æ–°è¯·æ±‚ï¼ˆé‡è¯•ï¼‰ä¼šå‡æ…¢çˆ¬å–é€Ÿåº¦ï¼Œå› æ­¤å¯ä»¥ç¦æ­¢é‡è¯•ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šRETRY_ENABLED = False
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å‡å°‘ä¸‹è½½è¶…æ—¶ï¼š
</span></span><span class=line><span class=cl>    å¦‚æœå¯¹ä¸€ä¸ªéå¸¸æ…¢çš„é“¾æ¥è¿›è¡Œçˆ¬å–ï¼Œå‡å°‘ä¸‹è½½è¶…æ—¶å¯ä»¥èƒ½è®©å¡ä½çš„é“¾æ¥å¿«é€Ÿè¢«æ”¾å¼ƒï¼Œä»è€Œæå‡æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™ï¼šDOWNLOAD_TIMEOUT = 10 è¶…æ—¶æ—¶é—´ä¸º10s
</span></span></code></pre></div><h3 id=postè¯·æ±‚å‘é€>postè¯·æ±‚å‘é€<a hidden class=anchor aria-hidden=true href=#postè¯·æ±‚å‘é€>#</a></h3><ul><li><p>é—®é¢˜ï¼šåœ¨ä¹‹å‰ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»æ¥æ²¡æœ‰æ‰‹åŠ¨çš„å¯¹start_urlsåˆ—è¡¨ä¸­å­˜å‚¨çš„èµ·å§‹urlè¿›è¡Œè¿‡è¯·æ±‚çš„å‘é€ï¼Œä½†æ˜¯èµ·å§‹urlçš„ç¡®æ˜¯è¿›è¡Œäº†è¯·æ±‚çš„å‘é€ï¼Œé‚£è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><ul><li><p>è§£ç­”ï¼šå…¶å®æ˜¯å› ä¸ºçˆ¬è™«æ–‡ä»¶ä¸­çš„çˆ¬è™«ç±»ç»§æ‰¿åˆ°äº†Spiderçˆ¶ç±»ä¸­çš„start_requestsï¼ˆselfï¼‰è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±å¯ä»¥å¯¹start_urlsåˆ—è¡¨ä¸­çš„urlå‘èµ·è¯·æ±‚ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>start_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>u</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>           <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>u</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>)</span>
</span></span></code></pre></div></li><li><p>ã€æ³¨æ„ã€‘è¯¥æ–¹æ³•é»˜è®¤çš„å®ç°ï¼Œæ˜¯å¯¹èµ·å§‹çš„urlå‘èµ·getè¯·æ±‚ï¼Œå¦‚æœæƒ³å‘èµ·postè¯·æ±‚ï¼Œåˆ™éœ€è¦å­ç±»é‡å†™è¯¥æ–¹æ³•ã€‚</p><ul><li>yield scrapy.Request():å‘èµ·getè¯·æ±‚</li><li>yield scrapy.FormRequest():å‘èµ·postè¯·æ±‚</li></ul></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>FanyiSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;fanyi&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://fanyi.baidu.com/sug&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯ç”¨æ¥ç»™èµ·å§‹çš„urlåˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªurlå‘è¯·æ±‚</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>start_requests</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;kw&#39;</span><span class=p>:</span><span class=s1>&#39;dog&#39;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>url</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=c1>#formdataæ˜¯ç”¨æ¥æŒ‡å®šè¯·æ±‚å‚æ•°</span>
</span></span><span class=line><span class=cl>              <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>FormRequest</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>,</span><span class=n>formdata</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>result</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=scrapyçš„æ ¸å¿ƒç»„ä»¶>scrapyçš„æ ¸å¿ƒç»„ä»¶<a hidden class=anchor aria-hidden=true href=#scrapyçš„æ ¸å¿ƒç»„ä»¶>#</a></h3><ul><li>ä»ä¸­å¯ä»¥å¤§è‡´äº†è§£scrapyæ¡†æ¶çš„ä¸€ä¸ªè¿è¡Œæœºåˆ¶</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>-</span> <span class=err>å¼•æ“</span><span class=p>(</span><span class=n>Scrapy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=err>ç”¨æ¥å¤„ç†æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æµå¤„ç†</span><span class=p>,</span> <span class=err>è§¦å‘äº‹åŠ¡</span><span class=p>(</span><span class=err>æ¡†æ¶æ ¸å¿ƒ</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=err>è°ƒåº¦å™¨</span><span class=p>(</span><span class=n>Scheduler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=err>ç”¨æ¥æ¥å—å¼•æ“å‘è¿‡æ¥çš„è¯·æ±‚</span><span class=p>,</span> <span class=err>å‹å…¥é˜Ÿåˆ—ä¸­</span><span class=p>,</span> <span class=err>å¹¶åœ¨å¼•æ“å†æ¬¡è¯·æ±‚çš„æ—¶å€™è¿”å›</span><span class=o>.</span> <span class=err>å¯ä»¥æƒ³åƒæˆä¸€ä¸ª</span><span class=n>URL</span><span class=err>ï¼ˆæŠ“å–ç½‘é¡µçš„ç½‘å€æˆ–è€…è¯´æ˜¯é“¾æ¥ï¼‰çš„ä¼˜å…ˆé˜Ÿåˆ—</span><span class=p>,</span> <span class=err>ç”±å®ƒæ¥å†³å®šä¸‹ä¸€ä¸ªè¦æŠ“å–çš„ç½‘å€æ˜¯ä»€ä¹ˆ</span><span class=p>,</span> <span class=err>åŒæ—¶å»é™¤é‡å¤çš„ç½‘å€</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=err>ä¸‹è½½å™¨</span><span class=p>(</span><span class=n>Downloader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=err>ç”¨äºä¸‹è½½ç½‘é¡µå†…å®¹</span><span class=p>,</span> <span class=err>å¹¶å°†ç½‘é¡µå†…å®¹è¿”å›ç»™èœ˜è››</span><span class=p>(</span><span class=n>Scrapyä¸‹è½½å™¨æ˜¯å»ºç«‹åœ¨twistedè¿™ä¸ªé«˜æ•ˆçš„å¼‚æ­¥æ¨¡å‹ä¸Šçš„</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=err>çˆ¬è™«</span><span class=p>(</span><span class=n>Spiders</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=err>çˆ¬è™«æ˜¯ä¸»è¦å¹²æ´»çš„</span><span class=p>,</span> <span class=err>ç”¨äºä»ç‰¹å®šçš„ç½‘é¡µä¸­æå–è‡ªå·±éœ€è¦çš„ä¿¡æ¯</span><span class=p>,</span> <span class=err>å³æ‰€è°“çš„å®ä½“</span><span class=p>(</span><span class=n>Item</span><span class=p>)</span><span class=err>ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥ä»ä¸­æå–å‡ºé“¾æ¥</span><span class=p>,</span><span class=err>è®©</span><span class=n>Scrapyç»§ç»­æŠ“å–ä¸‹ä¸€ä¸ªé¡µé¢</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=err>é¡¹ç›®ç®¡é“</span><span class=p>(</span><span class=n>Pipeline</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=err>è´Ÿè´£å¤„ç†çˆ¬è™«ä»ç½‘é¡µä¸­æŠ½å–çš„å®ä½“ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯æŒä¹…åŒ–å®ä½“ã€éªŒè¯å®ä½“çš„æœ‰æ•ˆæ€§ã€æ¸…é™¤ä¸éœ€è¦çš„ä¿¡æ¯ã€‚å½“é¡µé¢è¢«çˆ¬è™«è§£æåï¼Œå°†è¢«å‘é€åˆ°é¡¹ç›®ç®¡é“ï¼Œå¹¶ç»è¿‡å‡ ä¸ªç‰¹å®šçš„æ¬¡åºå¤„ç†æ•°æ®ã€‚</span>
</span></span></code></pre></div><h3 id=ä¸­é—´ä»¶>ä¸­é—´ä»¶<a hidden class=anchor aria-hidden=true href=#ä¸­é—´ä»¶>#</a></h3><ul><li><p>scrapyçš„ä¸­é—´ä»¶æœ‰ä¸¤ä¸ªï¼š</p><ul><li>çˆ¬è™«ä¸­é—´ä»¶</li><li>ä¸‹è½½ä¸­é—´ä»¶</li><li>ä¸­é—´ä»¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>è§‚æµ‹ä¸­é—´ä»¶åœ¨äº”å¤§æ ¸å¿ƒç»„ä»¶çš„ä»€ä¹ˆä½ç½®ï¼Œæ ¹æ®ä½ç½®äº†è§£ä¸­é—´ä»¶çš„ä½œç”¨<ul><li>ä¸‹è½½ä¸­é—´ä»¶ä½äºå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´</li><li>å¼•æ“ä¼šç»™ä¸‹è½½å™¨ä¼ é€’è¯·æ±‚å¯¹è±¡ï¼Œä¸‹è½½å™¨ä¼šç»™å¼•æ“è¿”å›å“åº”å¯¹è±¡ã€‚</li><li>ä½œç”¨ï¼šå¯ä»¥æ‹¦æˆªåˆ°scrapyæ¡†æ¶ä¸­æ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”ã€‚<ul><li>æ‹¦æˆªè¯·æ±‚å¹²ä»€ä¹ˆï¼Ÿ<ul><li>ä¿®æ”¹è¯·æ±‚çš„ipï¼Œä¿®æ”¹è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼Œè®¾ç½®è¯·æ±‚çš„cookie</li></ul></li><li>æ‹¦æˆªå“åº”å¹²ä»€ä¹ˆï¼Ÿ<ul><li>å¯ä»¥ä¿®æ”¹å“åº”æ•°æ®</li></ul></li></ul></li></ul></li></ul></li></ul></li><li><p>ä¸­é—´ä»¶é‡è¦æ–¹æ³•ï¼š</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define here the models for your spider middleware</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># See documentation in:</span>
</span></span><span class=line><span class=cl>  <span class=c1># https://docs.scrapy.org/en/latest/topics/spider-middleware.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy</span> <span class=kn>import</span> <span class=n>signals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>is_item</span><span class=p>,</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>MiddleproDownloaderMiddleware</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>#ç±»æ–¹æ³•ï¼šä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªä¸‹è½½å™¨å¯¹è±¡ï¼ˆå¿½ç•¥ï¼‰</span>
</span></span><span class=line><span class=cl>      <span class=nd>@classmethod</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>from_crawler</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>crawler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1># This method is used by Scrapy to create your spiders.</span>
</span></span><span class=line><span class=cl>          <span class=n>s</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>crawler</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>spider_opened</span><span class=p>,</span> <span class=n>signal</span><span class=o>=</span><span class=n>signals</span><span class=o>.</span><span class=n>spider_opened</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šrequestå°±æ˜¯æ‹¦æˆªåˆ°çš„è¯·æ±‚å¯¹è±¡ï¼Œspiderçˆ¬è™«æ–‡ä»¶ä¸­çˆ¬è™«ç±»å®ä¾‹åŒ–çš„å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#spiderå‚æ•°çš„ä½œç”¨å¯ä»¥å®ç°çˆ¬è™«ç±»å’Œä¸­é—´ç±»çš„æ•°æ®äº¤äº’</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šresponseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡ï¼Œrequestå°±æ˜¯è¢«æ‹¦æˆªåˆ°å“åº”å¯¹è±¡å¯¹åº”çš„å”¯ä¸€çš„ä¸€ä¸ªè¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå’Œå¤„ç†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šreqeustå°±æ˜¯æ‹¦æˆªåˆ°çš„å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_exception</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>exception</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=k>pass</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ§åˆ¶æ—¥å¿—æ•°æ®çš„ï¼ˆå¿½ç•¥ï¼‰</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>spider_opened</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>spider</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Spider opened: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>spider</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span></code></pre></div></li></ul><h4 id=å¼€å‘ä»£ç†ä¸­é—´ä»¶>å¼€å‘ä»£ç†ä¸­é—´ä»¶<a hidden class=anchor aria-hidden=true href=#å¼€å‘ä»£ç†ä¸­é—´ä»¶>#</a></h4><ul><li><p>request.meta[&lsquo;proxy&rsquo;] = proxy</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define here the models for your spider middleware</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># See documentation in:</span>
</span></span><span class=line><span class=cl>  <span class=c1># https://docs.scrapy.org/en/latest/topics/spider-middleware.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy</span> <span class=kn>import</span> <span class=n>signals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>is_item</span><span class=p>,</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy</span> <span class=kn>import</span> <span class=n>Request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>MiddleproDownloaderMiddleware</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=c1>#ç±»æ–¹æ³•ï¼šä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªä¸‹è½½å™¨å¯¹è±¡ï¼ˆå¿½ç•¥ï¼‰</span>
</span></span><span class=line><span class=cl>      <span class=nd>@classmethod</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>from_crawler</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>crawler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1># This method is used by Scrapy to create your spiders.</span>
</span></span><span class=line><span class=cl>          <span class=n>s</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>crawler</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>spider_opened</span><span class=p>,</span> <span class=n>signal</span><span class=o>=</span><span class=n>signals</span><span class=o>.</span><span class=n>spider_opened</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šrequestå°±æ˜¯æ‹¦æˆªåˆ°çš„è¯·æ±‚å¯¹è±¡ï¼Œspiderçˆ¬è™«æ–‡ä»¶ä¸­çˆ¬è™«ç±»å®ä¾‹åŒ–çš„å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#spiderå‚æ•°çš„ä½œç”¨å¯ä»¥å®ç°çˆ¬è™«ç±»å’Œä¸­é—´ç±»çš„æ•°æ®äº¤äº’</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#æ˜¯çš„æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯ç”¨ä»£ç†ï¼Œåˆ™ä»£ç†æ“ä½œå¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­</span>
</span></span><span class=line><span class=cl>          <span class=n>request</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;proxy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;http://ip:port&#39;</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å¼Šç«¯ï¼šä¼šä½¿å¾—æ•´ä½“çš„è¯·æ±‚æ•ˆç‡å˜ä½</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;:è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå¤„ç†æ‰€æœ‰çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šresponseå°±æ˜¯æ‹¦æˆªåˆ°çš„å“åº”å¯¹è±¡ï¼Œrequestå°±æ˜¯è¢«æ‹¦æˆªåˆ°å“åº”å¯¹è±¡å¯¹åº”çš„å”¯ä¸€çš„ä¸€ä¸ªè¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;:å“åº”å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ‹¦æˆªå’Œå¤„ç†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#å‚æ•°ï¼šreqeustå°±æ˜¯æ‹¦æˆªåˆ°çš„å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ–¹æ³•å­˜åœ¨çš„æ„ä¹‰ï¼šå°†å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚æ‹¦æˆªåˆ°ï¼Œç„¶åå¯¹å…¶è¿›è¡Œä¿®æ­£</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_exception</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>exception</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;:å‘ç”Ÿå¼‚å¸¸çš„è¯·æ±‚å¯¹è±¡è¢«æ‹¦æˆªåˆ°ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=c1>#ä¿®æ­£æ“ä½œ</span>
</span></span><span class=line><span class=cl>          <span class=c1>#åªæœ‰å‘ç”Ÿäº†å¼‚å¸¸çš„è¯·æ±‚æ‰ä½¿ç”¨ä»£ç†æœºåˆ¶ï¼Œåˆ™å¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­</span>
</span></span><span class=line><span class=cl>          <span class=n>request</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;proxy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;https://ip:port&#39;</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=n>request</span> <span class=c1>#å¯¹è¯·æ±‚å¯¹è±¡è¿›è¡Œé‡æ–°å‘é€</span>
</span></span><span class=line><span class=cl>      <span class=c1>#æ§åˆ¶æ—¥å¿—æ•°æ®çš„ï¼ˆå¿½ç•¥ï¼‰</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>spider_opened</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>spider</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Spider opened: </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>spider</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span></code></pre></div></li></ul><h4 id=å¼€å‘uaä¸­é—´ä»¶>å¼€å‘UAä¸­é—´ä»¶<a hidden class=anchor aria-hidden=true href=#å¼€å‘uaä¸­é—´ä»¶>#</a></h4><ul><li><p>request.headers[&lsquo;User-Agent&rsquo;] = ua</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;User-Agent&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;ä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªUAå€¼&#39;</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;:è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kc>None</span>
</span></span></code></pre></div></li></ul><h4 id=å¼€å‘cookieä¸­é—´ä»¶>å¼€å‘Cookieä¸­é—´ä»¶<a hidden class=anchor aria-hidden=true href=#å¼€å‘cookieä¸­é—´ä»¶>#</a></h4><ul><li><p>request.cookies = cookies</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;cookie&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1>#request.cookies = &#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;:è¯·æ±‚å¯¹è±¡æ‹¦æˆªæˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kc>None</span>
</span></span></code></pre></div></li></ul><h4 id=seleniumscrapy>selenium+scrapy<a hidden class=anchor aria-hidden=true href=#seleniumscrapy>#</a></h4><ul><li><p>éœ€æ±‚ï¼šå°†ç½‘æ˜“æ–°é—»ä¸­çš„å›½å†…ï¼Œå›½é™…ï¼Œå†›äº‹ï¼Œèˆªç©ºå››ä¸ªæ¿å—ä¸‹çš„æ–°é—»æ ‡é¢˜å’Œå†…å®¹è¿›è¡Œæ•°æ®çˆ¬å–</p><ul><li>æ³¨æ„ï¼šå“ªäº›æ•°æ®æ˜¯åŠ¨æ€åŠ è½½çš„ï¼</li><li>æŠ€æœ¯ï¼šseleniumï¼Œscrapyï¼Œä¸­é—´ä»¶</li></ul></li><li><p>åˆ†æï¼š</p><ul><li>æŠ“å–é¦–é¡µä¸­å››ä¸ªæ¿å—ä¸‹æ‰€æœ‰çš„æ–°é—»æ ‡é¢˜å’Œæ–°é—»å†…å®¹<ul><li>è·å–é¦–é¡µä¸­å››ä¸ªæ¿å—å¯¹åº”çš„è¯¦æƒ…é¡µé“¾æ¥<ul><li>é¦–é¡µæ˜¯æ²¡æœ‰åŠ¨æ€åŠ è½½æ•°æ®ï¼Œå¯ä»¥ç›´æ¥çˆ¬å–+è§£æ</li></ul></li></ul></li><li>å¯¹æ¯ä¸€ä¸ªæ¿å—çš„urlå‘èµ·è¯·æ±‚ï¼Œè·å–è¯¦æƒ…é¡µä¸­çš„æ–°é—»æ ‡é¢˜ç­‰å†…å®¹<ul><li>é€šè¿‡åˆ†æå‘ç°æ¯ä¸€ä¸ªæ¿å—ä¸­çš„æ–°é—»æ•°æ®å…¨éƒ¨æ˜¯åŠ¨æ€åŠ è½½çš„æ•°æ®ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ<ul><li>é€šè¿‡seleniumè§£å†³</li></ul></li></ul></li></ul></li><li><p>scrapy+seleniumçš„ç¼–ç æµç¨‹</p><ul><li>1.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­å®šä¹‰æµè§ˆå™¨å¯¹è±¡ï¼Œå°†æµè§ˆå™¨å¯¹è±¡ä½œä¸ºçˆ¬è™«ç±»çš„ä¸€ä¸ªæˆå‘˜å˜é‡</li><li>2.åœ¨ä¸­é—´ä»¶ä¸­é€šè¿‡spiderè·å–çˆ¬è™«æ–‡ä»¶ä¸­å®šä¹‰çš„æµè§ˆå™¨å¯¹è±¡ï¼Œè¿›è¡Œè¯·æ±‚å‘é€å’Œè·å–å“åº”æ•°æ®</li><li>3.åœ¨çˆ¬è™«æ–‡ä»¶ä¸­é‡å†™ä¸€ä¸ªclosedæ–¹æ³•ï¼Œæ¥å…³é—­æµè§ˆå™¨å¯¹è±¡</li></ul></li><li><p>çˆ¬è™«æ–‡ä»¶</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>..items</span> <span class=kn>import</span> <span class=n>WangyiproItem</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>selenium</span> <span class=kn>import</span> <span class=n>webdriver</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>WangyiSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;wangyi&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://news.163.com/&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#åˆ›å»ºæµè§ˆå™¨å¯¹è±¡ï¼ŒæŠŠæµè§ˆå™¨å¯¹è±¡ä½œä¸ºçˆ¬è™«ç±»çš„ä¸€ä¸ªæˆå‘˜</span>
</span></span><span class=line><span class=cl>      <span class=n>bro</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=n>executable_path</span><span class=o>=</span><span class=s1>&#39;/Users/zhangxiaobo/Desktop/ä¸‰æœŸ/chromedriver1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>model_urls</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1>#å­˜å‚¨4ä¸ªæ¿å—å¯¹åº”çš„url</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#ä»é¦–é¡µè§£ææ¯ä¸€ä¸ªæ¿å—å¯¹åº”è¯¦æƒ…é¡µçš„urlï¼Œå°†å…¶å­˜å‚¨åˆ°model_urlsåˆ—è¡¨ä¸­</span>
</span></span><span class=line><span class=cl>          <span class=n>model_index</span> <span class=o>=</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;index2016_wrap&#34;]/div[3]/div[2]/div[2]/div[2]/div/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=n>model_index</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>model_url</span> <span class=o>=</span> <span class=n>li_list</span><span class=p>[</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=bp>self</span><span class=o>.</span><span class=n>model_urls</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>model_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=c1>#åº”è¯¥å¯¹æ¯ä¸€ä¸ªæ¿å—çš„è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚ï¼ˆåŠ¨æ€åŠ è½½ï¼‰</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>model_url</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>model_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_detail</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=c1>#ç›®çš„æ˜¯ä¸ºäº†è§£æå‡ºæ¯ä¸€ä¸ªæ¿å—ä¸­çš„æ–°é—»æ ‡é¢˜å’Œæ–°é—»è¯¦æƒ…é¡µçš„url</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse_detail</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#responseå°±æ˜¯ä¸€ä¸ªä¸ç¬¦åˆéœ€æ±‚è¦æ±‚çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=c1>#è¯¥responseä¸­æ²¡æœ‰å­˜å‚¨åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®ï¼Œå› æ­¤è¯¥å“åº”å¯¹è±¡è¢«è§†ä¸ºä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=c1>#éœ€è¦å°†ä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡å˜ä¸ºç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡å³å¯ï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ</span>
</span></span><span class=line><span class=cl>              <span class=c1>#æ–¹æ³•ï¼šç¯¡æ”¹ä¸ç¬¦åˆè¦æ±‚çš„å“åº”å¯¹è±¡çš„å“åº”æ•°æ®ï¼Œå°†è¯¥å“åº”å¯¹è±¡çš„å“åº”æ•°æ®ä¿®æ”¹ä¸ºåŒ…å«äº†åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®å³å¯ã€‚</span>
</span></span><span class=line><span class=cl>          <span class=n>div_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;/html/body/div/div[3]/div[4]/div[1]/div[1]/div/ul/li/div/div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>div</span> <span class=ow>in</span> <span class=n>div_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                  <span class=c1>#è§£ææ–°é—»æ ‡é¢˜+æ–°é—»è¯¦æƒ…é¡µçš„url</span>
</span></span><span class=line><span class=cl>                  <span class=n>title</span> <span class=o>=</span> <span class=n>div</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div/div[1]/h3/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=n>new_detail_url</span> <span class=o>=</span> <span class=n>div</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div/div[1]/h3/a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=n>item</span> <span class=o>=</span> <span class=n>WangyiproItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>              <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                  <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;é‡åˆ°äº†å¹¿å‘Šï¼Œå¿½ç•¥æ­¤æ¬¡è¡Œä¸ºå³å¯ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=c1>#å¯¹æ–°é—»çš„è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=n>new_detail_url</span> <span class=o>!=</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                  <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>new_detail_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>new_content_parse</span><span class=p>,</span><span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>new_content_parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=c1>#è§£ææ–°é—»çš„è¯¦æƒ…å†…å®¹</span>
</span></span><span class=line><span class=cl>          <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;content&#34;]/div[2]//text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>content</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>yield</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>#é‡å†™ä¸€ä¸ªçˆ¶ç±»æ–¹æ³•ï¼Œclose_spiderï¼Œè¯¥æ–¹æ³•åªä¼šåœ¨çˆ¬è™«æœ€åæ‰§è¡Œä¸€æ¬¡</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>closed</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å…³é—­æµè§ˆå™¨</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;å…³é—­æµè§ˆå™¨æˆåŠŸï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=bp>self</span><span class=o>.</span><span class=n>bro</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
</span></span></code></pre></div></li></ul></li><li><p>ä¸­é—´ä»¶æ–‡ä»¶ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1># Define here the models for your spider middleware</span>
</span></span><span class=line><span class=cl>  <span class=c1>#</span>
</span></span><span class=line><span class=cl>  <span class=c1># See documentation in:</span>
</span></span><span class=line><span class=cl>  <span class=c1># https://docs.scrapy.org/en/latest/topics/spider-middleware.html</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy</span> <span class=kn>import</span> <span class=n>signals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># useful for handling different item types with a single interface</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>itemadapter</span> <span class=kn>import</span> <span class=n>is_item</span><span class=p>,</span> <span class=n>ItemAdapter</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>time</span> <span class=kn>import</span> <span class=n>sleep</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>scrapy.http</span> <span class=kn>import</span> <span class=n>HtmlResponse</span><span class=c1>#scrapyå°è£…çš„å“åº”å¯¹è±¡å¯¹åº”çš„ç±»</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>WangyiproDownloaderMiddleware</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_request</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å¯ä»¥æ‹¦æˆªåˆ°æ‰€æœ‰çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å½“å‰é¡¹ç›®ä¸€å…±ä¼šäº§ç”Ÿå¤šå°‘ä¸ªå“åº”å¯¹è±¡å‘¢ï¼Ÿ</span>
</span></span><span class=line><span class=cl>           <span class=c1>#1 + 4 + nä¸ªå“åº”å¯¹è±¡ï¼Œåœ¨è¿™äº›å“åº”å¯¹è±¡ä¸­åªæœ‰4è¿™4ä¸ªå“åº”å¯¹è±¡éœ€è¦è¢«ä¿®æ”¹</span>
</span></span><span class=line><span class=cl>          <span class=c1>#å¦‚ä½•ç­›é€‰å‡ºæŒ‡å®šçš„4ä¸ªæ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡å‘¢ï¼Ÿ</span>
</span></span><span class=line><span class=cl>              <span class=c1>#1.å¯ä»¥å…ˆæ‰¾å‡ºæŒ‡å®š4ä¸ªæ¿å—çš„è¯·æ±‚å¯¹è±¡ï¼Œç„¶åæ ¹æ®è¯·æ±‚å¯¹è±¡å®šä½æŒ‡å®š4ä¸ªå“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=c1>#2.å¯ä»¥æ ¹æ®4ä¸ªæ¿å—çš„urlå®šä½åˆ°å››ä¸ªæ¿å—çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>          <span class=n>model_urls</span> <span class=o>=</span> <span class=n>spider</span><span class=o>.</span><span class=n>model_urls</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span> <span class=ow>in</span> <span class=n>model_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>bro</span> <span class=o>=</span> <span class=n>spider</span><span class=o>.</span><span class=n>bro</span> <span class=c1>#ä»çˆ¬è™«ç±»ä¸­è·å–åˆ›å»ºå¥½çš„æµè§ˆå™¨å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=n>bro</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=c1># bro.execute_script(&#39;document.documentElement.scrollTo(0,9000)&#39;)</span>
</span></span><span class=line><span class=cl>              <span class=c1># sleep(1)</span>
</span></span><span class=line><span class=cl>              <span class=c1>#è·å–åŠ¨æ€åŠ è½½çš„æ•°æ®</span>
</span></span><span class=line><span class=cl>              <span class=n>page_text</span> <span class=o>=</span> <span class=n>bro</span><span class=o>.</span><span class=n>page_source</span>
</span></span><span class=line><span class=cl>              <span class=c1>#è¯´æ˜è¯¥requestå°±æ˜¯æŒ‡å®šå“åº”å¯¹è±¡çš„è¯·æ±‚å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=c1>#æ­¤å¤„çš„responseå°±æ˜¯æŒ‡å®šæ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡</span>
</span></span><span class=line><span class=cl>              <span class=n>response</span> <span class=o>=</span> <span class=n>HtmlResponse</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>request</span><span class=o>=</span><span class=n>request</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                      <span class=n>body</span><span class=o>=</span><span class=n>page_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                  <span class=c1>#bodyå°±æ˜¯å“åº”å¯¹è±¡çš„å“åº”æ•°æ®</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>          <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>process_exception</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>exception</span><span class=p>,</span> <span class=n>spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>         <span class=k>pass</span>
</span></span></code></pre></div></li></ul></li><li><p>é…ç½®æ–‡ä»¶ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=n>DOWNLOADER_MIDDLEWARES</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;wangyiPro.middlewares.WangyiproDownloaderMiddleware&#39;</span><span class=p>:</span> <span class=mi>543</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div></li></ul></li><li><p>æ‹“å±•åŠŸèƒ½ï¼šå°†äººå·¥æ™ºèƒ½+æ•°æ®çˆ¬å–ä¸­</p><ul><li><p>å®ç°å°†çˆ¬å–åˆ°çš„æ–°é—»è¿›è¡Œåˆ†ç±»å’Œå…³é”®å­—æå–</p><ul><li><p>ç™¾åº¦AIçš„ä½¿ç”¨ï¼šhttps://ai.baidu.com/</p><ul><li><p>ä½¿ç”¨æµç¨‹ï¼š</p><ul><li><p>ç‚¹å‡»é¦–é¡µå³ä¸Šè§’çš„æ§åˆ¶å°ï¼Œè¿›è¡Œç™»å½•ã€‚</p></li><li><p>ç™»å½•åè¿›å…¥åˆ°äº†æ™ºèƒ½äº‘çš„é¦–é¡µ</p><ul><li><p>ç‚¹å‡»é¡µé¢å·¦ä¸Šè§’çš„ä¸‰æ¡æ ï¼Œé€‰æ‹©ä½ æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œç‚¹å‡»ï¼Œè¿›å…¥åˆ°æŒ‡å®šåŠŸèƒ½é¡µé¢</p><ul><li>åœ¨åŠŸèƒ½é¡µé¢ï¼Œé¦–å…ˆç‚¹å‡»ã€åˆ›å»ºåº”ç”¨ã€‘ï¼Œè¿›è¡Œåº”ç”¨çš„åˆ›å»º</li><li>åˆ›å»ºå¥½ä¹‹åï¼Œç‚¹å‡»ç®¡ç†åº”ç”¨å°±å¯ä»¥çœ‹åˆ°ï¼š<ul><li>AppIDï¼ŒapiKeyï¼Œsecret keyè¿™ä¸‰ä¸ªå€¼ï¼Œä¼šåœ¨ç¨‹åºä¸­ç”¨åˆ°</li></ul></li></ul></li><li><p>åœ¨åŠŸèƒ½é¡µé¢ç‚¹å‡»å·¦ä¾§çš„ã€æŠ€æœ¯æ–‡æ¡£ã€‘ï¼Œé€‰æ‹©SDKè¯´æ˜ï¼Œé€‰æ‹©å¯¹åº”çš„Pythonè¯­è¨€å³å¯ï¼Œå…ˆçœ‹å¿«é€Ÿå¼€å§‹å†…å®¹ï¼Œåœ¨é€‰æ‹©ä½ æƒ³è¦å®ç°çš„å…·ä½“åŠŸèƒ½çš„æ–‡æ¡£ç•Œé¢å³å¯ã€‚</p><ul><li>ç¯å¢ƒå®‰è£…ï¼špip install baidu-aip</li></ul></li><li><p>æå–æ–‡ç« å…³é”®å­—ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>aip</span> <span class=kn>import</span> <span class=n>AipNlp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34; ä½ çš„ APPID AK SK &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>APP_ID</span> <span class=o>=</span> <span class=s1>&#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>API_KEY</span> <span class=o>=</span> <span class=s1>&#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>SECRET_KEY</span> <span class=o>=</span> <span class=s1>&#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>client</span> <span class=o>=</span> <span class=n>AipNlp</span><span class=p>(</span><span class=n>APP_ID</span><span class=p>,</span> <span class=n>API_KEY</span><span class=p>,</span> <span class=n>SECRET_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>title</span> <span class=o>=</span> <span class=s2>&#34;iphoneæ‰‹æœºå‡ºç°â€œç™½è‹¹æœâ€åŸå› åŠè§£å†³åŠæ³•ï¼Œç”¨è‹¹æœæ‰‹æœºçš„å¯ä»¥çœ‹ä¸‹&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=s2>&#34;å¦‚æœä¸‹é¢çš„æ–¹æ³•è¿˜æ˜¯æ²¡æœ‰è§£å†³ä½ çš„é—®é¢˜å»ºè®®æ¥æˆ‘ä»¬é—¨åº—çœ‹ä¸‹æˆéƒ½å¸‚é”¦æ±ŸåŒºçº¢æ˜Ÿè·¯ä¸‰æ®µ99å·é“¶çŸ³å¹¿åœº24å±‚01å®¤ã€‚&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34; è°ƒç”¨æ–‡ç« æ ‡ç­¾ &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>keyword</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=n>dic</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;items&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=n>dic</span><span class=p>[</span><span class=s1>&#39;score&#39;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mf>0.8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>key</span> <span class=o>=</span> <span class=n>dic</span><span class=p>[</span><span class=s1>&#39;tag&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=nb>print</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li><li><p>æ–‡ç« åˆ†ç±»ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>aip</span> <span class=kn>import</span> <span class=n>AipNlp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34; ä½ çš„ APPID AK SK &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>APP_ID</span> <span class=o>=</span> <span class=s1>&#39;xxx&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>API_KEY</span> <span class=o>=</span> <span class=s1>&#39;x&#39;</span>
</span></span><span class=line><span class=cl>  <span class=n>SECRET_KEY</span> <span class=o>=</span> <span class=s1>&#39;xx&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>client</span> <span class=o>=</span> <span class=n>AipNlp</span><span class=p>(</span><span class=n>APP_ID</span><span class=p>,</span> <span class=n>API_KEY</span><span class=p>,</span> <span class=n>SECRET_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>title</span> <span class=o>=</span> <span class=s2>&#34;ç§¦åˆšè®¿é—®ç‰¹æ–¯æ‹‰ç¾å›½å·¥å‚é©¬æ–¯å…‹é™ªåŒ ä¼ é€’ä»€ä¹ˆä¿¡å·ï¼Ÿ&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>content</span> <span class=o>=</span> <span class=s2>&#34;ä»Šå¤©ï¼ˆ4æ—¥ï¼‰ï¼Œé©»ç¾å¤§ä½¿ç§¦åˆšè®¿é—®äº†ç‰¹æ–¯æ‹‰ç¡…è°·å·¥å‚ï¼ŒåŒç‰¹æ–¯æ‹‰CEOé©¬æ–¯å…‹é’ˆå¯¹å„é¡¹å°–ç«¯ç§‘æŠ€ã€äººç±»æœªæ¥ç­‰ä¸»é¢˜å±•å¼€æ¢è®¨ï¼Œå¹¶ä½“éªŒäº†ç‰¹æ–¯æ‹‰çš„æ–°æ¬¾Model SåŠæœ€æ–°è‡ªåŠ¨è¾…åŠ©é©¾é©¶ç³»ç»Ÿã€‚ä»–åœ¨æµ·å¤–ç¤¾äº¤å¹³å°ä¸Šè¡¨ç¤ºï¼šâ€œæ€§èƒ½å¼ºåŠ²ï¼Œä½†ä¹˜åå¹³é¡ºèˆ’é€‚â€ã€‚&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&#34;&#34; è°ƒç”¨æ–‡ç« åˆ†ç±» &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>topic</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=n>class_new</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>][</span><span class=s1>&#39;lv1_tag_list&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;tag&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nb>print</span><span class=p>(</span><span class=n>class_new</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><h3 id=crawlspider>CrawlSpider<a hidden class=anchor aria-hidden=true href=#crawlspider>#</a></h3><ul><li><p>å®ç°ç½‘ç«™çš„å…¨ç«™æ•°æ®çˆ¬å–</p><ul><li>å°±æ˜¯å°†ç½‘ç«™ä¸­æ‰€æœ‰é¡µç å¯¹åº”çš„é¡µé¢æ•°æ®è¿›è¡Œçˆ¬å–ã€‚</li></ul></li><li><p>crawlspiderå…¶å®å°±æ˜¯scrapyå°è£…å¥½çš„ä¸€ä¸ªçˆ¬è™«ç±»ï¼Œé€šè¿‡è¯¥ç±»æä¾›çš„ç›¸å…³çš„æ–¹æ³•å’Œå±æ€§å°±å¯ä»¥å®ç°å…¨æ–°é«˜æ•ˆå½¢å¼çš„å…¨ç«™æ•°æ®çˆ¬å–ã€‚</p></li><li><p>ä½¿ç”¨æµç¨‹ï¼š</p><ul><li><p>æ–°å»ºä¸€ä¸ªscrapyé¡¹ç›®</p></li><li><p>cd é¡¹ç›®</p></li><li><p>åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼ˆ*ï¼‰ï¼š</p><ul><li><p>scrapy genspider-t crawl spiderName <a href=https://www.xxx.com>www.xxx.com</a></p></li><li><p>çˆ¬è™«æ–‡ä»¶ä¸­å‘ç”Ÿçš„å˜åŒ–æœ‰å“ªäº›ï¼Ÿ</p><ul><li>å½“å‰çˆ¬è™«ç±»çš„çˆ¶ç±»ä¸ºCrawlSpider</li><li>çˆ¬è™«ç±»ä¸­å¤šäº†ä¸€ä¸ªç±»å˜é‡å«åšrules<ul><li>LinkExtractorï¼šé“¾æ¥æå–å™¨<ul><li>å¯ä»¥æ ¹æ®allowå‚æ•°è¡¨ç¤ºçš„æ­£åˆ™åœ¨å½“å‰é¡µé¢ä¸­æå–ç¬¦åˆæ­£åˆ™è¦æ±‚çš„é“¾æ¥</li></ul></li><li>Ruleï¼šè§„åˆ™è§£æå™¨<ul><li>å¯ä»¥æ¥æ”¶é“¾æ¥æå–å™¨æå–åˆ°çš„é“¾æ¥ï¼Œå¹¶ä¸”å¯¹æ¯ä¸€ä¸ªé“¾æ¥è¿›è¡Œè¯·æ±‚å‘é€</li><li>å¯ä»¥æ ¹æ®callbackæŒ‡å®šçš„å›è°ƒå‡½æ•°å¯¹æ¯ä¸€æ¬¡è¯·æ±‚åˆ°çš„æ•°æ®è¿›è¡Œæ•°æ®è§£æ</li></ul></li></ul></li><li>æ€è€ƒ:å¦‚ä½•å°†ä¸€ä¸ªç½‘ç«™ä¸­æ‰€æœ‰çš„é“¾æ¥éƒ½æå–åˆ°å‘¢ï¼Ÿ<ul><li>åªéœ€è¦åœ¨é“¾æ¥æå–å™¨çš„allowåé¢èµ‹å€¼ä¸€ä¸ªç©ºæ­£åˆ™è¡¨è¾¾å¼å³å¯</li></ul></li><li>ç›®å‰åœ¨scrapyä¸­æœ‰å‡ ç§å‘é€è¯·æ±‚çš„æ–¹å¼ï¼Ÿ<ul><li>start_urlsåˆ—è¡¨å¯ä»¥å‘é€è¯·æ±‚</li><li>scrapy.Request()</li><li>scrapy.FormRequest()</li><li>Ruleè§„åˆ™è§£æå™¨</li></ul></li></ul></li></ul></li></ul></li><li><p>æ³¨æ„ï¼š</p><ul><li>é“¾æ¥æå–å™¨å’Œè§„åˆ™è§£æå™¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ˆä¸€å¯¹ä¸€çš„å…³ç³»ï¼‰</li><li>å»ºè®®åœ¨ä½¿ç”¨crawlSpiderå®ç°æ·±åº¦çˆ¬å–çš„æ—¶å€™ï¼Œéœ€è¦é…åˆæ‰‹åŠ¨è¯·æ±‚å‘é€çš„æ–¹å¼è¿›è¡Œæ­é…ï¼</li></ul></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  USER_AGENT = &#39;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36&#39;
</span></span></code></pre></div></li></ul><h3 id=åˆ†å¸ƒå¼>åˆ†å¸ƒå¼<a hidden class=anchor aria-hidden=true href=#åˆ†å¸ƒå¼>#</a></h3><ul><li><p>åˆ†å¸ƒå¼åœ¨æ—¥å¸¸å¼€å‘ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œåªæ˜¯ä¸€ä¸ªå™±å¤´ï¼</p></li><li><p>æ¦‚å¿µï¼š</p><ul><li>å¯ä»¥ä½¿ç”¨å¤šå°ç”µè„‘æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼æœºç¾¤ï¼Œä½¿å¾—å¤šå°å¯¹ç”µè„‘å¯ä»¥å¯¹åŒä¸€ä¸ªç½‘ç«™çš„æ•°æ®è¿›è¡Œè”åˆä¸”åˆ†å¸ƒçš„æ•°æ®çˆ¬å–ã€‚</li></ul></li><li><p>å£°æ˜ï¼š</p><ul><li>åŸç”Ÿçš„scrapyæ¡†æ¶å¹¶æ— æ³•å®ç°åˆ†å¸ƒå¼æ“ä½œï¼whyï¼Ÿ<ul><li>å¤šå°ç”µè„‘ä¹‹é—´æ— æ³•å…±äº«åŒä¸€ä¸ªè°ƒåº¦å™¨</li><li>å¤šå°ç”µè„‘ä¹‹é—´æ— æ³•å…±äº«åŒä¸€ä¸ªç®¡é“</li></ul></li></ul></li><li><p>å¦‚ä½•æ˜¯çš„scrapyå¯ä»¥å®ç°åˆ†å¸ƒå¼å‘¢ï¼Ÿ</p><ul><li>å€ŸåŠ©äºä¸€ä¸ªç»„ä»¶ï¼šscrapy-redis</li><li>scrapy-redisçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>å¯ä»¥ç»™åŸç”Ÿçš„scrapyæ¡†æ¶æä¾›å¯è¢«å…±äº«çš„è°ƒåº¦å™¨å’Œç®¡é“ï¼</li><li>ç¯å¢ƒå®‰è£…ï¼špip install scrapy-redis<ul><li>æ³¨æ„ï¼šscrapy-redisè¯¥ç»„ä»¶åªå¯ä»¥å°†çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨åˆ°redisæ•°æ®åº“</li></ul></li></ul></li></ul></li><li><p>ç¼–ç æµç¨‹ï¼ˆé‡ç‚¹ï¼‰ï¼š</p><ul><li><p>1.åˆ›å»ºé¡¹ç›®</p></li><li><p>2.cd é¡¹ç›®</p></li><li><p>3.åˆ›å»ºåŸºäºcrawlSpiderçš„çˆ¬è™«æ–‡ä»¶</p><ul><li>3.1 ä¿®æ”¹çˆ¬è™«æ–‡ä»¶<ul><li>å¯¼åŒ…ï¼šfrom scrapy_redis.spiders import RedisCrawlSpider</li><li>ä¿®æ”¹å½“å‰çˆ¬è™«ç±»çš„çˆ¶ç±»ä¸º RedisCrawlSpider</li><li>å°†start_urlsæ›¿æ¢æˆredis_keyçš„æ“ä½œ<ul><li>redis_keyå˜é‡çš„èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²è¡¨ç¤ºè°ƒåº¦å™¨é˜Ÿåˆ—çš„åç§°</li></ul></li><li>è¿›è¡Œå¸¸è§„çš„è¯·æ±‚æ“ä½œå’Œæ•°æ®è§£æ</li></ul></li></ul></li><li><p>4.settingsé…ç½®æ–‡ä»¶çš„ä¿®æ”¹</p><ul><li><p>å¸¸è§„å†…å®¹ä¿®æ”¹ï¼ˆrobotså’Œuaç­‰ï¼‰ï¼Œå…ˆä¸æŒ‡å®šæ—¥å¿—ç­‰çº§</p></li><li><p>æŒ‡å®šå¯ä»¥è¢«å…±äº«çš„ç®¡é“ç±»</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  ITEM_PIPELINES = {
</span></span><span class=line><span class=cl>      &#39;scrapy_redis.pipelines.RedisPipeline&#39;: 400
</span></span><span class=line><span class=cl>  }
</span></span></code></pre></div></li></ul></li><li><p>æŒ‡å®šå¯ä»¥è¢«å…±äº«çš„è°ƒåº¦å™¨</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  # ä½¿ç”¨scrapy-redisç»„ä»¶çš„å»é‡é˜Ÿåˆ—
</span></span><span class=line><span class=cl>  DUPEFILTER_CLASS = &#34;scrapy_redis.dupefilter.RFPDupeFilter&#34;
</span></span><span class=line><span class=cl>  # ä½¿ç”¨scrapy-redisç»„ä»¶è‡ªå·±çš„è°ƒåº¦å™¨
</span></span><span class=line><span class=cl>  SCHEDULER = &#34;scrapy_redis.scheduler.Scheduler&#34;
</span></span><span class=line><span class=cl>  # æ˜¯å¦å…è®¸æš‚åœ
</span></span><span class=line><span class=cl>  SCHEDULER_PERSIST = True
</span></span></code></pre></div></li></ul></li><li><p>æŒ‡å®šæ•°æ®åº“</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  REDIS_HOST = &#39;127.0.0.1&#39;
</span></span><span class=line><span class=cl>  REDIS_PORT = 6379
</span></span></code></pre></div></li></ul></li></ul></li><li><p>5.ä¿®æ”¹redisæ•°æ®åº“çš„é…ç½®æ–‡ä»¶ï¼ˆredis.windows.confï¼‰</p><ul><li><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ”¹è¡Œä»£ç æ˜¯æ²¡æœ‰æ²¡æ³¨é‡Šçš„ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  bind 127.0.0.1
</span></span><span class=line><span class=cl>  #å°†ä¸Šè¿°ä»£ç æ³¨é‡Šå³å¯ï¼ˆè§£é™¤æœ¬æœºç»‘å®šï¼Œå®ç°å¤–éƒ¨è®¾å¤‡è®¿é—®æœ¬æœºæ•°æ®åº“
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  å¦‚æœé…ç½®æ–‡ä»¶ä¸­è¿˜å­˜åœ¨ï¼šprotected-mode = trueï¼Œå°†trueä¿®æ”¹ä¸ºfalseï¼Œ
</span></span><span class=line><span class=cl>  ä¿®æ”¹ä¸ºfalseåè¡¨ç¤ºredisæ•°æ®åº“å…³é—­äº†ä¿æŠ¤æ¨¡å¼ï¼Œè¡¨ç¤ºå…¶ä»–è®¾å¤‡å¯ä»¥è¿œç¨‹è®¿é—®ä¸”ä¿®æ”¹ä½ æ•°æ®åº“ä¸­çš„æ•°æ®
</span></span></code></pre></div></li></ul></li></ul></li><li><p>6.å¯åŠ¨redisæ•°æ®åº“çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</p></li><li><p>7.è¿è¡Œé¡¹ç›®,å‘ç°ç¨‹åºæš‚å®šä¸€ç›´åœ¨ç­‰å¾…ï¼Œç­‰å¾…çˆ¬å–ä»»åŠ¡</p></li><li><p>8.éœ€è¦å‘å¯ä»¥è¢«å…±äº«çš„è°ƒåº¦å™¨çš„é˜Ÿåˆ—ï¼ˆredis_keyçš„å€¼ï¼‰ä¸­æ”¾å…¥ä¸€ä¸ªèµ·å§‹çš„url</p><ul><li><p>åœ¨redisæ•°æ®åº“çš„å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>lpush é˜Ÿåˆ—åç§° èµ·å§‹çš„url</li><li>èµ·å§‹urlï¼šhttps://wz.sun0769.com/political/index/politicsNewest?id=1&amp;page=1</li></ul></li></ul></li></ul></li></ul><h3 id=å¢é‡å¼>å¢é‡å¼<a hidden class=anchor aria-hidden=true href=#å¢é‡å¼>#</a></h3><ul><li><p>çˆ¬è™«åº”ç”¨åœºæ™¯åˆ†ç±»</p><ul><li>é€šç”¨çˆ¬è™«</li><li>èšç„¦çˆ¬è™«</li><li>åŠŸèƒ½çˆ¬è™«</li><li>åˆ†å¸ƒå¼çˆ¬è™«</li><li>å¢é‡å¼ï¼š<ul><li>ç”¨æ¥ç›‘æµ‹ç½‘ç«™æ•°æ®æ›´æ–°çš„æƒ…å†µï¼ˆçˆ¬å–ç½‘ç«™æœ€æ–°æ›´æ–°å‡ºæ¥çš„æ•°æ®ï¼‰ã€‚</li><li>åªæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡çš„æ€è·¯ï¼Œä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯éƒ½æ˜¯å¯ä»¥å®ç°çš„ã€‚</li><li>æ ¸å¿ƒï¼š<ul><li>å»é‡ã€‚<ul><li>ä½¿ç”¨ä¸€ä¸ªè®°å½•è¡¨æ¥å®ç°æ•°æ®çš„å»é‡ï¼š<ul><li>è®°å½•è¡¨ï¼šå­˜å‚¨çˆ¬å–è¿‡çš„æ•°æ®çš„è®°å½•</li><li>å¦‚ä½•æ„å»ºå’Œè®¾è®¡ä¸€ä¸ªè®°å½•è¡¨ï¼š<ul><li>è®°å½•è¡¨éœ€è¦å…·å¤‡çš„ç‰¹æ€§ï¼š<ul><li>å»é‡</li><li>éœ€è¦æŒä¹…ä¿å­˜çš„</li></ul></li><li>æ–¹æ¡ˆ1ï¼šä½¿ç”¨Pythonçš„seté›†åˆå……å½“è®°å½•è¡¨ï¼Ÿ<ul><li>ä¸å¯ä»¥çš„ï¼å› ä¸ºseté›†åˆæ— æ³•å®ç°æŒä¹…åŒ–å­˜å‚¨</li></ul></li><li>æ–¹æ¡ˆ2ï¼šä½¿ç”¨redisçš„seté›†åˆå……å½“è®°å½•è¡¨ï¼Ÿ<ul><li>å¯ä»¥çš„ï¼Œå› ä¸ºredisçš„setæ—¢å¯ä»¥å®ç°å»é‡åˆå¯ä»¥è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li><li><p>åŸºäºä¸¤ä¸ªåœºæ™¯å®ç°å¢é‡å¼çˆ¬è™«ï¼š</p><ul><li>åœºæ™¯1ï¼šå¦‚æœçˆ¬å–çš„æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å½“å‰ç½‘é¡µä¸­ï¼Œæ²¡æœ‰æ·±åº¦çš„æ•°æ®çˆ¬å–çš„å¿…è¦ã€‚</li><li>åœºæ™¯2ï¼šçˆ¬å–çš„æ•°æ®å­˜åœ¨äºå½“å‰é¡µå’Œè¯¦æƒ…é¡µä¸­ï¼Œå…·å¤‡æ·±åº¦çˆ¬å–çš„å¿…è¦ã€‚</li></ul></li><li><p>åœºæ™¯1çš„å®ç°ï¼š</p><ul><li><p>æ•°æ®æŒ‡çº¹ï¼š</p><ul><li><p>æ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚è®°å½•è¡¨ä¸­å¯ä»¥ä¸ç›´æ¥å­˜å‚¨æ•°æ®æœ¬èº«ï¼Œç›´æ¥å­˜å‚¨æ•°æ®æŒ‡çº¹æ›´å¥½ä¸€äº›ã€‚</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=c1>#çˆ¬è™«æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>..items</span> <span class=kn>import</span> <span class=n>Zlsdemo1ProItem</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>DuanziSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;duanzi&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://ishuo.cn/&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=c1>#Redisçš„é“¾æ¥å¯¹è±¡</span>
</span></span><span class=line><span class=cl>      <span class=n>conn</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>li_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;list&#34;]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>content</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[1]/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./div[2]/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>all_data</span> <span class=o>=</span> <span class=n>title</span><span class=o>+</span><span class=n>content</span>
</span></span><span class=line><span class=cl>              <span class=c1>#ç”Ÿæˆè¯¥æ•°æ®çš„æ•°æ®æŒ‡çº¹</span>
</span></span><span class=line><span class=cl>              <span class=kn>import</span> <span class=nn>hashlib</span>  <span class=c1># å¯¼å…¥ä¸€ä¸ªç”Ÿæˆæ•°æ®æŒ‡çº¹çš„æ¨¡å—</span>
</span></span><span class=line><span class=cl>              <span class=n>m</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>m</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>all_data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>              <span class=n>data_id</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=n>ex</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=s1>&#39;data_id&#39;</span><span class=p>,</span><span class=n>data_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=n>ex</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span><span class=c1>#saddæ‰§è¡ŒæˆåŠŸï¼ˆæ•°æ®æŒ‡çº¹åœ¨seté›†åˆä¸­ä¸å­˜åœ¨ï¼‰</span>
</span></span><span class=line><span class=cl>                  <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æœ‰æœ€æ–°æ•°æ®çš„æ›´æ–°ï¼Œæ­£åœ¨çˆ¬å–ä¸­......&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=n>item</span> <span class=o>=</span> <span class=n>Zlsdemo1ProItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                  <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>                  <span class=n>item</span><span class=p>[</span><span class=s1>&#39;content&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>                  <span class=k>yield</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>              <span class=k>else</span><span class=p>:</span><span class=c1>#saddæ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼ˆæ•°æ®æŒ‡çº¹åœ¨seté›†åˆä¸­å­˜å‚¨ï¼‰</span>
</span></span><span class=line><span class=cl>                  <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æš‚æ— æœ€æ–°æ•°æ®æ›´æ–°ï¼Œè¯·ç­‰å¾…......&#39;</span><span class=p>)</span>
</span></span></code></pre></div></li></ul></li></ul></li><li><p>åœºæ™¯2çš„å®ç°ï¼š</p><ul><li><p>ä½¿ç”¨è¯¦æƒ…é¡µçš„urlå……å½“æ•°æ®æŒ‡çº¹å³å¯ã€‚</p></li><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>  <span class=kn>import</span> <span class=nn>redis</span>
</span></span><span class=line><span class=cl>  <span class=kn>from</span> <span class=nn>..items</span> <span class=kn>import</span> <span class=n>Zlsdemo2ProItem</span>
</span></span><span class=line><span class=cl>  <span class=k>class</span> <span class=nc>JianliSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;jianli&#39;</span>
</span></span><span class=line><span class=cl>      <span class=c1># allowed_domains = [&#39;www.xxx.com&#39;]</span>
</span></span><span class=line><span class=cl>      <span class=n>start_urls</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;https://sc.chinaz.com/jianli/free.html&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=n>conn</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>div_list</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;container&#34;]/div&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=k>for</span> <span class=n>div</span> <span class=ow>in</span> <span class=n>div_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>              <span class=n>title</span> <span class=o>=</span> <span class=n>div</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./p/a/text()&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=c1>#å……å½“æ•°æ®æŒ‡çº¹</span>
</span></span><span class=line><span class=cl>              <span class=n>detail_url</span> <span class=o>=</span> <span class=s1>&#39;https:&#39;</span><span class=o>+</span><span class=n>div</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./p/a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>ex</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=s1>&#39;data_id&#39;</span><span class=p>,</span><span class=n>detail_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span> <span class=o>=</span> <span class=n>Zlsdemo2ProItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=n>item</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=n>ex</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                  <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æœ‰æœ€æ–°æ•°æ®çš„æ›´æ–°ï¼Œæ­£åœ¨é‡‡é›†......&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>detail_url</span><span class=p>,</span><span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_detail</span><span class=p>,</span><span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span><span class=n>item</span><span class=p>})</span>
</span></span><span class=line><span class=cl>              <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                  <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;æš‚æ— æ•°æ®æ›´æ–°ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>def</span> <span class=nf>parse_detail</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=n>download_url</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;down&#34;]/div[2]/ul/li[1]/a/@href&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract_first</span><span class=p>()</span>
</span></span><span class=line><span class=cl>          <span class=n>item</span><span class=p>[</span><span class=s1>&#39;download_url&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>download_url</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>yield</span> <span class=n>item</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=scrapyé¡¹ç›®éƒ¨ç½²>scrapyé¡¹ç›®éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#scrapyé¡¹ç›®éƒ¨ç½²>#</a></h3><h4 id=scrapydéƒ¨ç½²å·¥å…·ä»‹ç»>scrapydéƒ¨ç½²å·¥å…·ä»‹ç»<a hidden class=anchor aria-hidden=true href=#scrapydéƒ¨ç½²å·¥å…·ä»‹ç»>#</a></h4><ul><li>scrapydæ˜¯ä¸€ä¸ªç”¨äºéƒ¨ç½²å’Œè¿è¡Œscrapyçˆ¬è™«çš„ç¨‹åºï¼Œå®ƒç”± scrapy å®˜æ–¹æä¾›çš„ã€‚å®ƒå…è®¸ä½ é€šè¿‡JSON APIæ¥<strong>éƒ¨ç½²çˆ¬è™«é¡¹ç›®å’Œæ§åˆ¶çˆ¬è™«è¿è¡Œ</strong>ã€‚</li></ul><blockquote><p>æ‰€è°“json apiæœ¬è´¨å°±æ˜¯postè¯·æ±‚çš„webapi</p></blockquote><ul><li>é€‰æ‹©ä¸€å°ä¸»æœºå½“åšæœåŠ¡å™¨ï¼Œå®‰è£…å¹¶å¯åŠ¨ scrapyd æœåŠ¡ã€‚å†è¿™ä¹‹åï¼Œscrapyd ä¼šä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œç›‘å¬çˆ¬è™«åœ°è¿è¡Œä¸è¯·æ±‚ï¼Œç„¶åå¯åŠ¨è¿›ç¨‹æ¥æ‰§è¡Œçˆ¬è™«ç¨‹åºã€‚</li></ul><h4 id=ç¯å¢ƒå®‰è£…>ç¯å¢ƒå®‰è£…<a hidden class=anchor aria-hidden=true href=#ç¯å¢ƒå®‰è£…>#</a></h4><ul><li>scrapydæœåŠ¡:</li></ul><p>â€‹ <code>pip install scrapyd</code></p><ul><li>scrapydå®¢æˆ·ç«¯:</li></ul><p>â€‹ <code>pip install scrapyd-client</code></p><p>â€‹ ä¸€å®šè¦å®‰è£…è¾ƒæ–°çš„ç‰ˆæœ¬10ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ç°åœ¨å®‰è£…çš„ä¸€èˆ¬éƒ½æ˜¯æ–°ç‰ˆæœ¬</p><h4 id=å¯åŠ¨scrapydæœåŠ¡>å¯åŠ¨scrapydæœåŠ¡<a hidden class=anchor aria-hidden=true href=#å¯åŠ¨scrapydæœåŠ¡>#</a></h4><ul><li>æ‰“å¼€ç»ˆç«¯<strong>åœ¨scrapyé¡¹ç›®è·¯å¾„ä¸‹</strong> å¯åŠ¨scrapydçš„å‘½ä»¤ï¼š <code>scrapyd</code></li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_13.png alt=Snip20220308_13></p><ul><li>scrapyd ä¹Ÿæä¾›äº† web çš„æ¥å£ã€‚æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹å’Œç®¡ç†çˆ¬è™«ç¨‹åºã€‚é»˜è®¤æƒ…å†µä¸‹ scrapyd ç›‘å¬ 6800 ç«¯å£ï¼Œè¿è¡Œ scrapyd åã€‚åœ¨æœ¬æœºä¸Šä½¿ç”¨æµè§ˆå™¨è®¿é—® <code>http://localhost:6800/</code>åœ°å€å³å¯æŸ¥çœ‹åˆ°å½“å‰å¯ä»¥è¿è¡Œçš„é¡¹ç›®ã€‚</li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_14.png alt=Snip20220308_14></p><ul><li>ç‚¹å‡»jobå¯ä»¥æŸ¥çœ‹ä»»åŠ¡ç›‘æ§ç•Œé¢</li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_16.png alt=Snip20220308_16></p><h4 id=scrapyé¡¹ç›®éƒ¨ç½²-1>scrapyé¡¹ç›®éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#scrapyé¡¹ç›®éƒ¨ç½²-1>#</a></h4><h5 id=é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›®>é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›®<a hidden class=anchor aria-hidden=true href=#é…ç½®éœ€è¦éƒ¨ç½²çš„é¡¹ç›®>#</a></h5><ul><li>ç¼–è¾‘éœ€è¦éƒ¨ç½²çš„é¡¹ç›®çš„scrapy.cfgæ–‡ä»¶(éœ€è¦å°†å“ªä¸€ä¸ªçˆ¬è™«éƒ¨ç½²åˆ°scrapydä¸­ï¼Œå°±é…ç½®è¯¥é¡¹ç›®çš„è¯¥æ–‡ä»¶)</li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_17.png alt=Snip20220308_17></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[deploy:éƒ¨ç½²å(éƒ¨ç½²åå¯ä»¥è‡ªè¡Œå®šä¹‰)] 
</span></span><span class=line><span class=cl>url = http://localhost:6800/ 
</span></span><span class=line><span class=cl>project = é¡¹ç›®å(åˆ›å»ºçˆ¬è™«é¡¹ç›®æ—¶ä½¿ç”¨çš„åç§°)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>username = bobo # å¦‚æœä¸éœ€è¦ç”¨æˆ·åå¯ä»¥ä¸å†™
</span></span><span class=line><span class=cl>password = 123456 # å¦‚æœä¸éœ€è¦å¯†ç å¯ä»¥ä¸å†™
</span></span></code></pre></div><h5 id=éƒ¨ç½²é¡¹ç›®åˆ°scrapyd>éƒ¨ç½²é¡¹ç›®åˆ°scrapyd<a hidden class=anchor aria-hidden=true href=#éƒ¨ç½²é¡¹ç›®åˆ°scrapyd>#</a></h5><ul><li><p>åŒæ ·åœ¨<strong>scrapyé¡¹ç›®è·¯å¾„ä¸‹</strong>æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>scrapyd-deploy éƒ¨ç½²å(é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„åç§°) -p é¡¹ç›®åç§°
</span></span></code></pre></div></li><li><p>éƒ¨ç½²æˆåŠŸä¹‹åå°±å¯ä»¥çœ‹åˆ°éƒ¨ç½²çš„é¡¹ç›®</p></li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_18.png alt=Snip20220308_18></p><ul><li><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥éƒ¨ç½²çˆ¬è™«ç»“æœï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  scrapyd-deploy -L éƒ¨ç½²å
</span></span></code></pre></div></li></ul></li></ul><h4 id=ç®¡ç†scrapyé¡¹ç›®>ç®¡ç†scrapyé¡¹ç›®<a hidden class=anchor aria-hidden=true href=#ç®¡ç†scrapyé¡¹ç›®>#</a></h4><h5 id=æŒ‡ä»¤ç®¡ç†>æŒ‡ä»¤ç®¡ç†<a hidden class=anchor aria-hidden=true href=#æŒ‡ä»¤ç®¡ç†>#</a></h5><ul><li><p>å®‰è£…curlå‘½ä»¤è¡Œå·¥å…·</p><ul><li>windowéœ€è¦å®‰è£…</li><li>linuxå’Œmacæ— éœ€å•ç‹¬å®‰è£…</li></ul></li><li><p>windowå®‰è£…æ­¥éª¤ï¼š</p><ul><li>ä¸‹è½½curlæ–‡ä»¶ï¼šhttps://curl.se/download.htmlï¼Œæ‰“å¼€ç½‘é¡µåå‘ä¸‹æ‹–åŠ¨ï¼Œæ‰¾åˆ°windowç³»ç»Ÿå¯¹åº”ç‰ˆæœ¬ä¸‹è½½</li></ul><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/canw0916/picgo_imgs@main/blog/Snip20220308_19.png alt=Snip20220308_19></p><ul><li>ä¸‹è½½åï¼Œæ”¾ç½®åˆ°ä¸€ä¸ªæ— ä¸­æ–‡çš„æ–‡ä»¶å¤¹ä¸‹ç›´æ¥è§£å‹ç¼©ï¼Œè§£å‹åå°†binæ–‡ä»¶å¤¹é…ç½®ç¯å¢ƒå˜é‡ï¼</li><li>å‚è€ƒç½‘é¡µï¼šhttps://www.cnblogs.com/lisa2016/p/12193494.html</li></ul></li><li><p>å¯åŠ¨é¡¹ç›®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://localhost:6800/schedule.json -d project=é¡¹ç›®å -d spider=çˆ¬è™«å
</span></span></code></pre></div><ul><li><p>è¿”å›ç»“æœï¼šæ³¨æ„æœŸä¸­çš„jobidï¼Œåœ¨å…³é—­é¡¹ç›®æ—¶å€™ä¼šç”¨åˆ°</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  {&#34;status&#34;: &#34;ok&#34;, &#34;jobid&#34;: &#34;94bd8ce041fd11e6af1a000c2969bafd&#34;, &#34;node_name&#34;: &#34;james-virtual-machine&#34;}
</span></span></code></pre></div></li></ul></li></ul></li><li><p>å…³é—­é¡¹ç›®ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  curl http://localhost:6800/cancel.json -d project=é¡¹ç›®å -d job=é¡¹ç›®çš„jobid
</span></span></code></pre></div></li></ul></li><li><p>åˆ é™¤çˆ¬è™«é¡¹ç›®ï¼š</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  curl http://localhost:6800/delproject.json -d project=çˆ¬è™«é¡¹ç›®åç§°
</span></span></code></pre></div></li></ul></li></ul><h5 id=requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›®>requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›®<a hidden class=anchor aria-hidden=true href=#requestsæ¨¡å—æ§åˆ¶scrapyé¡¹ç›®>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯åŠ¨çˆ¬è™«</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:6800/schedule.json&#39;</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;project&#39;</span><span class=p>:</span> <span class=n>é¡¹ç›®å</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;spider&#39;</span><span class=p>:</span> <span class=n>çˆ¬è™«å</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>resp</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœæ­¢çˆ¬è™«</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:6800/cancel.json&#39;</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;project&#39;</span><span class=p>:</span> <span class=n>é¡¹ç›®å</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;job&#39;</span><span class=p>:</span> <span class=n>å¯åŠ¨çˆ¬è™«æ—¶è¿”å›çš„jobid</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>resp</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼>#</a></h3><h4 id=è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#è®¤è¯†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>#</a></h4><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯å¼‚æ­¥çˆ¬è™«ä¸­å¾ˆå¸¸è§çš„ä¸€ä¸ªé—®é¢˜ã€‚äº§ç”Ÿæ•°æ®çš„æ¨¡å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç”Ÿäº§è€…ï¼Œè€Œå¤„ç†æ•°æ®çš„æ¨¡å—ï¼Œå°±ç§°ä¸ºæ¶ˆè´¹è€…ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>â€‹ å›¾ç‰‡æ•°æ®çˆ¬å–ä¸­ï¼Œè§£æå‡ºå›¾ç‰‡é“¾æ¥çš„æ“ä½œå°±æ˜¯åœ¨ç”Ÿäº§æ•°æ®</p><p>â€‹ å¯¹å›¾ç‰‡é“¾æ¥å‘èµ·è¯·æ±‚ä¸‹è½½å›¾ç‰‡çš„æ“ä½œå°±æ˜¯åœ¨æ¶ˆè´¹æ•°æ®</p><h4 id=ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼>#</a></h4><blockquote><p>â€‹ åœ¨å¼‚æ­¥ä¸–ç•Œé‡Œï¼Œç”Ÿäº§è€…å°±æ˜¯ç”Ÿäº§æ•°æ®çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…å°±æ˜¯æ¶ˆè´¹æ•°æ®çš„çº¿ç¨‹ã€‚åœ¨å¤šçº¿ç¨‹å¼€å‘å½“ä¸­ï¼Œå¦‚æœç”Ÿäº§è€…å¤„ç†é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦å¾ˆæ…¢ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å°±å¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å®Œï¼Œæ‰èƒ½ç»§ç»­ç”Ÿäº§æ•°æ®ã€‚åŒæ ·çš„é“ç†ï¼Œå¦‚æœæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›å¤§äºç”Ÿäº§è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å°±å¿…é¡»ç­‰å¾…ç”Ÿäº§è€…ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜äºæ˜¯å¼•å…¥äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ã€‚</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>lxml</span> <span class=kn>import</span> <span class=n>etree</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>queue</span> <span class=kn>import</span> <span class=n>Queue</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.request</span> <span class=kn>import</span> <span class=n>urlretrieve</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>time</span> <span class=kn>import</span> <span class=n>sleep</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#ç”Ÿäº§æ•°æ®ï¼šè§£ææå–å›¾ç‰‡åœ°å€</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Producer</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>):</span><span class=c1>#ç”Ÿäº§è€…çº¿ç¨‹</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>page_queue</span><span class=p>,</span><span class=n>img_queue</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>page_queue</span> <span class=o>=</span> <span class=n>page_queue</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>img_queue</span> <span class=o>=</span> <span class=n>img_queue</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>page_queue</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Producerä»»åŠ¡ç»“æŸ&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=c1>#ä»page_queueä¸­å–å‡ºä¸€ä¸ªé¡µç é“¾æ¥</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>page_queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1>#ä»å½“å‰çš„é¡µç å¯¹åº”çš„é¡µé¢ä¸­è§£æå‡ºæ›´å¤šçš„å›¾ç‰‡åœ°å€</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>parse_detail</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse_detail</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>url</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>encoding</span> <span class=o>=</span> <span class=s1>&#39;gbk&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>page_text</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>        <span class=n>tree</span> <span class=o>=</span> <span class=n>etree</span><span class=o>.</span><span class=n>HTML</span><span class=p>(</span><span class=n>page_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>li_list</span> <span class=o>=</span> <span class=n>tree</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;//*[@id=&#34;main&#34;]/div[3]/ul/li&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>li_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>img_src</span> <span class=o>=</span> <span class=s1>&#39;https://pic.netbian.com&#39;</span><span class=o>+</span><span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./a/img/@src&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>img_title</span> <span class=o>=</span> <span class=n>li</span><span class=o>.</span><span class=n>xpath</span><span class=p>(</span><span class=s1>&#39;./a/b/text()&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>+</span><span class=s1>&#39;.jpg&#39;</span>
</span></span><span class=line><span class=cl>            <span class=n>dic</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;title&#39;</span><span class=p>:</span><span class=n>img_title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;src&#39;</span><span class=p>:</span><span class=n>img_src</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>img_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>dic</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#æ¶ˆè´¹æ•°æ®ï¼šå¯¹å›¾ç‰‡åœ°å€è¿›è¡Œæ•°æ®è¯·æ±‚</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Consumer</span><span class=p>(</span><span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>):</span><span class=c1>#æ¶ˆè´¹è€…çº¿ç¨‹</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>page_queue</span><span class=p>,</span><span class=n>img_queue</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>page_queue</span> <span class=o>=</span> <span class=n>page_queue</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>img_queue</span> <span class=o>=</span> <span class=n>img_queue</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>img_queue</span><span class=o>.</span><span class=n>empty</span><span class=p>()</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>page_queue</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Consumerä»»åŠ¡ç»“æŸ&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=n>dic</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>img_queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>title</span> <span class=o>=</span> <span class=n>dic</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>src</span> <span class=o>=</span> <span class=n>dic</span><span class=p>[</span><span class=s1>&#39;src&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>urlretrieve</span><span class=p>(</span><span class=n>src</span><span class=p>,</span><span class=s1>&#39;imgs/&#39;</span><span class=o>+</span><span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>title</span><span class=p>,</span><span class=s1>&#39;ä¸‹è½½å®Œæ¯•ï¼&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1>#è¯¥é˜Ÿåˆ—ä¸­å­˜å‚¨å³å°†è¦è¦å»çš„é¡µé¢é¡µç é“¾æ¥</span>
</span></span><span class=line><span class=cl>    <span class=n>page_queue</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#è¯¥é˜Ÿåˆ—å­˜å‚¨ç”Ÿäº§è€…ç”Ÿäº§å‡ºæ¥çš„å›¾ç‰‡åœ°å€</span>
</span></span><span class=line><span class=cl>    <span class=n>img_queue</span> <span class=o>=</span> <span class=n>Queue</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#è¯¥å¾ªç¯å¯ä»¥å°†2ï¼Œ3ï¼Œ4è¿™ä¸‰ä¸ªé¡µç é“¾æ¥æ”¾å…¥page_queueä¸­</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;https://pic.netbian.com/4kmeinv/index_</span><span class=si>%d</span><span class=s1>.html&#39;</span><span class=o>%</span><span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=n>page_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#ç”Ÿäº§è€…</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>Producer</span><span class=p>(</span><span class=n>page_queue</span><span class=p>,</span><span class=n>img_queue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>#æ¶ˆè´¹è€…</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>Consumer</span><span class=p>(</span><span class=n>page_queue</span><span class=p>,</span><span class=n>img_queue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://canw0916.github.io/img/wxPay.jpg alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://canw0916.github.io/img/aliPay.jpg alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://canw0916.github.io/en/posts/tech/markdown%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Markdownå¿«é€Ÿå…¥é—¨</span>
</a><a class=next href=https://canw0916.github.io/en/posts/tech/mongodb/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>MongoDB</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on twitter" href="https://twitter.com/intent/tweet/?text=Scrapy%e6%a1%86%e6%9e%b6&amp;url=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f&amp;hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f&amp;title=Scrapy%e6%a1%86%e6%9e%b6&amp;summary=Scrapy%e6%a1%86%e6%9e%b6&amp;source=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f&title=Scrapy%e6%a1%86%e6%9e%b6"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on whatsapp" href="https://api.whatsapp.com/send?text=Scrapy%e6%a1%86%e6%9e%b6%20-%20https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a><a target=_blank rel="noopener noreferrer" aria-label="share Scrapyæ¡†æ¶ on telegram" href="https://telegram.me/share/url?text=Scrapy%e6%a1%86%e6%9e%b6&amp;url=https%3a%2f%2fcanw0916.github.io%2fen%2fposts%2ftech%2fscrapy%25E6%25A1%2586%25E6%259E%25B6%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://utteranc.es/client.js repo=canw0916/utterances_comments issue-term=title theme=photon-dark crossorigin=anonymous async></script></div></article></main><script async src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
2023-2025
<a href=https://canw0916.github.io/en/ style=color:#939393>Felix's Blog</a>
All Rights Reserved
</span><a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0">
</a></span><span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>æ€»è®¿å®¢æ•°: <span id=busuanzi_value_site_uv></span>
æ€»è®¿é—®é‡: <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
<span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="ğŸ“„å¤åˆ¶";function s(){t.innerText="ğŸ‘ŒğŸ»å·²å¤åˆ¶!",setTimeout(()=>{t.innerText="ğŸ“„å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`\r
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒFelix's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚\r
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild===n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName==="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://code.jquery.com/jquery-1.12.4.min.js></script><script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&$(this).css("width","135%")}).on("mouseout",function(){$(this).css("width","100%")})</script></body></html>