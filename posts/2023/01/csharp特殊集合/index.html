<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>C#基础提升系列——C#特殊集合 - 火山不火</title><meta name=author content="火山"><meta name=author-link content="https://canw0916.github.io/"><meta name=description content="C# 特殊集合 C#中的特殊集合主要有： 不可变的集合 并发的集合 位数组合位矢量 可观察的集合 不变的集合 如果对象可以改变其状态，就很难在多个同时运行的任务中使用。这些集合必须同步。如果对象不能改变其状态，就很容易"><meta name=keywords content="C#,特殊集合"><meta itemprop=name content="C#基础提升系列——C#特殊集合"><meta itemprop=description content="C# 特殊集合 C#中的特殊集合主要有： 不可变的集合 并发的集合 位数组合位矢量 可观察的集合 不变的集合 如果对象可以改变其状态，就很难在多个同时运行的任务中使用。这些集合必须同步。如果对象不能改变其状态，就很容易"><meta itemprop=datePublished content="2023-01-29T01:20:50+08:00"><meta itemprop=dateModified content="2023-01-29T01:20:50+08:00"><meta itemprop=wordCount content="7008"><meta itemprop=keywords content="C#,特殊集合,"><meta property="og:title" content="C#基础提升系列——C#特殊集合"><meta property="og:description" content="C# 特殊集合 C#中的特殊集合主要有： 不可变的集合 并发的集合 位数组合位矢量 可观察的集合 不变的集合 如果对象可以改变其状态，就很难在多个同时运行的任务中使用。这些集合必须同步。如果对象不能改变其状态，就很容易"><meta property="og:type" content="article"><meta property="og:url" content="https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-29T01:20:50+08:00"><meta property="article:modified_time" content="2023-01-29T01:20:50+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="C#基础提升系列——C#特殊集合"><meta name=twitter:description content="C# 特殊集合 C#中的特殊集合主要有： 不可变的集合 并发的集合 位数组合位矢量 可观察的集合 不变的集合 如果对象可以改变其状态，就很难在多个同时运行的任务中使用。这些集合必须同步。如果对象不能改变其状态，就很容易"><meta name=application-name content="火山不火"><meta name=apple-mobile-web-app-title content="火山不火"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/><link rel=prev href=https://canw0916.github.io/posts/2023/01/csharp%E9%9B%86%E5%90%88/><link rel=next href=https://canw0916.github.io/posts/2023/01/%E5%BE%B7%E8%AF%AD%E5%B9%B2%E8%B4%A7-%E5%BE%B7%E8%AF%AD%E7%AC%AC%E4%B8%80%E6%A0%BC%E6%80%BB%E7%BB%93/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"C#基础提升系列——C#特殊集合","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88\/"},"genre":"posts","keywords":"C#, 特殊集合","wordcount":7008,"url":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88\/","datePublished":"2023-01-29T01:20:50+08:00","dateModified":"2023-01-29T01:20:50+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"火山"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=火山不火 title=火山不火><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=/fixit.min.svg title=/fixit.min.svg><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span title=转载 class=icon-repost><i class="fa-solid fa-share fa-fw" aria-hidden=true></i></span><span>C#基础提升系列——C#特殊集合</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://canw0916.github.io/ title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src=/images/avatar.jpg data-srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" data-sizes=auto alt=火山 title=火山>&nbsp;火山</a></span>
<span class=post-category>收录于 <a href=/categories/%E7%BC%96%E7%A8%8B/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 编程</a></span></div><div class=post-meta-line><span title="2023-01-29 01:20:50"><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-01-29>2023-01-29</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i> 约 7008 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden=true></i> 预计阅读 14 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=C#基础提升系列——C#特殊集合>
<i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#c-特殊集合>C# 特殊集合</a><ul><li><a href=#不变的集合>不变的集合</a><ul><li><a href=#immutablearrayhttpsdocsmicrosoftcomzh-cndotnetapisystemcollectionsimmutableimmutablearrayviewnetcore-21><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablearray?view=netcore-2.1"><code>ImmutableArray</code></a></a></li><li><a href=#immutablelisthttpsdocsmicrosoftcomzh-cndotnetapisystemcollectionsimmutableimmutablelist-1viewnetcore-21><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1?view=netcore-2.1"><code>ImmutableList</code></a></a></li></ul></li><li><a href=#并发集合>并发集合</a></li><li><a href=#处理位的集合>处理位的集合</a><ul><li><a href=#bitarray类><code>BitArray</code>类</a></li><li><a href=#bitvector32结构><code>BitVector32</code>结构</a></li></ul></li><li><a href=#可观察的集合>可观察的集合</a><ul><li><a href=#参考资源>参考资源</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=c-特殊集合>C# 特殊集合</h2><p>C#中的特殊集合主要有：</p><ul><li>不可变的集合</li><li>并发的集合</li><li>位数组合位矢量</li><li>可观察的集合</li></ul><h3 id=不变的集合>不变的集合</h3><p>如果对象可以改变其状态，就很难在多个同时运行的任务中使用。这些集合必须同步。如果对象不能改变其状态，就很容易在多个线程中使用。不能改变的对象称为不变的对象；不能改变的集合称为不变的集合。</p><p>为了使用不可变的集合，需要添加NuGget包<code>System.Collections.Immutalbe</code>，关于此命名空间下的详细介绍，请<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer">点击此处</a>进行查看，本文只对其进行简单的示例说明。</p><h4 id=immutablearrayhttpsdocsmicrosoftcomzh-cndotnetapisystemcollectionsimmutableimmutablearrayviewnetcore-21><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablearray?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableArray</code></a></h4><p>该类提供创建不可变数组的方法。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>ImmutableArray</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>a1</span><span class=o>=</span> <span class=n>ImmutableArray</span><span class=p>.</span><span class=n>Create</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>上述语句用于创建一个string类型的不可变数组，注意，上述虽然都是<code>ImmutableArray</code>，但是却是两种不同的类型：非泛型类<code>ImmutableArray</code>调用<code>Create()</code>静态方法返回泛型<code>ImmutableArray</code>结构。其中，<code>Create</code>方法被重载，这个方法的其他变体允许传送任意数量的元素。</p><p>可以使用<code>Add()</code>方法添加新的元素，<code>Add()</code>方法不会改变不变集合本身，而是返回一个新的不变集合。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>ImmutableArray</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>a2</span><span class=o>=</span> <span class=n>a1</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;java&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>上述语句执行之后，<code>a1</code>仍然是一个空集合，<code>a2</code>是包含一个元素的不变集合。可以链式的重复调用<code>Add()</code>方法，最终返回一个集合：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>ImmutableArray</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>a3</span> <span class=o>=</span> <span class=n>a2</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;c#&#34;</span><span class=p>).</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;python&#34;</span><span class=p>).</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;php&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在使用不变数组的每个阶段，都没有复制完整的集合。相反，不变类型使用了共享状态，仅在需要时复制集合。</p></blockquote><p>通常，先填充集合，再将它变成不变的数组会更高效。当需要进行一些处理时，可以再次使用可变的集合。</p><h4 id=immutablelisthttpsdocsmicrosoftcomzh-cndotnetapisystemcollectionsimmutableimmutablelist-1viewnetcore-21><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableList</code></a></h4><p>表示不可变列表，它是可由索引访问的强类型对象列表。</p><p>示例说明，先定义一个简单的类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>internal</span> <span class=n>class</span> <span class=n>Account</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Name</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>decimal</span> <span class=n>Amount</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>Account</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=n>decimal</span> <span class=n>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Amount</span> <span class=o>=</span> <span class=n>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接着创建<code>List&lt;Account></code>集合，使用<code>ToImmutableList</code>方法将其转换为不变的集合。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>accounts</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;图书&#34;</span><span class=p>,</span><span class=mf>424.2</span><span class=n>m</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;文具&#34;</span><span class=p>,</span><span class=mf>1243.5</span><span class=n>m</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;篮球&#34;</span><span class=p>,</span><span class=mf>243.3</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>//将List转换为不可变集合
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=n>immutableAccounts</span> <span class=o>=</span> <span class=n>accounts</span><span class=p>.</span><span class=nf>ToImmutableList</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//输出每一项的内容
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>immutableAccounts</span><span class=p>.</span><span class=nf>ForEach</span><span class=p>(</span><span class=n>a</span> <span class=o>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>Name</span> <span class=o>+</span> <span class=s>&#34;--&#34;</span> <span class=o>+</span> <span class=n>a</span><span class=p>.</span><span class=n>Amount</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>如果需要更改不变集合的内容，可以使用不变集合的<code>Add、AddRange、Remove、RemoveAt、RemoveRange、Replace</code>以及<code>Sort</code>等方法，这些方法都不是直接改变了原来的不变集合，而是返回一个新的不可变集合。虽然上述这些方法可以创建新的不变集合，但是如果对集合频繁的进行多次修改和删除元素，这就不是非常高效。可以使用<code>ImmutableList&lt;T></code>的<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1.tobuilder?view=netcore-2.1#System_Collections_Immutable_ImmutableList_1_ToBuilder" target=_blank rel="external nofollow noopener noreferrer"><code>ToBuilder()</code></a> 方法，创建一个构建器，该方法返回一个可以改变的集合。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=n>var</span> <span class=n>accounts</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;图书&#34;</span><span class=p>,</span><span class=mf>424.2</span><span class=n>m</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;文具&#34;</span><span class=p>,</span><span class=mf>1243.5</span><span class=n>m</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;篮球&#34;</span><span class=p>,</span><span class=mf>243.3</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=p>};</span>
</span></span><span class=line><span class=cl> <span class=c1>//先得到不可变集合
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=n>immutableAccounts</span> <span class=o>=</span> <span class=n>accounts</span><span class=p>.</span><span class=nf>ToImmutableList</span><span class=p>();</span>
</span></span><span class=line><span class=cl> <span class=c1>//调用ToBuilder()方法将不可变集合创建为可变集合
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span><span class=p>.</span><span class=n>Builder</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>immutableAccounts</span><span class=p>.</span><span class=nf>ToBuilder</span><span class=p>();</span>
</span></span><span class=line><span class=cl> <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>builder</span><span class=p>.</span><span class=n>Count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=n>Account</span> <span class=n>a</span> <span class=o>=</span> <span class=n>builder</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>     <span class=k>if</span> <span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>Amount</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=n>builder</span><span class=p>.</span><span class=nf>Remove</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=c1>//将新创建的可变集合调用ToImmutable()方法得到不可变集合
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=n>overdrawnAccounts</span> <span class=o>=</span> <span class=n>builder</span><span class=p>.</span><span class=nf>ToImmutable</span><span class=p>();</span>
</span></span><span class=line><span class=cl> <span class=n>overdrawnAccounts</span><span class=p>.</span><span class=nf>ForEach</span><span class=p>(</span><span class=n>b</span> <span class=o>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>b</span><span class=p>.</span><span class=n>Name</span> <span class=o>+</span> <span class=s>&#34;=&#34;</span> <span class=o>+</span> <span class=n>b</span><span class=p>.</span><span class=n>Amount</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>除了<code>ImmutableArray</code>和<code>ImmutableList</code>之外，该命名空间下还提供了其他一些不变的集合类型。如：</p><ul><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablearray-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableArray</code></a> ：<code>ImmutableArray&lt;T></code>是一个结构，它在内部使用数组类型，当不允许更改底层类型，这个结构实现了接口<code>IImmutableList&lt;T></code>。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableList</code></a>：<code>ImmutableList&lt;T></code>在内部使用一个二叉树来映射对象，以实现接口<code>IImmutableList&lt;T></code>。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablequeue-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableQueue</code></a> ：<code>ImmutableQueue&lt;T></code> 实现了接口<code>IImmutableQueue&lt;T></code> ，允许使用<code>Enqueue</code>、<code>Dequeue</code>和<code>Peek</code>以先进先出的方式访问元素。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablestack-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableStack</code></a> ：<code>ImmutableStack&lt;T></code> 实现了接口<code>IImmutableStack&lt;T></code>，允许使用<code>Push</code>、<code>Pop</code>和<code>Peek</code>以先进后出的方式访问元素。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutabledictionary-2?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableDictionary</code></a> ：<code>ImmutableDictionary&lt;TKey,TValue></code> 是一个键和值不可变的集合，其无序的键/值对元素实现了接口<code>IImmutableDictionary&lt;TKey,TValue></code> 。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablesorteddictionary-2?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableSortedDictionary</code></a> ：<code>ImmutableSortedDictionary&lt;TKey,TValue></code>是一个不可变的排序字典。其实现了接口<code>IImmutableDictionary&lt;TKey,TValue></code> 。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablehashset-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableHashSet</code></a> ：表示不可变的无序哈希集 ，实现了接口<code>IImmutableSet&lt;T></code> 。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablesortedset-1?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer"><code>ImmutableSortedSet</code></a> ：表示不可变的有序集合，实现了接口<code>IImmutableSet&lt;T></code> 。</li></ul><p>上述的这些不变的集合都实现了对应的接口，与正常集合相比，这些不变接口的最大区别是所有改变集合的方法都返回一个新的集合。</p><h3 id=并发集合>并发集合</h3><p>在命名空间<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>System.Collections.Concurrent</code></a> 中，提供了几个线程安全的集合类，线程安全的集合可以防止多个线程以相互冲突的方式访问集合。下面列出了System.Collections.Concurrent命名空间中常用的类及其功能。</p><ul><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentqueue-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>ConcurrentQueue</code></a> :表示线程安全的先进先出（FIFO）集合。 这个集合类用一种免锁定的算法实现，使用在内部合并到一个链表中的32项数组。访问队列元素的方法有<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentqueue-1.enqueue?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentQueue_1_Enqueue__0_" target=_blank rel="external nofollow noopener noreferrer"><code>Enqueue(T)</code></a> 、<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentqueue-1.trydequeue?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentQueue_1_TryDequeue__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryDequeue(T)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentqueue-1.trypeek?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentQueue_1_TryPeek__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryPeek(T)</code></a> 。这些方法的命名和前面的<code>Queue&lt;T></code>类的方法很像，只是给可能调用失败的方法加上了前缀<code>Try</code>。因为这个类实现了<code>IProducerConsumerCollection&lt;T></code>接口，所以<code>TryAdd()</code>和<code>TryTake()</code>方法仅调用<code>Enqueue()</code>和<code>TryDequeue()</code>方法。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentstack-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>ConcurrentStack</code></a> ：表示线程安全的后进先出（<code>LIFO</code>）集合。 和<code>ConcurrentQueue&lt;T></code>类似，只是访问元素的方法不同。<code>ConcurrentStack&lt;T></code>类定义了<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentstack-1.push?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentStack_1_Push__0_" target=_blank rel="external nofollow noopener noreferrer"><code>Push(T)</code></a> 、<code>PushRange()</code>、<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentstack-1.trypeek?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentStack_1_TryPeek__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryPeek(T)</code></a> 、<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentstack-1.trypop?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentStack_1_TryPop__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryPop(T)</code></a> 和<code>TryPopRange(T[])</code>方法。该类也实现了<code>IProducerConsumerCollection&lt;T></code>接口。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentbag-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>ConcurrentBag</code></a> ：表示线程安全，无序的对象集合。 该类没有定义添加或提取项的任何顺序。这个类使用一个把线程映射到内部使用的数组上的概念，因此尝试减少锁定。访问元素的方法有<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentbag-1.add?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentBag_1_Add__0_" target=_blank rel="external nofollow noopener noreferrer"><code>Add(T)</code></a> 、<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentbag-1.trypeek?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentBag_1_TryPeek__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryPeek(T)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentbag-1.trytake?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentBag_1_TryTake__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryTake(T)</code></a> 。该类也实现了<code>IProducerConsumerCollection&lt;T></code> 接口。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>ConcurrentDictionary</code></a> ：表示可以由多个线程同时访问的键/值对的线程安全集合。<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2.tryadd?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentDictionary_2_TryAdd__0__1_" target=_blank rel="external nofollow noopener noreferrer"><code>TryAdd(TKey, TValue)</code></a> 、 <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2.trygetvalue?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentDictionary_2_TryGetValue__0__1__" target=_blank rel="external nofollow noopener noreferrer"><code>TryGetValue(TKey, TValue)</code></a> 、<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2.tryremove?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentDictionary_2_TryRemove__0__1__" target=_blank rel="external nofollow noopener noreferrer"><code>TryRemove(TKey, TValue)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2.tryupdate?view=netframework-4.7.2#System_Collections_Concurrent_ConcurrentDictionary_2_TryUpdate__0__1__1_" target=_blank rel="external nofollow noopener noreferrer"><code>TryUpdate(TKey, TValue, TValue)</code></a> 方法以非阻塞的方式访问成员。因为元素基于键和值，所以<code>ConcurrentDictionary&lt;TKey,TValue></code> 类没有实现<code>IProducerConsumerCollection&lt;T></code> 接口。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.blockingcollection-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>BlockingCollection</code></a> ：为实现<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.iproducerconsumercollection-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>IProducerConsumerCollection</code> 的</a>线程安全集合提供阻塞和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.iproducerconsumercollection-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer">绑定功能</a>。这个集合可以在添加或提取元素之前，会阻塞线程并一直等待。 <code>BlockingCollection&lt;T></code>集合提供了一个接口，以使用<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.blockingcollection-1.add?view=netframework-4.7.2#System_Collections_Concurrent_BlockingCollection_1_Add__0_" target=_blank rel="external nofollow noopener noreferrer"><code>Add(T)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.blockingcollection-1.take?view=netframework-4.7.2#System_Collections_Concurrent_BlockingCollection_1_Take" target=_blank rel="external nofollow noopener noreferrer"><code>Take()</code></a> 方法来添加和删除元素。这些方法会阻塞线程，一直等到任务可以执行为止。<code>Add()</code>方法有一个重载版本，其中可以给该重载版本传递一个<code>cancellationToken</code>令牌，这个令牌允许取消被阻塞的调用。如果不希望线程无限期的等待下去，且不希望从外部取消调用，就可以使用<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.blockingcollection-1.tryadd?view=netframework-4.7.2#System_Collections_Concurrent_BlockingCollection_1_TryAdd__0_" target=_blank rel="external nofollow noopener noreferrer"><code>TryAdd(T)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.blockingcollection-1.trytake?view=netframework-4.7.2#System_Collections_Concurrent_BlockingCollection_1_TryTake__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryTake(T)</code></a> 方法，在这些方法中，也可以指定一个超时值，它表示在调用失败之前应阻塞线程和等待的最长时间。</li></ul><p>上述类中，有的实现了<code>IProducerConsumerCollection&lt;T></code>接口，<code>IProducerConsumerCollection&lt;T></code>接口提供了<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.iproducerconsumercollection-1.tryadd?view=netframework-4.7.2#System_Collections_Concurrent_IProducerConsumerCollection_1_TryAdd__0_" target=_blank rel="external nofollow noopener noreferrer"><code>TryAdd(T)</code></a> 和<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.iproducerconsumercollection-1.trytake?view=netframework-4.7.2#System_Collections_Concurrent_IProducerConsumerCollection_1_TryTake__0__" target=_blank rel="external nofollow noopener noreferrer"><code>TryTake(T)</code></a> 方法。<code>TryAdd()</code>方法尝试给集合添加一项，返回布尔值；<code>TryTake()</code>方法尝试从集合中删除并返回一个项。</p><blockquote><p>以ConcurrentXXX形式的集合是线程安全的，如果某个动作不适用于线程的当前状态，它们就返回<code>false</code>。在继续之前，总是需要确认添加或提取元素是否成功。不能相信集合 会完成任务。</p><p><code>BlockingCollection&lt;T></code>是对实现了<code>IProducerConsumerCollection&lt;T></code>接口的任意类的修饰器 ，它默认使用<code>ConcurrentQueue&lt;T></code>类。还可以给构造函数传递任何其他实现了<code>IProducerConsumerCollection&lt;T></code>接口的类，例如，<code>ConcurrentBag&lt;T></code>和<code>ConcurrentStack&lt;T></code>。</p></blockquote><p>下面将使用一个完整的示例说明并发集合的应用。该示例基于管道，即一个任务向一个集合类写入一些内容，同时另一个任务从该集合中读取内容。首先定义一个基本类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Info</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Word</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>int</span> <span class=n>Count</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Color</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>override</span> <span class=n>string</span> <span class=nf>ToString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=err>$</span><span class=s>&#34;Word:{Word},Count:{Count},Color:{Color}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>定义向控制台输出的类，使用同步来避免返回颜色错误的输出：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>class</span> <span class=n>ColoredConsole</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=k>static</span> <span class=n>object</span> <span class=n>syncOutput</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>object</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>WriteLine</span><span class=p>(</span><span class=n>string</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>lock</span> <span class=p>(</span><span class=n>syncOutput</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>WriteLine</span><span class=p>(</span><span class=n>string</span> <span class=n>message</span><span class=p>,</span> <span class=n>string</span> <span class=n>color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>lock</span> <span class=p>(</span><span class=n>syncOutput</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>ForegroundColor</span> <span class=o>=</span> <span class=p>(</span><span class=n>ConsoleColor</span><span class=p>)</span><span class=n>Enum</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nf>typeof</span><span class=p>(</span><span class=n>ConsoleColor</span><span class=p>),</span> <span class=n>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>ResetColor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接着定义具体的管道实现，详细说明请参加代码中的注释：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>class</span> <span class=n>PipeLineStages</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>Task</span> <span class=nf>ReadFilenamesAsync</span><span class=p>(</span><span class=n>string</span> <span class=n>path</span><span class=p>,</span> <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//第一个阶段
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=nf>StartNew</span><span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//读取文件名，并把它们添加到队列中
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>foreach</span> <span class=p>(</span><span class=n>string</span> <span class=n>filename</span> <span class=n>in</span> <span class=n>Directory</span><span class=p>.</span><span class=nf>EnumerateFiles</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>path</span><span class=p>,</span> <span class=s>&#34;*.cs&#34;</span><span class=p>,</span> <span class=n>SearchOption</span><span class=p>.</span><span class=n>AllDirectories</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>//添加到BlockingCollection&lt;T&gt;中
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>output</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=n>filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;stage 1: added {filename}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>//通知所有读取器不应再等待集合中的任何额外项
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>output</span><span class=p>.</span><span class=nf>CompleteAdding</span><span class=p>();</span> <span class=c1>//该方法必不可少
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>},</span><span class=n>TaskCreationOptions</span><span class=p>.</span><span class=n>LongRunning</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>async</span> <span class=n>Task</span> <span class=nf>LoadContentAsync</span><span class=p>(</span><span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//第二个阶段：从队列中读取文件名并加载它们的内容，并把内容写入到另一个队列
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//如果不调用GetConsumingEnumerable()方法，而是直接迭代集合，将不会迭代之后添加的项
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>filename</span> <span class=n>in</span> <span class=n>input</span><span class=p>.</span><span class=nf>GetConsumingEnumerable</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>using</span> <span class=p>(</span><span class=n>FileStream</span> <span class=n>stream</span> <span class=o>=</span> <span class=n>File</span><span class=p>.</span><span class=nf>OpenRead</span><span class=p>(</span><span class=n>filename</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>var</span> <span class=n>reader</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>StreamReader</span><span class=p>(</span><span class=n>stream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>string</span> <span class=n>line</span> <span class=o>=</span> <span class=n>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>while</span> <span class=p>((</span><span class=n>line</span> <span class=o>=</span> <span class=n>await</span> <span class=n>reader</span><span class=p>.</span><span class=nf>ReadLineAsync</span><span class=p>())</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>output</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=n>line</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;stage 2: added &#34;</span> <span class=o>+</span> <span class=n>line</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span><span class=p>.</span><span class=nf>CompleteAdding</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>Task</span> <span class=nf>ProcessContentAsync</span><span class=p>(</span><span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>ConcurrentDictionary</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=nf>StartNew</span><span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//第三个阶段：读取第二个阶段中写入内容的队列，并将结果写入到一个字典中
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>line</span> <span class=n>in</span> <span class=n>input</span><span class=p>.</span><span class=nf>GetConsumingEnumerable</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>string</span><span class=p>[]</span> <span class=n>words</span> <span class=o>=</span> <span class=n>line</span><span class=o>?</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=sc>&#39; &#39;</span><span class=p>,</span> <span class=sc>&#39;;&#39;</span><span class=p>,</span> <span class=sc>&#39;\t&#39;</span><span class=p>,</span> <span class=sc>&#39;{&#39;</span><span class=p>,</span> <span class=sc>&#39;}&#39;</span><span class=p>,</span> <span class=sc>&#39;(&#39;</span><span class=p>,</span> <span class=sc>&#39;)&#39;</span><span class=p>,</span> <span class=sc>&#39;:&#39;</span><span class=p>,</span> <span class=sc>&#39;,&#39;</span><span class=p>,</span> <span class=sc>&#39;&#34;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>words</span> <span class=o>==</span> <span class=n>null</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>word</span> <span class=n>in</span> <span class=n>words</span><span class=o>?</span><span class=p>.</span><span class=nf>Where</span><span class=p>(</span><span class=n>w</span> <span class=o>=&gt;</span> <span class=o>!</span><span class=n>string</span><span class=p>.</span><span class=nf>IsNullOrEmpty</span><span class=p>(</span><span class=n>w</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//如果键没有添加到字典中，第二个参数就定义应该设置的值
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=c1>//如果 键已经存在于字典中，updateValueFactory就定义值的改变方式，++i
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=n>output</span><span class=p>.</span><span class=nf>AddOrUpdate</span><span class=p>(</span><span class=nl>key</span><span class=p>:</span> <span class=n>word</span><span class=p>,</span> <span class=nl>addValue</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                       <span class=nl>updateValueFactory</span><span class=p>:</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=o>++</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;stage 3: added &#34;</span> <span class=o>+</span> <span class=n>word</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>TaskCreationOptions</span><span class=p>.</span><span class=n>LongRunning</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>Task</span> <span class=nf>transFerContentAsync</span><span class=p>(</span><span class=n>ConcurrentDictionary</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//第四个阶段：从字典中读取内容，转换数据，将其写入队列中
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=nf>StartNew</span><span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>word</span> <span class=n>in</span> <span class=n>input</span><span class=p>.</span><span class=n>Keys</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>input</span><span class=p>.</span><span class=nf>TryGetValue</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>out</span> <span class=n>value</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>var</span> <span class=n>info</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Info</span> <span class=p>{</span> <span class=n>Word</span> <span class=o>=</span> <span class=n>word</span><span class=p>,</span> <span class=n>Count</span> <span class=o>=</span> <span class=n>value</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>                    <span class=n>output</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=n>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;stage 4: added &#34;</span> <span class=o>+</span> <span class=n>info</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>output</span><span class=p>.</span><span class=nf>CompleteAdding</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>TaskCreationOptions</span><span class=p>.</span><span class=n>LongRunning</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>Task</span> <span class=nf>AddColorAsync</span><span class=p>(</span><span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//第五个阶段：读取队列信息，并添加颜色信息，同时写入另一个队列
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=nf>StartNew</span><span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>item</span> <span class=n>in</span> <span class=n>input</span><span class=p>.</span><span class=nf>GetConsumingEnumerable</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>item</span><span class=p>.</span><span class=n>Count</span> <span class=o>&gt;</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>item</span><span class=p>.</span><span class=n>Color</span> <span class=o>=</span> <span class=s>&#34;Red&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>item</span><span class=p>.</span><span class=n>Count</span> <span class=o>&gt;</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>item</span><span class=p>.</span><span class=n>Color</span> <span class=o>=</span> <span class=s>&#34;Yellow&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>item</span><span class=p>.</span><span class=n>Color</span> <span class=o>=</span> <span class=s>&#34;Green&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>output</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Stage 5: added color &#34;</span> <span class=o>+</span> <span class=n>item</span><span class=p>.</span><span class=n>Color</span> <span class=o>+</span> <span class=s>&#34; to &#34;</span> <span class=o>+</span> <span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>output</span><span class=p>.</span><span class=nf>CompleteAdding</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>TaskCreationOptions</span><span class=p>.</span><span class=n>LongRunning</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>Task</span> <span class=nf>ShowContentAsync</span><span class=p>(</span><span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//第六个阶段：显示最终的队列信息
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=nf>StartNew</span><span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>item</span> <span class=n>in</span> <span class=n>input</span><span class=p>.</span><span class=nf>GetConsumingEnumerable</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Stage 6:&#34;</span> <span class=o>+</span> <span class=n>item</span><span class=p>,</span> <span class=n>item</span><span class=p>.</span><span class=n>Color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>TaskCreationOptions</span><span class=p>.</span><span class=n>LongRunning</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最终的调用代码为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>async</span> <span class=n>Task</span> <span class=nf>StartPipelineAsync</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>fileNames</span> <span class=o>=</span> <span class=n>new</span> <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第一个阶段任务，读取文件名，并写入到队列fileNames中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t1</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>ReadFilenamesAsync</span><span class=p>(</span><span class=err>@</span><span class=s>&#34;../../&#34;</span><span class=p>,</span> <span class=n>fileNames</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;started stage 1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>lines</span> <span class=o>=</span> <span class=n>new</span> <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第二个阶段任务，将队列中的文件名进行读取，获取该文件的内容并写入到lines队列中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t2</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>LoadContentAsync</span><span class=p>(</span><span class=n>fileNames</span><span class=p>,</span> <span class=n>lines</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;started stage 2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>words</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ConcurrentDictionary</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第三个阶段任务，读取lines队列中内容并写入到words中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t3</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>ProcessContentAsync</span><span class=p>(</span><span class=n>lines</span><span class=p>,</span> <span class=n>words</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//同时启动1、2、3三个阶段的任务，并发执行
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>await</span> <span class=n>Task</span><span class=p>.</span><span class=nf>WhenAll</span><span class=p>(</span><span class=n>t1</span><span class=p>,</span> <span class=n>t2</span><span class=p>,</span> <span class=n>t3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;stages 1,2,3 completed&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>items</span> <span class=o>=</span> <span class=n>new</span> <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第四个阶段任务，将words字典中的数据进行读取，写入到items中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t4</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>transFerContentAsync</span><span class=p>(</span><span class=n>words</span><span class=p>,</span> <span class=n>items</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>coloredItems</span> <span class=o>=</span> <span class=n>new</span> <span class=n>BlockingCollection</span><span class=o>&lt;</span><span class=n>Info</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第五个阶段任务，将items的数据进行读取和修改，将结果写入到coloredItems中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t5</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>AddColorAsync</span><span class=p>(</span><span class=n>items</span><span class=p>,</span> <span class=n>coloredItems</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//启动第六个阶段任务，将最终的结果显示出来
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Task</span> <span class=n>t6</span> <span class=o>=</span> <span class=n>PipeLineStages</span><span class=p>.</span><span class=nf>ShowContentAsync</span><span class=p>(</span><span class=n>coloredItems</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;stages 4,5,6 started&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//同时启动4、5、6三个阶段的任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>await</span> <span class=n>Task</span><span class=p>.</span><span class=nf>WhenAll</span><span class=p>(</span><span class=n>t4</span><span class=p>,</span> <span class=n>t5</span><span class=p>,</span> <span class=n>t6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ColoredConsole</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;all sages finished&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=处理位的集合>处理位的集合</h3><p>如果需要处理的数字有许多位，可以使用 <code>BitArray</code>类和<code>BitVector32</code>结构。这两种类型最重要的区别是：<code>BitArray</code>类可以重新设置大小，如果事先不知道需要的位数，可以使用<code>BitArray</code>类，它可以包含非常多的位。<code>BitVector32</code>结构是基于栈的，因此比较快。<code>BitVector32</code>结构仅包含32位，它们存储在一个整数中。</p><h4 id=bitarray类><code>BitArray</code>类</h4><p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.bitarray?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>BitArray</code></a> 类是一个引用类型，当它的构造函数传入的是int[]时，每一个int类型的整数都将使用32个连续位进行表示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//创建一个包含8位的数组，其索引是0~7
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>var</span> <span class=n>bits1</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>BitArray</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//把8位都设置为true
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>.</span><span class=nf>SetAll</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//把对应于1的位设置为false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=mi>7</span><span class=p>]</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//Not()方法对所有的位取反
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>.</span><span class=nf>Not</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>bits2</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>BitArray</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bits2</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits2</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span> <span class=p>(</span><span class=s>&#34; Or &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span> <span class=p>(</span><span class=s>&#34; = &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//比较两个数组上的同一个位置上的位，如果有一个为true，结果就为true
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>.</span><span class=nf>Or</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=s>&#34; and &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span> <span class=p>(</span><span class=s>&#34; = &#34;</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//如果两个数组上的同一个位置的位都为true，结果才为true
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits2</span><span class=p>.</span><span class=nf>And</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span> <span class=p>(</span><span class=s>&#34; xor &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//比较两个数组上的同一个位置上的位，只有一个（不能是二个）设置为1，结果才是1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>.</span><span class=nf>Xor</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=s>&#34; = &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>DisplayBits</span><span class=p>(</span><span class=n>BitArray</span> <span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>foreach</span> <span class=p>(</span><span class=kt>bool</span> <span class=n>bit</span> <span class=n>in</span> <span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=n>bit</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=bitvector32结构><code>BitVector32</code>结构</h4><p>如果事先知道需要的位数，留可以使用<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.specialized.bitvector32?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>BitVector32</code></a> 结构代替<code>BitArray</code>类。<code>BitVector32</code>结构效率较高，因为它是一个值类型，在整数栈上存储位。一个整数可以存储32位，如果需要更多的位，就可以使用多个<code>BitVector32</code>值或<code>BitArray</code>类。<code>BitArray</code>类可以根据需要增大，但<code>BitVector32</code>结构不能。</p><p><code>BitVector32</code>结构中常用成员：</p><ul><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.specialized.bitvector32.data?view=netframework-4.7.2#System_Collections_Specialized_BitVector32_Data" target=_blank rel="external nofollow noopener noreferrer"><code>Data</code></a> ：以整数形式获取<code>BitVector32</code>的值。<code>Data</code>属性把<code>BitVector32</code>结构中的数据返回为整数。</li><li><code>Item[]</code>：<code>BitVector32</code>的值可以使用索引器设置，索引器是重载的——可以使用掩码或<code>BitVector32.Section</code>类型的片段来获取和设置值。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.specialized.bitvector32.createmask?view=netframework-4.7.2#System_Collections_Specialized_BitVector32_CreateMask" target=_blank rel="external nofollow noopener noreferrer"><code>CreateMask()</code></a> ：该方法有多个重载版本，它是以静态方法，用于为访问<code>BitVector32</code>结构中的特定位创建掩码。</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.specialized.bitvector32.createsection?view=netframework-4.7.2#System_Collections_Specialized_BitVector32_CreateSection_System_Int16_System_Collections_Specialized_BitVector32_Section_" target=_blank rel="external nofollow noopener noreferrer"><code>CreateSection(Int16, BitVector32+Section)</code></a> ：该方法有多个重载版本，也是一个静态方法，用于创建32位中的几个片段。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//使用默认构造函数创建一个BitVactor32结构，默认每一位都是false。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>var</span> <span class=n>bits1</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>BitVector32</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//调用CreateMask()方法创建用来访问第一位的一个掩码，bit1被设置为1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>bit1</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateMask</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//再次调用CreateMask()方法，并将一个掩码作为参数进行传递，返回第二位掩码 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>bit2</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateMask</span><span class=p>(</span><span class=n>bit1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bit3</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateMask</span><span class=p>(</span><span class=n>bit2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bit4</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateMask</span><span class=p>(</span><span class=n>bit3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>bit5</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateMask</span><span class=p>(</span><span class=n>bit4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//使用掩码和索引器访问位矢量中的位，并设置值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>bits1</span><span class=p>[</span><span class=n>bit1</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=n>bit2</span><span class=p>]</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=n>bit3</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=n>bit4</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=n>bit5</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>bits1</span><span class=p>[</span><span class=mh>0xabcdef</span><span class=p>]</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>bits1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>received</span> <span class=o>=</span> <span class=mh>0x79abcdef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//直接传入十六进制数来创建掩码
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>BitVector32</span> <span class=n>bits2</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>BitVector32</span><span class=p>(</span><span class=n>received</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>bits2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//分割片段
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionA</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0xfff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionB</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0xff</span><span class=p>,</span> <span class=n>sectionA</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionC</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0xf</span><span class=p>,</span> <span class=n>sectionB</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionD</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0x7</span><span class=p>,</span> <span class=n>sectionC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionE</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0x7</span><span class=p>,</span> <span class=n>sectionD</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BitVector32</span><span class=p>.</span><span class=n>Section</span> <span class=n>sectionF</span> <span class=o>=</span> <span class=n>BitVector32</span><span class=p>.</span><span class=nf>CreateSection</span><span class=p>(</span><span class=mh>0x3</span><span class=p>,</span> <span class=n>sectionE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section A:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionA</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section B:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionB</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section C:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionC</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section D:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionD</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section E:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionE</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;Section F:&#34;</span> <span class=o>+</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=n>bits2</span><span class=p>[</span><span class=n>sectionF</span><span class=p>],</span> <span class=nb>true</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>string</span> <span class=nf>IntToBinaryString</span><span class=p>(</span><span class=kt>int</span> <span class=n>bits</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>removeTrailingZero</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>sb</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>StringBuilder</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>((</span><span class=n>bits</span> <span class=o>&amp;</span> <span class=mh>0x80000000</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sb</span><span class=p>.</span><span class=nf>Append</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sb</span><span class=p>.</span><span class=nf>Append</span><span class=p>(</span><span class=s>&#34;0&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>bits</span> <span class=o>=</span> <span class=n>bits</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>s</span> <span class=o>=</span> <span class=n>sb</span><span class=p>.</span><span class=nf>ToString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>removeTrailingZero</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span><span class=p>.</span><span class=nf>TrimStart</span><span class=p>(</span><span class=sc>&#39;0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=可观察的集合>可观察的集合</h3><p>使用<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.objectmodel.observablecollection-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>ObservableCollection</code></a> 集合类，可以在集合元素进行添加、删除、移动、修改等操作时，提供通知信息。它可以触发<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.objectmodel.observablecollection-1.collectionchanged?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer"><code>CollectionChanged</code></a> 事件，可以在该事件中，进行相关的操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=n>data</span> <span class=o>=</span> <span class=n>new</span> <span class=n>ObservableCollection</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>.</span><span class=n>CollectionChanged</span> <span class=o>+=</span> <span class=n>Data_CollectionChanged</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;one&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=s>&#34;tow&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>.</span><span class=nf>Insert</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;Three&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>.</span><span class=nf>Remove</span><span class=p>(</span><span class=s>&#34;one&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>private</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Data_CollectionChanged</span><span class=p>(</span><span class=n>object</span> <span class=n>sender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=p>.</span><span class=n>Collections</span><span class=p>.</span><span class=n>Specialized</span><span class=p>.</span><span class=n>NotifyCollectionChangedEventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;action&#34;</span> <span class=o>+</span> <span class=n>e</span><span class=p>.</span><span class=n>Action</span><span class=p>.</span><span class=nf>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>OldItems</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;OldStartingIndex:&#34;</span> <span class=o>+</span> <span class=n>e</span><span class=p>.</span><span class=n>OldStartingIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;old item(s):&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>item</span> <span class=n>in</span> <span class=n>e</span><span class=p>.</span><span class=n>OldItems</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>NewItems</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;NewStartingIndex:&#34;</span> <span class=o>+</span> <span class=n>e</span><span class=p>.</span><span class=n>NewStartingIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;new items:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>item</span> <span class=n>in</span> <span class=n>e</span><span class=p>.</span><span class=n>NewItems</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h4 id=参考资源>参考资源</h4><ul><li>《C#高级编程（第10版）》</li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.immutable?view=netcore-2.1" target=_blank rel="external nofollow noopener noreferrer">C#不变集合</a></li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer">C#并发集合</a></li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.objectmodel.observablecollection-1?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer">C#可观察集合</a></li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.bitarray?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer">C#位数组</a></li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.specialized.bitvector32?view=netframework-4.7.2" target=_blank rel="external nofollow noopener noreferrer">C# BitVector32结构</a></li></ul><hr><p>作者：OctOcean
链接：https://www.jianshu.com/p/abbeb5d06a2c
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-01-29 01:20:50">更新于 2023-01-29&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ data-title=C#基础提升系列——C#特殊集合 data-via=borna_coric data-hashtags=C#,特殊集合><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ data-hashtag=C#><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ data-title=C#基础提升系列——C#特殊集合><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ data-title=C#基础提升系列——C#特殊集合><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://canw0916.github.io/posts/2023/01/csharp%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ data-title=C#基础提升系列——C#特殊集合><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/c%23/ class=post-tag>C#</a><a href=/tags/%E7%89%B9%E6%AE%8A%E9%9B%86%E5%90%88/ class=post-tag>特殊集合</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2023/01/csharp%E9%9B%86%E5%90%88/ class=post-nav-item rel=prev title=C#基础提升系列——C#集合><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>C#基础提升系列——C#集合</a>
<a href=/posts/2023/01/%E5%BE%B7%E8%AF%AD%E5%B9%B2%E8%B4%A7-%E5%BE%B7%E8%AF%AD%E7%AC%AC%E4%B8%80%E6%A0%BC%E6%80%BB%E7%BB%93/ class=post-nav-item rel=next title="德语干货 | 德语第一格总结">德语干货 | 德语第一格总结<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=canw0916/BlogGiscus data-repo-id=R_kgDOI27Tcw data-category=Announcements data-category-id=DIC_kwDOI27Tc84CT208 data-mapping=og:title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.110.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.17-RC"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=https://canw0916.github.io/ target=_blank rel="external nofollow noopener noreferrer">火山</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中 ...</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/canw0916 title="Visit My Github Repository" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/lazysizes/lazysizes.min.js async defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:30},comment:{enable:!0,expired:!1,giscus:{darkTheme:"transparent_dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2023-01-25T00:00:00+08:00"}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7ENSZ7BS0C",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-7ENSZ7BS0C" async></script></body></html>