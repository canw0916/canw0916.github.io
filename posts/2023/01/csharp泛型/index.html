<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>C#基础提升系列——C#泛型 - 火山不火</title><meta name=author content="火山"><meta name=author-link content="https://canw0916.github.io/"><meta name=description content="C# 泛型(Generics) 泛型概述 泛型是C#编程语言的一部分，它与程序集中的IL(Intermediate Language，中间语言)代码紧密的集成。通过泛型，我们不必给不同的类型编写功能相同的许多方"><meta name=keywords content="C#,泛型"><meta itemprop=name content="C#基础提升系列——C#泛型"><meta itemprop=description content="C# 泛型(Generics) 泛型概述 泛型是C#编程语言的一部分，它与程序集中的IL(Intermediate Language，中间语言)代码紧密的集成。通过泛型，我们不必给不同的类型编写功能相同的许多方"><meta itemprop=datePublished content="2023-01-29T01:20:40+08:00"><meta itemprop=dateModified content="2023-01-29T01:20:40+08:00"><meta itemprop=wordCount content="7187"><meta itemprop=keywords content="C#,泛型,"><meta property="og:title" content="C#基础提升系列——C#泛型"><meta property="og:description" content="C# 泛型(Generics) 泛型概述 泛型是C#编程语言的一部分，它与程序集中的IL(Intermediate Language，中间语言)代码紧密的集成。通过泛型，我们不必给不同的类型编写功能相同的许多方"><meta property="og:type" content="article"><meta property="og:url" content="https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-29T01:20:40+08:00"><meta property="article:modified_time" content="2023-01-29T01:20:40+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="C#基础提升系列——C#泛型"><meta name=twitter:description content="C# 泛型(Generics) 泛型概述 泛型是C#编程语言的一部分，它与程序集中的IL(Intermediate Language，中间语言)代码紧密的集成。通过泛型，我们不必给不同的类型编写功能相同的许多方"><meta name=application-name content="火山不火"><meta name=apple-mobile-web-app-title content="火山不火"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/><link rel=prev href=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/><link rel=next href=https://canw0916.github.io/posts/2023/01/csharp%E9%9B%86%E5%90%88/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"C#基础提升系列——C#泛型","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E6%B3%9B%E5%9E%8B\/"},"genre":"posts","keywords":"C#, 泛型","wordcount":7187,"url":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E6%B3%9B%E5%9E%8B\/","datePublished":"2023-01-29T01:20:40+08:00","dateModified":"2023-01-29T01:20:40+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"火山"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=火山不火 title=火山不火><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 目录</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=/fixit.min.svg title=/fixit.min.svg><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 目录</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span title=转载 class=icon-repost><i class="fa-solid fa-share fa-fw" aria-hidden=true></i></span><span>C#基础提升系列——C#泛型</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://canw0916.github.io/ title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src=/images/avatar.jpg data-srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" data-sizes=auto alt=火山 title=火山>&nbsp;火山</a></span>
<span class=post-category>收录于 <a href=/categories/%E7%BC%96%E7%A8%8B/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 编程</a></span></div><div class=post-meta-line><span title="2023-01-29 01:20:40"><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-01-29>2023-01-29</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i> 约 7187 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden=true></i> 预计阅读 15 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=C#基础提升系列——C#泛型>
<i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#泛型概述>泛型概述</a><ul><li><ul><li><a href=#泛型性能>泛型性能</a></li><li><a href=#泛型类型安全>泛型类型安全</a></li><li><a href=#泛型允许二进制代码重用>泛型允许二进制代码重用</a></li><li><a href=#泛型实例化时代码生成>泛型实例化时代码生成</a></li><li><a href=#泛型类型命名约定>泛型类型命名约定</a></li></ul></li></ul></li><li><a href=#泛型类>泛型类</a><ul><li><ul><li><a href=#创建泛型类>创建泛型类</a></li><li><a href=#泛型类功能>泛型类功能</a></li></ul></li></ul></li><li><a href=#泛型接口>泛型接口</a><ul><li><ul><li><a href=#泛型接口中的协变和逆变>泛型接口中的协变和逆变</a></li></ul></li></ul></li><li><a href=#泛型方法>泛型方法</a><ul><li><ul><li><a href=#带约束的泛型方法>带约束的泛型方法</a></li><li><a href=#泛型委托>泛型委托</a></li><li><a href=#参考资源>参考资源：</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=c-泛型generics>C# 泛型(Generics)</h1><h2 id=泛型概述>泛型概述</h2><p>泛型是C#编程语言的一部分，它与程序集中的<code>IL</code>(<code>Intermediate Language</code>，中间语言)代码紧密的集成。通过泛型，我们不必给不同的类型编写功能相同的许多方法和类，而是可以创建独立于被包含类型的一个类或方法。 例如，通过使用泛型类型参数 T，可以编写其他客户端代码能够使用的单个类，而不会产生运行时转换或装箱操作的成本或风险。使用泛型类型可以最大限度地重用代码、保护类型安全性以及提高性能。</p><h4 id=泛型性能>泛型性能</h4><p>泛型的一个主要优点是性能。值类型存储在栈上，引用类型存储在堆上。从值类型转换为引用类型称为装箱；从引用类型转换为值类型称为拆箱。对值类型使用非泛型集合类，常常需要将值类型和引用类型互相转换，进行装箱和拆箱操作，性能损失比较大。而使用了泛型，可以很好的解决这一问题，泛型可以不再进行装箱和拆箱操作。</p><h4 id=泛型类型安全>泛型类型安全</h4><p>泛型的另一个特性是类型安全。例如，在泛型类<code>List&lt;T></code>中，泛型类型<code>T</code>定义了允许使用的类型。假设有一个泛型实例为<code>List&lt;int></code>，它在添加元素时，就只会添加类型为<code>int</code>的数值到集合中。</p><h4 id=泛型允许二进制代码重用>泛型允许二进制代码重用</h4><p>泛型允许更好的重用二进制代码，泛型类可以定义一次，使用许多不同的类型实例化。例如，泛型类<code>List&lt;T></code>可以实例化为<code>List&lt;int></code>、<code>List&lt;string></code>、<code>List&lt;MyClass></code>等。</p><h4 id=泛型实例化时代码生成>泛型实例化时代码生成</h4><blockquote><p>泛型类的定义会放在程序集 中，所以用特定类型实例化泛型类不会在中间语言（IL）代码中复制这些类。但是，在JIT编译器把泛型类编译为本地代码时，会给每个值类型创建一个新类。而引用类型共享同一个本地类的所有相同的实现代码。这是因为引用类型在实例化泛型类中只需要4个字节的内存地址（32位系统），就可以引用一个引用类型。值类型包含在实例化的泛型类的内存中，同时因为每个值类型对内存的要求都不同，所以要为每个值类型实例化一个新类。</p><p>注：【本段文字来自于《C#高级编程（第10版）》中的”不同的特定类型实例化泛型时创建了多少代码“相关描述】</p></blockquote><h4 id=泛型类型命名约定>泛型类型命名约定</h4><ul><li>泛型类型的名称用字母<code>T</code>作为前缀。</li><li>如果没有特殊的要求，泛型类型允许用任意类替代，且只使用了一个泛型类型，就可以用字符T作为泛型类型的名称。例如：<code>public class List&lt;T>{}</code></li><li>如果泛型类型有特定的要求（例如，它必须实现一个接口或派生自基类），或者使用了两个或多个泛型类型，就应给泛型类型使用描述性的 名称。例如：<code>public class SortedList&lt;Tkey,TValue>{}</code></li></ul><h2 id=泛型类>泛型类</h2><p>泛型类型：也被称为泛型类型参数，它是在实例化泛型类的一个变量时，泛型声明中指定的特定类型的占位符，即泛型类中指定的T。</p><p>泛型类：定义泛型类型的类，例如<code>List&lt;T></code>，它无法按原样使用，因为它不是真正的类型；它更像是类型的蓝图。 若要使用 <code>List&lt;T></code>，客户端代码必须通过指定尖括号内的类型参数来声明并实例化构造类型。</p><h4 id=创建泛型类>创建泛型类</h4><p>通常，创建泛型类是从现有具体类开始，然后每次逐个将类型更改为类型参数，直到泛化和可用性达到最佳平衡。 在创建泛型类之前，先建立一个简单的普通类，然后再把这个类转化为泛型类。</p><p>定义一个一般的、非泛型的简化链表类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>LinkedListNode</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>object</span> <span class=n>Value</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>LinkedListNode</span><span class=p>(</span><span class=n>object</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Value</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span> <span class=n>Prev</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>internal</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span> <span class=n>Next</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>internal</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>LinkedList</span> <span class=p>:</span> <span class=n>IEnumerable</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span> <span class=n>First</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span> <span class=n>Last</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//在链表尾部添加一个新元素
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=n>LinkedListNode</span> <span class=nf>AddLast</span><span class=p>(</span><span class=n>object</span> <span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>var</span> <span class=n>newNode</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>LinkedListNode</span><span class=p>(</span><span class=n>node</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>First</span> <span class=o>==</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>First</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span> <span class=o>=</span> <span class=n>First</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>LinkedListNode</span> <span class=n>previous</span> <span class=o>=</span> <span class=n>Last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span><span class=p>.</span><span class=n>Next</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span><span class=p>.</span><span class=n>Prev</span> <span class=o>=</span> <span class=n>previous</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//实现GetEnumerator()方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=n>IEnumerator</span> <span class=nf>GetEnumerator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LinkedListNode</span> <span class=n>current</span> <span class=o>=</span> <span class=n>First</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>current</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//使用yield语句创建一个枚举器类型
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>yield</span> <span class=k>return</span> <span class=n>current</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>.</span><span class=n>Next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>当调用上述<code>LinkedList</code>类的<code>AddLast()</code>方法传入任意类型的值时，会进行一系列的装箱和拆箱的操作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>list1</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>LinkedList</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>list1</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>list1</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>list1</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=s>&#34;4&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>foreach</span> <span class=p>(</span><span class=n>var</span> <span class=n>i</span> <span class=n>in</span> <span class=n>list1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用泛型定义上述类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>LinkedListNode</span><span class=p>(</span><span class=n>T</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Value</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Next</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>internal</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Prev</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>internal</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>T</span> <span class=n>Value</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>First</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Last</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>AddLast</span><span class=p>(</span><span class=n>T</span> <span class=n>node</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>var</span> <span class=n>newNode</span> <span class=o>=</span> <span class=n>new</span> <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>node</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>First</span> <span class=o>==</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>First</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span> <span class=o>=</span> <span class=n>First</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>previous</span> <span class=o>=</span> <span class=n>Last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span><span class=p>.</span><span class=n>Next</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span> <span class=o>=</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Last</span><span class=p>.</span><span class=n>Prev</span> <span class=o>=</span> <span class=n>previous</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>newNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>IEnumerator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>GetEnumerator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LinkedListNode</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>current</span> <span class=o>=</span> <span class=n>First</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>current</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>yield</span> <span class=k>return</span> <span class=n>current</span><span class=p>.</span><span class=n>Value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>current</span> <span class=o>=</span> <span class=n>current</span><span class=p>.</span><span class=n>Next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>IEnumerator</span> <span class=n>IEnumerable</span><span class=p>.</span><span class=nf>GetEnumerator</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=nf>GetEnumerator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>泛型类的定义与一般类类似，只是要使用泛型类型声明。声明后的泛型类型可以在类中用作方法或字段成员的参数类型。</p><p>调用上述中声明的方法用例如下，此时添加元素和遍历元素时都不用频繁的装箱和拆箱：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>list2</span> <span class=o>=</span> <span class=n>new</span> <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>list2</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=s>&#34;java&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>list2</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=s>&#34;c#&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>list2</span><span class=p>.</span><span class=nf>AddLast</span><span class=p>(</span><span class=s>&#34;python&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>foreach</span> <span class=p>(</span><span class=n>string</span> <span class=n>i</span> <span class=n>in</span> <span class=n>list2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=泛型类功能>泛型类功能</h4><p>在创建泛型类时，可以为泛型类型指定默认值、约束、继承和静态成员等。</p><p>创建如下一个简单泛型类 ，用于从队列中读写文档。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>DocumentManager</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>readonly</span> <span class=n>Queue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>documentQueue</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Queue</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>bool</span> <span class=n>IsDocumentAvailable</span> <span class=o>=&gt;</span> <span class=n>documentQueue</span><span class=p>.</span><span class=n>Count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>void</span> <span class=nf>AddDocument</span><span class=p>(</span><span class=n>T</span> <span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>lock</span> <span class=p>(</span><span class=n>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>documentQueue</span><span class=p>.</span><span class=nf>Enqueue</span><span class=p>(</span><span class=n>doc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//定义一个简单的接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=n>interface</span> <span class=n>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>Title</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>Content</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//实现该接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=n>class</span> <span class=nl>Document</span> <span class=p>:</span> <span class=n>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>Document</span><span class=p>(</span><span class=n>string</span> <span class=n>title</span><span class=p>,</span> <span class=n>string</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Title</span> <span class=o>=</span> <span class=n>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Content</span> <span class=o>=</span> <span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Content</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Title</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>泛型类型默认值</strong></p><p>在上述类<code>DocumentManager&lt;T></code>中添加如下方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>T</span> <span class=nf>GetDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//default将泛型类型的值初始化为null或者0，取决于泛型类型是引用类型还是值类型。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>T</span> <span class=n>doc</span> <span class=o>=</span> <span class=k>default</span><span class=p>(</span><span class=n>T</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>lock</span> <span class=p>(</span><span class=n>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>doc</span> <span class=o>=</span> <span class=n>documentQueue</span><span class=p>.</span><span class=nf>Dequeue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>doc</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>该方法直接返回类型<code>T</code>的值，由于不能把<code>null</code>赋予泛型类型，原因是泛型类型可以实例化为值类型，而<code>null</code>只能用于引用类型，因此为了解决这个问题，使用了<code>default</code>关键字来代替<code>T doc=null;</code> 通过<code>default</code>关键字，可以自动的将<code>null</code>赋予引用类型，将<code>0</code>赋予值类型，而不用管<code>T</code>具体是哪种类型。</p><p><strong>泛型类型约束</strong></p><p>如果泛型类（定义泛型类型的类，如<code>DocumentManager</code>）需要调用泛型类型（T）中的方法，就必须添加约束。</p><p>例如，在泛型类<code>DocumentManager&lt;T></code>中添加<code>DisplayAllDocuments()</code>方法用于显示泛型类型T对应的Title值，需要强制进行类型转换，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=kt>void</span> <span class=nf>DisplayAllDocuments</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>foreach</span> <span class=p>(</span><span class=n>T</span> <span class=n>doc</span> <span class=n>in</span> <span class=n>documentQueue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(((</span><span class=n>IDocument</span><span class=p>)</span><span class=n>doc</span><span class=p>).</span><span class=n>Title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>一旦类型<code>T</code>没有实现<code>IDocument</code>接口，上述类型转换就会存在错误，此时最好的做法就是为泛型类添加一个约束：<code>T</code>必须实现<code>IDocument</code>接口。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>DocumentManager</span><span class=o>&lt;</span><span class=n>TDocument</span><span class=o>&gt;</span> <span class=n>where</span> <span class=nl>TDocument</span> <span class=p>:</span> <span class=n>IDocument</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>readonly</span> <span class=n>Queue</span><span class=o>&lt;</span><span class=n>TDocument</span><span class=o>&gt;</span> <span class=n>documentQueue</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Queue</span><span class=o>&lt;</span><span class=n>TDocument</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>bool</span> <span class=n>IsDocumentAvailable</span> <span class=o>=&gt;</span> <span class=n>documentQueue</span><span class=p>.</span><span class=n>Count</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>void</span> <span class=nf>AddDocument</span><span class=p>(</span><span class=n>TDocument</span> <span class=n>doc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>lock</span> <span class=p>(</span><span class=n>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>documentQueue</span><span class=p>.</span><span class=nf>Enqueue</span><span class=p>(</span><span class=n>doc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>TDocument</span> <span class=nf>GetDocument</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//default将泛型类型的值初始化为null或者0，取决于泛型类型是引用类型还是值类型。
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>TDocument</span> <span class=n>doc</span> <span class=o>=</span> <span class=k>default</span><span class=p>(</span><span class=n>TDocument</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>lock</span> <span class=p>(</span><span class=n>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>doc</span> <span class=o>=</span> <span class=n>documentQueue</span><span class=p>.</span><span class=nf>Dequeue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>doc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>void</span> <span class=nf>DisplayAllDocuments</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>foreach</span> <span class=p>(</span><span class=n>TDocument</span> <span class=n>doc</span> <span class=n>in</span> <span class=n>documentQueue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=n>Title</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注意：给泛型类型 添加约束时，最好包含泛型参数名称的一些信息，此示例使用<code>TDocument</code>来代替<code>T</code>。调用上述代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>dm</span> <span class=o>=</span> <span class=n>new</span> <span class=n>DocumentManager</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>dm</span><span class=p>.</span><span class=nf>AddDocument</span><span class=p>(</span><span class=n>new</span> <span class=nf>Document</span><span class=p>(</span><span class=s>&#34;title A&#34;</span><span class=p>,</span> <span class=s>&#34;sample A&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>dm</span><span class=p>.</span><span class=nf>AddDocument</span><span class=p>(</span><span class=n>new</span> <span class=nf>Document</span><span class=p>(</span><span class=s>&#34;title B&#34;</span><span class=p>,</span> <span class=s>&#34;sample B&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=n>dm</span><span class=p>.</span><span class=nf>DisplayAllDocuments</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>dm</span><span class=p>.</span><span class=n>IsDocumentAvailable</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Document</span> <span class=n>d</span> <span class=o>=</span> <span class=n>dm</span><span class=p>.</span><span class=nf>GetDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>d</span><span class=p>.</span><span class=n>Content</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>泛型类型支持的约束类型</p><table><thead><tr><th>约束</th><th>说明</th></tr></thead><tbody><tr><td><code>where T:struct</code></td><td>类型参数必须是值类型。 可以指定除<code>Nullable</code>以外的任何值类型。</td></tr><tr><td><code>where T : unmanaged</code></td><td><code>unmanaged</code> 约束指定类型参数必须为“非托管类型”。 “非托管类型”不是引用类型，所以该约束指定类型参数不能是引用类型，并且任何嵌套级别均不能包含任何引用类型成员。</td></tr><tr><td><code>where T:class</code></td><td>类约束指定类型<code>T</code>必须是引用类型 。此约束还应用于任何类、接口、委托或数组类型。</td></tr><tr><td><code>where T:IFoo</code></td><td>指定类型<code>T</code>必须实现接口<code>IFoo</code></td></tr><tr><td><code>where T:Foo</code></td><td>指定类型<code>T</code>必须派生自基类<code>Foo</code></td></tr><tr><td><code>where T:new()</code></td><td>这是一个构造函数约束，指定类型T必须有一个默认构造函数。当与其他约束一起使用时，<code>new()</code> 约束必须最后指定。</td></tr><tr><td><code>where T1:T2</code></td><td>这个约束也可以指定，类型<code>T1</code>派生自泛型类型<code>T2</code></td></tr></tbody></table><p>某些约束是互斥的。 所有值类型必须具有可访问的无参数构造函数。 <code>struct</code> 约束包含 <code>new()</code> 约束，且 <code>new()</code> 约束不能与 <code>struct</code> 约束结合使用。 <code>unmanaged</code> 约束包含 <code>struct</code> 约束。 <code>unmanaged</code> 约束不能与 <code>struct</code> 或 <code>new()</code> 约束结合使用。</p><p>从 C# 7.3 开始，可使用 <code>unmanaged</code> 约束来指定类型参数必须为“非托管类型”。 “非托管类型”不是引用类型，且任何嵌套级别都不包含引用类型字段。</p><p>注意：只能为默认构造函数定义构造函数约束，不能为其他构造函数定义构造函数约束。</p><p>使用泛型类型可以合并多个约束：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=n>public</span> <span class=n>class</span> <span class=n>MyClass</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>where</span> <span class=nl>T</span> <span class=p>:</span> <span class=n>IFoo</span><span class=p>,</span> <span class=nf>new</span><span class=p>(){</span>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述声明表示类型T必须实现<code>IFoo</code>接口，且必须有一个默认构造函数。</p><p>注意：在C#中，<code>where</code>子句不能定义必须由泛型类型实现的运算符。运算符不能在接口中定义。在<code>where</code>子句中，只能定义基类、接口、和默认构造函数。</p><p><strong>泛型类型继承</strong></p><p>泛型类型可以实现泛型接口，也可以派生自一个泛型基类，其要求是必须重复基类的泛型类型，或者必须指定基类的类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Derived</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Derived_2</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>Base</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>派生类（子类）可以是泛型类或非泛型类，例如，可以定义一个抽象的泛型基类，它在派生类中用一个具体的类实现：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>abstract</span> <span class=n>class</span> <span class=n>Calc</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>abstract</span> <span class=n>T</span> <span class=nf>Add</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>,</span> <span class=n>T</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>abstract</span> <span class=n>T</span> <span class=nf>Sub</span><span class=p>(</span><span class=n>T</span> <span class=n>x</span><span class=p>,</span> <span class=n>T</span> <span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>IntCalc</span> <span class=p>:</span> <span class=n>Calc</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>override</span> <span class=kt>int</span> <span class=nf>Add</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=n>y</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>override</span> <span class=kt>int</span> <span class=nf>Sub</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=n>y</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>x</span> <span class=o>-</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>还可以创建一个部分的特殊操作，如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Query</span><span class=o>&lt;</span><span class=n>TRequest</span><span class=p>,</span> <span class=n>TResult</span><span class=o>&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>StringQuery</span><span class=o>&lt;</span><span class=n>TRequest</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>Query</span><span class=o>&lt;</span><span class=n>TRequest</span><span class=p>,</span> <span class=n>string</span><span class=o>&gt;</span> <span class=p>{</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述中<code>StringQuery</code>继承自<code>Query</code>，只定义了一个泛型参数，为基类的<code>TResult</code>指定为<code>string</code>，要实例化<code>StringQuery</code>，只需要提供<code>TRequest</code>的类型。</p><p><strong>泛型静态成员</strong></p><p>应该减少泛型静态成员的使用，泛型类的静态成员只能在对应的同一个类实例中共享。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>StaticDemo</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>T</span> <span class=n>x</span><span class=p>;</span> <span class=c1>//此处变量x为T类型
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=k>static</span> <span class=kt>int</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//泛型静态成员调用
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>StaticDemo</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=s>&#34;abc&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>StaticDemo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=mi>13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>StaticDemo</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>StaticDemo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>StaticDemo</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>.</span><span class=n>x</span><span class=p>);</span> <span class=c1>//结果：abc
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>StaticDemo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>.</span><span class=n>x</span><span class=p>);</span>    <span class=c1>//结果：13
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>StaticDemo</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>.</span><span class=n>y</span><span class=p>);</span> <span class=c1>//结果：2
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>StaticDemo</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>    <span class=c1>//结果：10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=泛型接口>泛型接口</h2><p>使用泛型可以定义接口，在接口中定义的方法可以带泛型参数。.NET提供了许多泛型接口，同一个接口常常存在比较老的非泛型版本，建议在实际使用中，优先采用泛型版本去解决问题。</p><h4 id=泛型接口中的协变和逆变>泛型接口中的协变和逆变</h4><p>为了更好的解释协变和逆变的概念，我们使用<code>List</code>、<code>IList</code>、<code>IEnumerable</code>三者做一个简单的测验。首先我们定义一个<code>List&lt;string></code> 实例变量<code>listA</code>，并将<code>listA</code>的值指向<code>IList&lt;string></code>的变量<code>iListA</code>，同时分别使用<code>IEnumerable&lt;string></code>去引用这两个变量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>listA</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>IList</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>iListA</span> <span class=o>=</span> <span class=n>listA</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>iEnumerableA</span> <span class=o>=</span> <span class=n>listA</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span> <span class=n>iEnumerableB</span> <span class=o>=</span> <span class=n>iListA</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>此时代码不会产生错误，能够正常编译。因为<code>List&lt;T></code>派生自<code>IList&lt;T></code>和<code>IEnumerable&lt;T></code>，<code>IList&lt;T></code>派生自<code>IEnumerable&lt;T></code>，父类引用指向子类对象，所以代码可以通过编译。</p><p>注意：<code>IEnumerable&lt;T></code>实际上是一个变体，查看定义的源码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>interface</span> <span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>out</span> <span class=n>T</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>IEnumerable</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>IEnumerator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>GetEnumerator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>特别需要注意的是泛型类型T前面的<code>out</code>关键字，它代表的就是协变。它的作用是什么？</p><p>C#中的<code>string</code>派生自<code>Object</code>类型，假设我们也想通过<code>object</code>的集合直接去引用<code>string</code>的<code>List</code>，类似于如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>object</span><span class=o>&gt;</span> <span class=n>listB</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span> <span class=c1>//报错，不会通过编译
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>IList</span><span class=o>&lt;</span><span class=n>object</span><span class=o>&gt;</span> <span class=n>iListB</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span> <span class=c1>//报错，不会通过编译
</span></span></span></code></pre></td></tr></table></div></div><p>上述的两条语句均会编译失败，因为<code>List&lt;T></code>和<code>IList&lt;T></code>在泛型定义时均没有指定<code>out</code>关键字。而使用<code>IEnumerable&lt;T></code>可以通过编译：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>object</span><span class=o>&gt;</span> <span class=n>iEnumerableB</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>string</span><span class=o>&gt;</span><span class=p>();</span><span class=c1>//代码可以正常编译
</span></span></span></code></pre></td></tr></table></div></div><p>上述语句可以通过编译。</p><p>注意：只有引用类型才支持使用泛型接口中的变体。 值类型不支持变体。 如下语句将会编译报错：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>object</span><span class=o>&gt;</span> <span class=n>integers</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>();</span><span class=c1>//编译错误，值类型不支持变体
</span></span></span></code></pre></td></tr></table></div></div><p>下面将用具体的示例对协变和逆变做详细说明。首先定义两个简单的类，其中<code>Rectangle</code>继承自父类<code>Shape</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=n>Shape</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>double</span> <span class=n>Width</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>double</span> <span class=n>Height</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//重写Object的ToString方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=n>override</span> <span class=n>string</span> <span class=nf>ToString</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=err>$</span><span class=s>&#34;Width:{Width},Height:{Height}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//定义子类Rectangle
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=n>class</span> <span class=nl>Rectangle</span> <span class=p>:</span> <span class=n>Shape</span> <span class=p>{</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>泛型接口的协变</strong></p><p>如果泛型类型使用<code>out</code>关键字标注，该泛型接口就是协变的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>interface</span> <span class=n>IIndex</span><span class=o>&lt;</span><span class=n>out</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//定义一个索引器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>T</span> <span class=n>this</span><span class=p>[</span><span class=kt>int</span> <span class=n>index</span><span class=p>]</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>Count</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>RectangleCollection</span> <span class=p>:</span> <span class=n>IIndex</span><span class=o>&lt;</span><span class=n>Rectangle</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=n>Rectangle</span><span class=p>[]</span> <span class=n>data</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Rectangle</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=n>new</span> <span class=n>Rectangle</span><span class=p>{</span><span class=n>Height</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=n>Width</span><span class=o>=</span><span class=mi>5</span><span class=p>},</span>
</span></span><span class=line><span class=cl>         <span class=n>new</span> <span class=n>Rectangle</span><span class=p>{</span> <span class=n>Height</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>Width</span><span class=o>=</span><span class=mi>7</span><span class=p>},</span>
</span></span><span class=line><span class=cl>         <span class=n>new</span> <span class=n>Rectangle</span><span class=p>{</span> <span class=n>Height</span><span class=o>=</span><span class=mf>4.5</span><span class=p>,</span> <span class=n>Width</span><span class=o>=</span><span class=mf>2.9</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>int</span> <span class=n>Count</span> <span class=o>=&gt;</span> <span class=n>data</span><span class=p>.</span><span class=n>Length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>Rectangle</span> <span class=n>this</span><span class=p>[</span><span class=kt>int</span> <span class=n>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>get</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>index</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>index</span> <span class=o>&gt;</span> <span class=n>data</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>throw</span> <span class=n>new</span> <span class=nf>ArgumentOutOfRangeException</span><span class=p>(</span><span class=s>&#34;index&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>data</span><span class=p>[</span><span class=n>index</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述定义了一个泛型接口<code>IIndex</code>，并使用<code>out</code>标注为协变，接着定义类<code>RectangleCollection</code>实现该接口，调用上述代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>IIndex</span><span class=o>&lt;</span><span class=n>Rectangle</span><span class=o>&gt;</span> <span class=n>rectangles</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>RectangleCollection</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//由于采用了协变，此处可以直接使用父类Shape相关的引用指向子类Rectangle相关的对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>IIndex</span><span class=o>&lt;</span><span class=n>Shape</span><span class=o>&gt;</span> <span class=n>shapes</span> <span class=o>=</span> <span class=n>rectangles</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>IIndex</span><span class=o>&lt;</span><span class=n>Shape</span><span class=o>&gt;</span> <span class=n>shapes2</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>RectangleCollection</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>shapes</span><span class=p>.</span><span class=n>Count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>shapes</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>泛型接口的逆变</strong></p><p>使用in关键字标注泛型类型的接口就是逆变的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>interface</span> <span class=n>IDisplay</span><span class=o>&lt;</span><span class=n>in</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>Show</span><span class=p>(</span><span class=n>T</span> <span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>ShapeDisplay</span> <span class=p>:</span> <span class=n>IDisplay</span><span class=o>&lt;</span><span class=n>Shape</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=kt>void</span> <span class=nf>Show</span><span class=p>(</span><span class=n>Shape</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;{item.GetType().Name}  Width:{item.Width},Height:{item.Height}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述定义了一个逆变的泛型接口<code>IDisplay</code>，并使用<code>ShapeDisplay</code>实现它，注意实现时指定的类型是<code>Shape</code>，并且定义了<code>Show</code>方法，显示对应<code>Type</code>名。调用代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>IDisplay</span><span class=o>&lt;</span><span class=n>Shape</span><span class=o>&gt;</span> <span class=n>sd</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>ShapeDisplay</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//由于采用了逆变，可以使用Rectangle相关的引用指向父类Shape相关的对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>IDisplay</span><span class=o>&lt;</span><span class=n>Rectangle</span><span class=o>&gt;</span> <span class=n>rectangleDisplay</span> <span class=o>=</span> <span class=n>sd</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>rectangleDisplay</span><span class=p>.</span><span class=nf>Show</span><span class=p>(</span><span class=n>rectangles</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span> <span class=c1>//Type将会输出为Rectangle
</span></span></span></code></pre></td></tr></table></div></div><p>下面是我自己的理解做的一个总结</p><p>协变：使用<code>out</code>关键字标注，协助变换，既然是协助就说明是客观存在的，也就是顺应"父类引用指向子类对象"这一原则所做的转换，协变会保留分配兼容性。协变允许方法具有的返回类型比接口的泛型类型参数定义的返回类型的派生程度更大。 在.net中，大多数的参数类型类似于协变 ，比如定义了一个方法，参数为<code>object</code>，调用该方法时，可以为参数传入所有<code>object</code>派生出的子类对象。</p><p>逆变：逆反变换，违背”父类引用指向子类对象“这一原则所做的转换，和协变相反，类似于“子类引用父类相关的对象”。逆变允许方法具有的实参类型比接口的泛型形参定义的类型的派生程度更小。比如定义一个方法，方法的参数为<code>object</code>，返回的类型为<code>object</code>的子类，此时不能直接返回传入的参数，必须进行类型转换，而逆变可以很好的解决此类问题。</p><p>变体：如果泛型接口或委托的泛型参数被声明为协变或逆变，该泛型接口或委托则被称为“变体”。</p><h2 id=泛型方法>泛型方法</h2><p>在泛型方法中，泛型类型用方法声明来定义。泛型方法可以在非泛型类中定义。如下，定义一个简单的泛型方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=n>Swap</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ref</span> <span class=n>T</span> <span class=n>x</span><span class=p>,</span><span class=n>ref</span> <span class=n>T</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>temp</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注意定义的形式，泛型类型<code>T</code>需要在方法声明中（方法名的后面）指定。调用上述方法代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Swap</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ref</span> <span class=n>a</span><span class=p>,</span> <span class=n>ref</span> <span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//C#编译器会通过调用该方法来获取参数的类型，所以不需要把泛型类型赋予方法调用，可简化为下述语句
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>Swap</span><span class=p>(</span><span class=n>ref</span> <span class=n>a</span><span class=p>,</span> <span class=n>ref</span> <span class=n>b</span><span class=p>);</span> <span class=c1>//上述语句的简化写法
</span></span></span></code></pre></td></tr></table></div></div><p>在调用泛型方法时，C#编译器会根据传入的参数自动获取类型，因此不需要把泛型类型赋予方法调用，即<code>Swap&lt;int></code>中的<code>&lt;int></code>可以不用指定（实际编码中，可以借助VS智能编码助手进行简化，使用<code>ctrl+.</code>快捷键进行调用）</p><h4 id=带约束的泛型方法>带约束的泛型方法</h4><p>在泛型类中，泛型类型可以用where子句来限制，同样，在泛型方法，也可以使用<code>where</code>子句来限制泛型类型。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=n>interface</span> <span class=n>IAccount</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>decimal</span> <span class=n>Balance</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>Name</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=n>class</span> <span class=nl>Account</span> <span class=p>:</span> <span class=n>IAccount</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>Account</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=n>decimal</span> <span class=n>balance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Balance</span> <span class=o>=</span> <span class=n>balance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>decimal</span> <span class=n>Balance</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Name</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述定义一个简单的接口和实现的类，接着定义一个泛型方法，并且添加where子句约束，让泛型类型<code>TAccount</code>对应的传入参数必须实现接口<code>IAccount</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//静态类不能被实例化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=k>static</span> <span class=n>class</span> <span class=n>Algorithms</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=n>decimal</span> <span class=n>Accumulate</span><span class=o>&lt;</span><span class=n>TAccount</span><span class=o>&gt;</span><span class=p>(</span><span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>TAccount</span><span class=o>&gt;</span> <span class=n>source</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>where</span> <span class=nl>TAccount</span> <span class=p>:</span> <span class=n>IAccount</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>decimal</span> <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>foreach</span> <span class=p>(</span><span class=n>TAccount</span> <span class=n>a</span> <span class=n>in</span> <span class=n>source</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=o>+=</span> <span class=n>a</span><span class=p>.</span><span class=n>Balance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>调用上述方法的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>accounts</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;书籍&#34;</span><span class=p>,</span><span class=mi>234</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;文具&#34;</span><span class=p>,</span><span class=mi>56</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;手机&#34;</span><span class=p>,</span><span class=mi>2300</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>//decimal amount = Algorithms.Accumulate&lt;Account&gt;(accounts);
</span></span></span><span class=line><span class=cl><span class=c1>//编译器会从方法的参数类型中自动推断出泛型类型参数，可以简化为下述代码进行调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>decimal</span> <span class=n>amount</span> <span class=o>=</span> <span class=n>Algorithms</span><span class=p>.</span><span class=nf>Accumulate</span><span class=p>(</span><span class=n>accounts</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>注意：并不是所有的方法调用都不需要指定泛型参数类型，当编译器无法自动推断出类型时，需要显式的进行指定，比如带委托的泛型方法。</p><h4 id=泛型委托>泛型委托</h4><p>这里我们用一个简单的例子来说明一下泛型委托的调用。关于委托，后续我会单独进行总结。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>TSum</span> <span class=n>Accumulate</span><span class=o>&lt;</span><span class=n>TAccount</span><span class=p>,</span> <span class=n>TSum</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>IEnumerable</span><span class=o>&lt;</span><span class=n>TAccount</span><span class=o>&gt;</span> <span class=n>source</span><span class=p>,</span> <span class=c1>//方法第一个参数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Func</span><span class=o>&lt;</span><span class=n>TAccount</span><span class=p>,</span> <span class=n>TSum</span><span class=p>,</span> <span class=n>TSum</span><span class=o>&gt;</span> <span class=n>action</span> <span class=c1>//方法第二个参数是一个委托
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>)</span> <span class=n>where</span> <span class=nl>TAccount</span> <span class=p>:</span> <span class=n>IAccount</span> <span class=n>where</span> <span class=nl>TSum</span> <span class=p>:</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>TSum</span> <span class=n>sum</span> <span class=o>=</span> <span class=k>default</span><span class=p>(</span><span class=n>TSum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>foreach</span> <span class=p>(</span><span class=n>TAccount</span> <span class=n>item</span> <span class=n>in</span> <span class=n>source</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>=</span> <span class=nf>action</span><span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>sum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>该方法在声明时，指定了两个泛型类型<code>TSum</code>和<code>TAccount</code>，其中一个约束是值类型，一个约束是实现接口<code>IAccount</code>，传入的第一个参数是<code>IEnumerable&lt;TAccount></code>类型的，第二个参数是一个委托。在调用该方法时，编译器不能自动推断出参数类型，需要显式的指定泛型参数类型，调用该方法代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>var</span> <span class=n>accounts</span> <span class=o>=</span> <span class=n>new</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Account</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;书籍&#34;</span><span class=p>,</span><span class=mi>234</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;文具&#34;</span><span class=p>,</span><span class=mi>56</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Account</span><span class=p>(</span><span class=s>&#34;手机&#34;</span><span class=p>,</span><span class=mi>2300</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>decimal</span> <span class=n>amount</span> <span class=o>=</span> <span class=n>Algorithms</span><span class=p>.</span><span class=n>Accumulate</span><span class=o>&lt;</span><span class=n>Account</span><span class=p>,</span> <span class=n>decimal</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>     <span class=n>accounts</span><span class=p>,</span>  <span class=c1>//传入的参数1
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>sum</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>sum</span> <span class=o>+=</span> <span class=n>item</span><span class=p>.</span><span class=n>Balance</span> <span class=c1>//传入的参数2
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>本文后续会随着知识的积累不断补充和更新，内容如有错误，欢迎指正。
最后一次更新时间：2018-06-28</p><h4 id=参考资源>参考资源：</h4><ul><li>《C#高级编程（第10版）》</li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/generics/index target=_blank rel="external nofollow noopener noreferrer">C#编程指南——泛型</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/standard/generics/covariance-and-contravariance target=_blank rel="external nofollow noopener noreferrer">C#泛型中的协变和逆变</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/standard/generics/ target=_blank rel="external nofollow noopener noreferrer">.NET中的泛型</a></li></ul><hr><p>作者：OctOcean
链接：https://www.jianshu.com/p/c654991806e9
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-01-29 01:20:40">更新于 2023-01-29&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ data-title=C#基础提升系列——C#泛型 data-via=canw0916 data-hashtags=C#,泛型><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ data-hashtag=C#><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ data-title=C#基础提升系列——C#泛型><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ data-title=C#基础提升系列——C#泛型><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ data-title=C#基础提升系列——C#泛型><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/c%23/ class=post-tag>C#</a><a href=/tags/%E6%B3%9B%E5%9E%8B/ class=post-tag>泛型</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2023/01/csharp%E5%A7%94%E6%89%98/ class=post-nav-item rel=prev title=C#基础提升系列——C#委托><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>C#基础提升系列——C#委托</a>
<a href=/posts/2023/01/csharp%E9%9B%86%E5%90%88/ class=post-nav-item rel=next title=C#基础提升系列——C#集合>C#基础提升系列——C#集合<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=canw0916/BlogGiscus data-repo-id=R_kgDOI27Tcw data-category=Announcements data-category-id=DIC_kwDOI27Tc84CT208 data-mapping=og:title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.110.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.17-RC"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=https://canw0916.github.io/ target=_blank rel="external nofollow noopener noreferrer">火山</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中 ...</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/canw0916 title="Visit My Github Repository" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/lazysizes/lazysizes.min.js async defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:30},comment:{enable:!0,expired:!1,giscus:{darkTheme:"transparent_dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2023-01-25T00:00:00+08:00"}</script><script src=/js/theme.min.js defer></script></body></html>