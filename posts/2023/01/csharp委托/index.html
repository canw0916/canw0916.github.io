<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>C#基础提升系列——C#委托 - 火山不火</title><meta name=author content="火山"><meta name=author-link content="https://canw0916.github.io/"><meta name=description content="委托是类型安全的类，它定义了返回类型和参数的类型，委托类可以包含一个或多个方法的引用。可以使用lambda表达式实现参数是委托类型的方法。 委托 当需要把一个方法作为参数传递给另一个方法时，就需要使用委托"><meta name=keywords content="委托,C#"><meta itemprop=name content="C#基础提升系列——C#委托"><meta itemprop=description content="委托是类型安全的类，它定义了返回类型和参数的类型，委托类可以包含一个或多个方法的引用。可以使用lambda表达式实现参数是委托类型的方法。 委托 当需要把一个方法作为参数传递给另一个方法时，就需要使用委托"><meta itemprop=datePublished content="2023-01-29T01:20:34+08:00"><meta itemprop=dateModified content="2023-01-29T01:20:34+08:00"><meta itemprop=wordCount content="5559"><meta itemprop=keywords content="委托,C#,"><meta property="og:title" content="C#基础提升系列——C#委托"><meta property="og:description" content="委托是类型安全的类，它定义了返回类型和参数的类型，委托类可以包含一个或多个方法的引用。可以使用lambda表达式实现参数是委托类型的方法。 委托 当需要把一个方法作为参数传递给另一个方法时，就需要使用委托"><meta property="og:type" content="article"><meta property="og:url" content="https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-29T01:20:34+08:00"><meta property="article:modified_time" content="2023-01-29T01:20:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="C#基础提升系列——C#委托"><meta name=twitter:description content="委托是类型安全的类，它定义了返回类型和参数的类型，委托类可以包含一个或多个方法的引用。可以使用lambda表达式实现参数是委托类型的方法。 委托 当需要把一个方法作为参数传递给另一个方法时，就需要使用委托"><meta name=application-name content="火山不火"><meta name=apple-mobile-web-app-title content="火山不火"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/><link rel=prev href=https://canw0916.github.io/posts/2023/01/git%E5%A6%82%E4%BD%95%E8%A7%A3%E9%99%A4%E9%A1%B9%E7%9B%AE%E5%8E%9F%E6%9D%A5%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E5%85%B3%E8%81%94/><link rel=next href=https://canw0916.github.io/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"C#基础提升系列——C#委托","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E5%A7%94%E6%89%98\/"},"genre":"posts","keywords":"委托, C#","wordcount":5559,"url":"https:\/\/canw0916.github.io\/posts\/2023\/01\/csharp%E5%A7%94%E6%89%98\/","datePublished":"2023-01-29T01:20:34+08:00","dateModified":"2023-01-29T01:20:34+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"火山"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=火山不火 title=火山不火><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=火山不火><img class="lazyload logo" src=/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=/fixit.min.svg title=/fixit.min.svg><span class=header-title-text>火山不火</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span title=转载 class=icon-repost><i class="fa-solid fa-share fa-fw" aria-hidden=true></i></span><span>C#基础提升系列——C#委托</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://canw0916.github.io/ title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class="lazyload avatar" src=/svg/loading.min.svg data-src=/images/avatar.jpg data-srcset="/images/avatar.jpg, /images/avatar.jpg 1.5x, /images/avatar.jpg 2x" data-sizes=auto alt=火山 title=火山>&nbsp;火山</a></span>
<span class=post-category>收录于 <a href=/categories/%E7%BC%96%E7%A8%8B/><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 编程</a></span></div><div class=post-meta-line><span title="2023-01-29 01:20:34"><i class="fa-regular fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-01-29>2023-01-29</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw" aria-hidden=true></i> 约 5559 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw" aria-hidden=true></i> 预计阅读 12 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=C#基础提升系列——C#委托>
<i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#委托>委托</a><ul><li><ul><li><a href=#声明委托类型>声明委托类型</a></li><li><a href=#使用委托>使用委托</a></li><li><a href=#简单的委托示例>简单的委托示例</a></li><li><a href=#actiontfunctpredicatet委托><code>Action&lt;T></code>、<code>Func&lt;T></code>、<code>Predicate&lt;T></code>委托</a></li><li><a href=#多播委托>多播委托</a></li><li><a href=#匿名方法和lambda表达式>匿名方法和Lambda表达式</a></li><li><a href=#委托和-multicastdelegate-类>委托和 MulticastDelegate 类</a></li><li><a href=#参考资源>参考资源</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><p>委托是类型安全的类，它定义了返回类型和参数的类型，委托类可以包含一个或多个方法的引用。可以使用lambda表达式实现参数是委托类型的方法。</p><h2 id=委托>委托</h2><p>当需要把一个方法作为参数传递给另一个方法时，就需要使用委托。委托是一种特殊类型的对象，其特殊之处在于，我们以前定义的所有对象都包含数据，而委托包含的只是一个或多个方法的地址。</p><h4 id=声明委托类型>声明委托类型</h4><p>声明委托类型就是告诉编译器，这种类型的委托表示的是哪种类型的方法。语法如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>delegate</span> <span class=kt>void</span> <span class=n>delegateTypeName</span><span class=p>[</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>]([</span><span class=err>参数列表</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>声明委托类型时指定的参数，就是该委托类型引用的方法对应的参数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=c1>//声明一个委托类型
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>private</span> <span class=n>delegate</span> <span class=kt>void</span> <span class=nf>IntMethodInvoker</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=c1>//该委托表示的方法有两个long型参数，返回类型为double
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>protected</span> <span class=n>delegate</span> <span class=kt>double</span> <span class=nf>TwoLongsOp</span><span class=p>(</span><span class=kt>double</span> <span class=n>first</span><span class=p>,</span> <span class=kt>double</span> <span class=n>second</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=c1>//方法不带参数的委托，返回string
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=n>public</span> <span class=n>delegate</span> <span class=n>string</span> <span class=nf>GetString</span><span class=p>();</span>
</span></span><span class=line><span class=cl> <span class=n>public</span> <span class=n>delegate</span> <span class=kt>int</span> <span class=n>Comparison</span><span class=o>&lt;</span><span class=n>in</span> <span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span> <span class=n>left</span><span class=p>,</span> <span class=n>T</span> <span class=n>right</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>（注：我们把上述定义的<code>Comparison&lt;in T></code>、<code>IntMethodInvoker</code>等统称为委托类型。）</p><p>在定义委托类型时，必须给出它要引用的方法的参数信息和返回类型等全部细节。声明委托类型的语法和声明方法的语法类似，但没有方法体，并且需要指定<code>delegate</code>关键字。</p><p>委托实现为派生自基类<code>System.MulticastDelegate</code>的类，<code>System.MulticastDelegate</code>有派生自基类<code>System.Delegate</code>。因此定义委托类型基本上是定义一个新类，所以可以在定义类的任何相同地方定义委托类型。（可以在类的内部定义委托类型，也可以在任何类的外部定义，还可以在命名空间中把委托定义为顶层对象）。</p><blockquote><p>我们从“delegate”关键字开始，因为这是你在使用委托时会使用的主要方法。 编译器在你使用 <code>delegate</code> 关键字时生成的代码会映射到调用 <a href=https://docs.microsoft.com/zh-cn/dotnet/api/system.delegate target=_blank rel="external nofollow noopener noreferrer">Delegate</a> 和 <a href=https://docs.microsoft.com/zh-cn/dotnet/api/system.multicastdelegate target=_blank rel="external nofollow noopener noreferrer">MulticastDelegate</a> 类的成员的方法调用。</p><p>可以在类中、直接在命名空间中、甚至是在全局命名空间中定义委托类型。</p><p><strong>建议不要直接在全局命名空间中声明委托类型（或其他类型）。</strong></p></blockquote><h4 id=使用委托>使用委托</h4><p>定义委托类型之后，可以创建该类型的实例。 为了便于说明委托是如何将方法进行传递的，针对上述的三个委托类型，分别定义三个方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ShowInt</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;这是一个数字：&#34;</span><span class=o>+</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>double</span> <span class=nf>ShowSum</span><span class=p>(</span><span class=kt>double</span> <span class=n>first</span><span class=p>,</span><span class=kt>double</span> <span class=n>second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>first</span> <span class=o>+</span> <span class=n>second</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//最后一个委托，直接可以使用int.ToString()方法，所以此处不再定义
</span></span></span></code></pre></td></tr></table></div></div><p>调用委托有两种形式，一种形式是实例化委托，并在委托的构造函数中传入要引用的方法名（注意仅仅是方法名，不需要带参数），另一种形式是使用<strong>委托推断</strong>，即不需要显式的实例化委托，而是直接指向要引用的方法名即可，编译器将会自动把委托实例解析为特定的类型。具体示例如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//调用委托形式一
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>IntMethodInvoker</span> <span class=n>showIntMethod</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>IntMethodInvoker</span><span class=p>(</span><span class=n>ShowInt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>showIntMethod</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//调用委托形式二
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>TwoLongsOp</span> <span class=n>showSumMethod</span> <span class=o>=</span> <span class=n>ShowSum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>sum</span><span class=o>=</span> <span class=n>showSumMethod</span><span class=p>.</span><span class=nf>Invoke</span><span class=p>(</span><span class=mf>1.23</span><span class=p>,</span> <span class=mf>2.33</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;两数之和：&#34;</span><span class=o>+</span><span class=n>sum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//由于int.Tostring()不是静态方法，所以需要指定实例a和方法名ToString
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>GetString</span> <span class=n>showString</span> <span class=o>=</span> <span class=n>a</span><span class=p>.</span><span class=n>ToString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>string</span> <span class=n>str</span><span class=o>=</span><span class=nf>showString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;使用委托调用a.ToString()方法：&#34;</span><span class=o>+</span><span class=n>str</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在使用委托调用引用的方法时，委托实例名称后面的小括号需要传入要调用的方法的参数信息。实际上，给委托实例提供圆括号的调用和使用委托类的<code>Invoke()</code>方法完全相同。委托实例<code>showSumMethod</code>最终会被解析为委托类型的一个变量，所以C#编译器会用<code>showSumMethod.Invoke()</code>代替<code>showSumMethod()</code>。</p><p>委托实例可以引用任何类型的任何对象上的实例方法或静态方法，只要方法的签名匹配委托的签名即可。（所谓签名，指的是定义方法或委托时，指定的参数列表和返回类型）</p><h4 id=简单的委托示例>简单的委托示例</h4><p>后面的内容将会基于此示例进行扩展，首先定义一个简单的数字操作类<code>MathOperations</code>，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>internal</span> <span class=n>class</span> <span class=n>MathOperations</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//显示数值的2倍结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=k>static</span> <span class=kt>double</span> <span class=nf>MultiplyByTwo</span><span class=p>(</span><span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;{value}*2={result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//显示数值的乘方结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=k>static</span> <span class=kt>double</span> <span class=nf>Square</span><span class=p>(</span><span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span> <span class=o>*</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;{value}*{value}={result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>然后定义一个引用上述方法的委托：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>delegate</span> <span class=kt>double</span> <span class=nf>DoubleOp</span><span class=p>(</span><span class=kt>double</span> <span class=n>x</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>如果要使用该委托的话，对应的代码为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>DoubleOp</span> <span class=n>op</span> <span class=o>=</span> <span class=n>MathOperations</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nf>op</span><span class=p>(</span><span class=n>double_num</span><span class=p>);</span><span class=c1>// 假设double_num为一个double类型的变量
</span></span></span></code></pre></td></tr></table></div></div><p>但是很多时候，我们并不是直接这样使用，而是将委托实例作为一个方法（假设该方法为A）的参数进行传入，并且将委托实例引用的方法的参数 作为另一个参数传递给该方法A。将上述代码进行封装转换：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ShowDouble</span><span class=p>(</span><span class=n>DoubleOp</span> <span class=n>op</span><span class=p>,</span> <span class=kt>double</span> <span class=n>double_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>op</span><span class=p>(</span><span class=n>double_num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;值为：&#34;</span><span class=o>+</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>调用该方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>ShowDouble</span><span class=p>(</span><span class=n>MathOperations</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>使用委托一个好的思路就是，先定义普通方法，然后针对该方法定义一个引用该方法的委托，然后写出对应的委托使用代码，接着再将使用的代码用一个新定义的方法进行封装转换，在新的方法参数中，需要指明委托实例和将要为委托实例引用的方法传入的参数（也就是上述示例中的op和double_num），接着就可以在其他地方调用该方法了。</p><p>完整的实例代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>delegate</span> <span class=kt>double</span> <span class=nf>DoubleOp</span><span class=p>(</span><span class=kt>double</span> <span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>DoubleOp</span> <span class=n>action</span><span class=p>,</span> <span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>action</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;Value is {value },result of operation is {result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DoubleOp</span><span class=p>[]</span> <span class=n>operations</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>MathOperations</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>MathOperations</span><span class=p>.</span><span class=n>Square</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>operations</span><span class=p>.</span><span class=n>Length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;Using operations[{i}]:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=actiontfunctpredicatet委托><code>Action&lt;T></code>、<code>Func&lt;T></code>、<code>Predicate&lt;T></code>委托</h4><p>泛型<code>Action&lt;T></code>委托表示引用一个<code>void</code>返回类型的方法。 该委托类最多可以为将要引用的方法传递<code>16</code>种不同的参数类型。</p><p>泛型<code>Func&lt;T></code>委托表示引用一个带有返回值类型的方法。该委托类最多可以为将要引用的方法传递<code>16</code>中不同的参数类型，其中最后一个参数代表的是将要引用的方法的返回值类型。</p><p>泛型<code>Predicate&lt;T></code> 用于需要确定参数是否满足委托条件的情况。 也可将其写作 <code>Func&lt;T, bool></code> 。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Predicate</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>pre</span> <span class=o>=</span> <span class=n>b</span> <span class=o>=&gt;</span> <span class=n>b</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>此处只对<code>Action&lt;T></code>和<code>Func&lt;T></code>做详细说明。</p><p>有了这两个委托类，在定义委托时，就可以省略<code>delegate</code>关键字，采用新的形式声明委托。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>operations</span> <span class=o>=</span> <span class=n>MathOperations</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span><span class=p>[]</span> <span class=n>operations2</span> <span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MathOperations</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MathOperations</span><span class=p>.</span><span class=n>Square</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>Func</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span> <span class=n>action</span><span class=p>,</span> <span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>action</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;Value is {value },result of operation is {result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>下面使用一个示例对委托的用途进行说明，首先定义一个普通的方法，该方法是冒泡排序的另一种写法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Sort</span><span class=p>(</span><span class=kt>int</span><span class=p>[]</span> <span class=n>sortArray</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>swapped</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>swapped</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sortArray</span><span class=p>.</span><span class=n>Length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=kt>int</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>swapped</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>swapped</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述方法中，接收的参数局限于数值，为了扩展 使其支持对其他类型的排序，并且不仅仅是升序，对该方法进行泛型改写，并使用泛型委托。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>internal</span> <span class=n>class</span> <span class=n>BubbleSorter</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=n>Sort</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>IList</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>sortArray</span><span class=p>,</span> <span class=n>Func</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>T</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&gt;</span> <span class=n>comparison</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>swapped</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>swapped</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>sortArray</span><span class=p>.</span><span class=n>Count</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nf>comparison</span><span class=p>(</span><span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>T</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                    <span class=n>sortArray</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>swapped</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>swapped</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述方法中的参数<code>comparison</code>是一个泛型委托，将要引用的方法带有两个参数，类型和<code>T</code>相同，值可以来自于<code>sortArray</code>，并返回<code>bool</code>类型值，因此实际调用该委托时，不用单独的为泛型类型传入参数，直接使用<code>sortArray</code>中的项即可。</p><p>为了更好的调用该方法，定义如下类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>internal</span> <span class=n>class</span> <span class=n>Employee</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>string</span> <span class=n>Name</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>decimal</span> <span class=n>Salary</span> <span class=p>{</span> <span class=n>get</span><span class=p>;</span> <span class=n>private</span> <span class=n>set</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>override</span> <span class=n>string</span> <span class=nf>ToString</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=err>$</span><span class=s>&#34;{Name},{Salary:C}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=nf>Employee</span><span class=p>(</span><span class=n>string</span> <span class=n>name</span><span class=p>,</span> <span class=n>decimal</span> <span class=n>salary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>this</span><span class=p>.</span><span class=n>Salary</span> <span class=o>=</span> <span class=n>salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//为了匹配Func&lt;T,T,bool&gt;委托，定义如下方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>public</span> <span class=k>static</span> <span class=kt>bool</span> <span class=nf>CompareSalary</span><span class=p>(</span><span class=n>Employee</span> <span class=n>e1</span><span class=p>,</span> <span class=n>Employee</span> <span class=n>e2</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>e1</span><span class=p>.</span><span class=n>Salary</span> <span class=o>&lt;</span> <span class=n>e2</span><span class=p>.</span><span class=n>Salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用该类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Employee</span><span class=p>[]</span> <span class=n>employees</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Employee</span><span class=p>(</span><span class=s>&#34;小明&#34;</span><span class=p>,</span><span class=mi>8000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Employee</span><span class=p>(</span><span class=s>&#34;小芳&#34;</span><span class=p>,</span><span class=mi>9800</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Employee</span><span class=p>(</span><span class=s>&#34;小黑&#34;</span><span class=p>,</span><span class=mi>4000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Employee</span><span class=p>(</span><span class=s>&#34;小米&#34;</span><span class=p>,</span><span class=mi>13000</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>new</span> <span class=nf>Employee</span><span class=p>(</span><span class=s>&#34;小马&#34;</span><span class=p>,</span><span class=mi>12000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>//调用排序
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>BubbleSorter</span><span class=p>.</span><span class=nf>Sort</span><span class=p>(</span><span class=n>employees</span><span class=p>,</span> <span class=n>Employee</span><span class=p>.</span><span class=n>CompareSalary</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>ForeachWrite</span><span class=p>(</span><span class=n>employees</span><span class=p>);</span> <span class=c1>//输出结果，该方法的定义如下：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=n>ForeachWrite</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>T</span><span class=p>[]</span> <span class=n>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>foreach</span> <span class=p>(</span><span class=n>T</span> <span class=n>item</span> <span class=n>in</span> <span class=n>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=n>item</span><span class=p>.</span><span class=nf>ToString</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=多播委托>多播委托</h4><p>一个委托包含多个方法的调用，这种委托称为多播委托。多播委托可以识别运算符“<code>+</code>”和“<code>+=</code>“（在委托中添加方法的调用）以及”<code>-</code>“和”<code>-=</code>“（在委托中删除方法的调用）。</p><blockquote><p>多播委托实际上是一个派生自 <code>System.MulticastDelegate</code>的类，而<code>System.MulticastDelegate</code>又派生自基类<code>System.Delegate</code>。<code>System.MulticastDelegate</code>的其他成员允许把多个方法调用链接为一个列表。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>internal</span> <span class=n>class</span> <span class=n>MathOperations_V2</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>MultiplyByTwo</span><span class=p>(</span><span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;{value}*2={result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Square</span><span class=p>(</span><span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>double</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span> <span class=o>*</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=err>$</span><span class=s>&#34;{value}*{value}={result}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>针对上述方法定义一个带有泛型委托的方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>private</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>Action</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>action</span><span class=p>,</span> <span class=kt>double</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;调用ProcessAndDisplayNumber方法：value=&#34;</span> <span class=o>+</span> <span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>action</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>使用多播委托的形式进行调用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Action</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>operations</span> <span class=o>=</span> <span class=n>MathOperations_V2</span><span class=p>.</span><span class=n>MultiplyByTwo</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>operations</span> <span class=o>+=</span> <span class=n>MathOperations_V2</span><span class=p>.</span><span class=n>Square</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>ProcessAndDisplayNumber</span><span class=p>(</span><span class=n>operations</span><span class=p>,</span> <span class=mi>5</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>上述在调用方法时，会依次执行<code>MathOperations_V2.MultiplyByTwo</code>和<code>MathOperations_V2.Square</code>。</p><p>注意：在使用多播委托时，多播委托包含一个逐个调用的委托集合，一旦通过委托调用的其中一个方法抛出一个异常，整个迭代就会停止。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>private</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>One</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;调用One()方法&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>throw</span> <span class=n>new</span> <span class=nf>Exception</span><span class=p>(</span><span class=s>&#34;Error in one&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>Two</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;调用Two()方法&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=n>d1</span> <span class=o>=</span> <span class=n>One</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>+=</span> <span class=n>Two</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>try</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>d1</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>catch</span> <span class=p>(</span><span class=n>Exception</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;调用d1出错了&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述使用了多播委托，一旦<code>One</code>出现了异常，Two并不能够继续执行。因为第一个方法抛出了一个异常，委托迭代就会停止，不再调用<code>Two()</code>方法。为了避免这个问题，应自己迭代方法列表。<code>Delegate</code>类定义<code>GetInvocationList()</code>方法，返回<code>Delegate</code>对象数组，可以迭代这个数组进行方法的执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>void</span> <span class=nf>Run2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Action</span> <span class=n>d1</span> <span class=o>=</span> <span class=n>One</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>d1</span> <span class=o>+=</span> <span class=n>Two</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Delegate</span><span class=p>[]</span> <span class=n>delegates</span> <span class=o>=</span> <span class=n>d1</span><span class=p>.</span><span class=nf>GetInvocationList</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>foreach</span> <span class=p>(</span><span class=n>Action</span> <span class=n>d</span> <span class=n>in</span> <span class=n>delegates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>try</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>d</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>catch</span> <span class=p>(</span><span class=n>Exception</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;调用出错了！！&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上述迭代，即使第一个方法出错，依然就执行第二个方法。</p><h4 id=匿名方法和lambda表达式>匿名方法和Lambda表达式</h4><p>匿名方法是用作委托的参数的一段代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>string</span> <span class=n>start</span> <span class=o>=</span> <span class=s>&#34;厉害了，&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=n>string</span><span class=o>&gt;</span> <span class=n>print</span> <span class=o>=</span> <span class=nf>delegate</span> <span class=p>(</span><span class=n>string</span> <span class=n>param</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>start</span> <span class=o>+</span> <span class=n>param</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=nf>print</span><span class=p>(</span><span class=s>&#34;我的国！&#34;</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>在该示例中，<code>Func&lt;string,string></code>委托接受一个字符串参数，返回一个字符串。<code>print</code>是这种委托类型的变量。不要把方法名赋予这个变量，而是使用一段简单的代码：前面是关键字<code>delegate</code>，后面是一个字符串参数。</p><p>匿名方法的优点是减少了要编写的代码，但代码的执行速度并没有加快。</p><p>使用匿名方法时，在匿名方法中不能使用跳转语句（<code>break</code>、<code>goto</code>或<code>continue</code>）调到该匿名方法的外部，也不能在匿名方法的外部使用跳转语句调到匿名方法的内部。并且不能访问在匿名方法外部使用的<code>ref</code>和<code>out</code>参数。</p><p>实际使用中，不建议使用上述的方式定义匿名方法，而是使用lambda表达式。</p><p>只要有委托参数类型的地方，就可以使用lambda表达式，将上述示例改为lambda表达式，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//使用Lambda表达式进行匿名方法的定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>string</span> <span class=n>start</span> <span class=o>=</span> <span class=s>&#34;厉害了，&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=n>string</span><span class=o>&gt;</span> <span class=n>lambda</span> <span class=o>=</span> <span class=n>param</span> <span class=o>=&gt;</span> <span class=n>start</span> <span class=o>+</span> <span class=n>param</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=nf>lambda</span><span class=p>(</span><span class=s>&#34;我的C#!!!&#34;</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>使用lambda表达式规则：</p><p><strong>参数</strong></p><p>只有一个参数时，可以省略小括号</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=n>string</span><span class=o>&gt;</span> <span class=n>oneParam</span> <span class=o>=</span> <span class=n>s</span> <span class=o>=&gt;</span> <span class=err>$</span><span class=s>&#34;将{s}转换为大写：&#34;</span> <span class=o>+</span> <span class=n>s</span><span class=p>.</span><span class=nf>ToUpper</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=nf>oneParam</span><span class=p>(</span><span class=s>&#34;abc&#34;</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>没有参数或者有多个参数时必须使用小括号</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//无参数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Action</span> <span class=n>a</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;无参数&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>a</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>//多个参数，在小括号中指定参数类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Func</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=p>,</span> <span class=kt>double</span><span class=o>&gt;</span> <span class=n>twoParamsWithTypes</span> <span class=o>=</span> <span class=p>(</span><span class=kt>double</span> <span class=n>x</span><span class=p>,</span> <span class=kt>double</span> <span class=n>y</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=s>&#34;2.3+1.3=&#34;</span> <span class=o>+</span> <span class=nf>twoParamsWithTypes</span><span class=p>(</span><span class=mf>2.3</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>多行代码</strong></p><p>如果lambda表达式只有一条语句，在方法块内就不需要花括号（<code>{}</code>）和<code>return</code>语句，因为编译器会添加一条隐式的<code>return</code>语句。如果lambda表达式有多条语句，必须显式的添加花括号或return语句。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Func</span><span class=o>&lt;</span><span class=n>string</span><span class=p>,</span> <span class=n>string</span><span class=p>,</span> <span class=n>string</span><span class=o>&gt;</span> <span class=n>joinString</span> <span class=o>=</span> <span class=p>(</span><span class=n>str1</span><span class=p>,</span> <span class=n>str2</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>str1</span> <span class=o>+=</span> <span class=n>str2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>str1</span><span class=p>.</span><span class=nf>ToUpper</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>Console</span><span class=p>.</span><span class=nf>WriteLine</span><span class=p>(</span><span class=nf>joinString</span><span class=p>(</span><span class=s>&#34;abc&#34;</span><span class=p>,</span> <span class=s>&#34;def&#34;</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>闭包</strong></p><p>在lambda表达式的内部使用表达式外部的变量，称为闭包。使用闭包需要注意的一点就是 ，如果在表达式中修改了闭包的值，可以在表达式的外部访问已修改的值 。</p><h4 id=委托和-multicastdelegate-类>委托和 MulticastDelegate 类</h4><blockquote><p><code>System.Delegate</code> 类及其单个直接子类 <code>System.MulticastDelegate</code> 可提供框架支持，以便创建委托、将方法注册为委托目标以及调用注册为委托目标的所有方法。</p><p>有趣的是，<code>System.Delegate</code> 和 <code>System.MulticastDelegate</code> 类本身不是委托类型。 它们为所有特定委托类型提供基础。 相同的语言设计过程要求不能声明派生自 <code>Delegate</code> 或 <code>MulticastDelegate</code> 的类。 C# 语言规则禁止这样做。</p><p>相反，C# 编译器会在你使用 C# 语言关键字声明委托类型时，创建派生自 <code>MulticastDelegate</code> 的类的实例。</p><p>要记住的首要且最重要的事实是，使用的每个委托都派生自 <code>MulticastDelegate</code>。 多播委托意味着通过委托进行调用时，可以调用多个方法目标。</p></blockquote><h4 id=参考资源>参考资源</h4><ul><li>《C#高级编程（第10版）》</li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/csharp/delegates-overview target=_blank rel="external nofollow noopener noreferrer">委托概述</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/csharp/delegate-class target=_blank rel="external nofollow noopener noreferrer">System.Delegate 和 <code>delegate</code> 关键字</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/csharp/delegates-events target=_blank rel="external nofollow noopener noreferrer">委托和事件</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/standard/delegates-lambdas target=_blank rel="external nofollow noopener noreferrer">委托和 lambda</a></li></ul><hr><p>作者：OctOcean
链接：https://www.jianshu.com/p/c654991806e9
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-01-29 01:20:34">更新于 2023-01-29&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/2023/01/csharp%E5%A7%94%E6%89%98/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/ data-title=C#基础提升系列——C#委托 data-via=borna_coric data-hashtags=委托,C#><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/ data-hashtag=委托><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/ data-title=C#基础提升系列——C#委托><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/ data-title=C#基础提升系列——C#委托><i data-svg-src=/lib/simple-icons/icons/baidu.min.svg aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://canw0916.github.io/posts/2023/01/csharp%E5%A7%94%E6%89%98/ data-title=C#基础提升系列——C#委托><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/%E5%A7%94%E6%89%98/ class=post-tag>委托</a><a href=/tags/c%23/ class=post-tag>C#</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2023/01/git%E5%A6%82%E4%BD%95%E8%A7%A3%E9%99%A4%E9%A1%B9%E7%9B%AE%E5%8E%9F%E6%9D%A5%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E5%85%B3%E8%81%94/ class=post-nav-item rel=prev title=Git如何解除项目原来远程仓库的关联><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Git如何解除项目原来远程仓库的关联</a>
<a href=/posts/2023/01/csharp%E6%B3%9B%E5%9E%8B/ class=post-nav-item rel=next title=C#基础提升系列——C#泛型>C#基础提升系列——C#泛型<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=canw0916/BlogGiscus data-repo-id=R_kgDOI27Tcw data-category=Announcements data-category-id=DIC_kwDOI27Tc84CT208 data-mapping=og:title data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.110.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.17-RC"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>
<a href=https://canw0916.github.io/ target=_blank rel="external nofollow noopener noreferrer">火山</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中 ...</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/canw0916 title="Visit My Github Repository" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/lazysizes/lazysizes.min.js async defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:30},comment:{enable:!0,expired:!1,giscus:{darkTheme:"transparent_dark",lightTheme:"light"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2023-01-25T00:00:00+08:00"}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7ENSZ7BS0C",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-7ENSZ7BS0C" async></script></body></html>